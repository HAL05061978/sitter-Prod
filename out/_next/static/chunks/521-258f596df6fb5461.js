"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521],{3521:function(e,t,s){s.d(t,{Z:function(){return u}});var a=s(7437),r=s(2265),n=s(9376),i=s(3519),o=s(7573),c=s(7506),l=s(4954),d=s(6689);function u(e){let{currentPage:t="dashboard",children:s}=e,u=(0,n.useRouter)();(0,n.usePathname)();let{t:h,i18n:p}=(0,c.$G)(),[g,m]=(0,r.useState)(null),[_,f]=(0,r.useState)("parent"),[w,v]=(0,r.useState)(0),[E,C]=(0,r.useState)(()=>{{let e=localStorage.getItem("unreadChatMessages");return e?parseInt(e,10):0}}),[b,y]=(0,r.useState)(()=>{{let e=localStorage.getItem("schedulerMessagesCount");return e?parseInt(e,10):0}}),[x,D]=(0,r.useState)(()=>{{let e=localStorage.getItem("newCalendarBlocksCount");return e?parseInt(e,10):0}}),N=async e=>{try{let{data:t}=await i.O.from("profiles").select("email").eq("id",e).single();if(!(null==t?void 0:t.email)){v(0);return}let{data:s,error:a}=await i.O.from("group_invites").select("id").eq("email",t.email.toLowerCase()).eq("status","pending");if(a)return;let r=(null==s?void 0:s.length)||0;v(r)}catch(e){}},I=async e=>{try{let{data:t}=await i.O.from("group_members").select("group_id").eq("profile_id",e).eq("status","active");if(!t||0===t.length){C(0),localStorage.setItem("unreadChatMessages","0");return}let s=t.map(e=>e.group_id),{data:a}=await i.O.from("chat_messages").select("id").in("group_id",s).neq("sender_id",e);if(!a||0===a.length){C(0),localStorage.setItem("unreadChatMessages","0");return}let r=a.map(e=>e.id),{data:n}=await i.O.from("message_views").select("message_id").eq("user_id",e).in("message_id",r),o=(n||[]).map(e=>e.message_id),c=r.filter(e=>!o.includes(e)).length;C(c),localStorage.setItem("unreadChatMessages",c.toString())}catch(e){}},S=async e=>{o.b.logCounterFetch("scheduler",e,"Header.fetchSchedulerMessagesCount");try{let{data:t}=await i.O.rpc("get_open_block_invitations",{p_parent_id:e}),{data:s}=await i.O.rpc("get_reciprocal_care_requests",{parent_id:e}),a=[];try{let{data:t,error:s}=await i.O.rpc("get_reciprocal_pet_care_requests",{p_parent_id:e});s||(a=t||[])}catch(e){}[...s||[],...a];let{data:r}=await i.O.rpc("get_reciprocal_care_responses",{parent_id:e}),n=[];try{let{data:t,error:s}=await i.O.rpc("get_reciprocal_pet_care_responses",{p_parent_id:e});s||(n=t||[])}catch(e){}let c=[];try{let{data:t,error:s}=await i.O.rpc("get_hangout_sleepover_responses",{p_parent_id:e});s||(c=t||[])}catch(e){}let l=[...r||[],...n,...c],{data:d}=await i.O.rpc("get_responses_for_requester",{p_requester_id:e}),u=[];try{let{data:t,error:s}=await i.O.rpc("get_pet_care_responses_for_requester",{p_requester_id:e});s?o.b.logDatabaseError("get_pet_care_responses_for_requester","get_pet_care_responses_for_requester",s):u=t||[]}catch(e){o.b.logDatabaseError("get_pet_care_responses_for_requester","get_pet_care_responses_for_requester",{message:"Function not deployed or catch error",error:e})}let h=[...d||[],...u],{data:p}=await i.O.rpc("get_reschedule_requests",{p_parent_id:e}),{data:g}=await i.O.from("notifications").select("*").eq("user_id",e).in("type",["reschedule_request","reschedule_accepted","reschedule_declined","reschedule_counter_sent","reschedule_counter_accepted","reschedule_counter_declined"]),{data:m}=await i.O.from("notifications").select("*").eq("user_id",e).eq("type","care_declined").eq("is_read",!1),{data:_}=await i.O.from("notifications").select("*").eq("user_id",e).eq("type","hangout_accepted").eq("is_read",!1),f=0,w=localStorage.getItem("readSchedulerMessages"),v=w?new Set(JSON.parse(w)):new Set,E=(l||[]).filter(e=>"pending"===e.status&&!v.has("pending-".concat(e.care_response_id)));f+=E.length;let C=(h||[]).filter(e=>"submitted"===e.status),b=new Set;C.forEach(e=>{b.add(e.care_request_id)}),f+=b.size;let x=new Map;(t||[]).filter(e=>"pending"===e.status).forEach(e=>{let t=e.open_block_parent_id||e.open_block_parent_name;x.has(t)||x.set(t,[]),x.get(t).push(e)}),x.forEach((e,t)=>{!v.has("invitation-group-".concat(t))&&f++}),(t||[]).filter(e=>"accepted"===e.status).forEach((e,t)=>{let s="open-block-accepted-".concat(e.invitation_id||t);!v.has(s)&&f++}),(p||[]).forEach(e=>{let t=e.reschedule_group_id||e.request_id;!v.has("reschedule-".concat(t))&&f++}),(g||[]).filter(e=>"reschedule_request"===e.type&&!1===e.is_read).forEach(e=>{!v.has("reschedule-notification-".concat(e.id))&&f++}),(g||[]).filter(e=>"reschedule_counter_sent"===e.type&&!(g||[]).some(t=>{var s,a;return("reschedule_counter_accepted"===t.type||"reschedule_counter_declined"===t.type)&&(null===(s=t.data)||void 0===s?void 0:s.counter_request_id)===(null===(a=e.data)||void 0===a?void 0:a.counter_request_id)})).forEach(e=>{!v.has("reschedule-notification-".concat(e.id))&&f++}),(g||[]).filter(e=>"reschedule_accepted"===e.type||"reschedule_declined"===e.type||"reschedule_counter_accepted"===e.type||"reschedule_counter_declined"===e.type).forEach(e=>{!v.has("reschedule-notification-".concat(e.id))&&f++});let D=(m||[]).filter(e=>!v.has("care-declined-".concat(e.id))).length;f+=D;let N=(_||[]).filter(e=>!v.has("hangout-accepted-".concat(e.id))).length;f+=N,o.b.logCounterCalculation("scheduler",{pendingCareResponses:E.length,requestsWithSubmittedResponses:b.size,openBlockInvitationGroups:x.size,acceptedOpenBlockInvitations:(t||[]).filter(e=>"accepted"===e.status).length,rescheduleRequests:(p||[]).length,rescheduleRequestNotifications:(g||[]).filter(e=>"reschedule_request"===e.type&&!1===e.is_read).length,rescheduleCounters:(g||[]).filter(e=>"reschedule_counter_sent"===e.type&&!(g||[]).some(t=>{var s,a;return("reschedule_counter_accepted"===t.type||"reschedule_counter_declined"===t.type)&&(null===(s=t.data)||void 0===s?void 0:s.counter_request_id)===(null===(a=e.data)||void 0===a?void 0:a.counter_request_id)})).length,acceptDeclineNotifications:(g||[]).filter(e=>"reschedule_accepted"===e.type||"reschedule_declined"===e.type||"reschedule_counter_accepted"===e.type||"reschedule_counter_declined"===e.type).length,careDeclinedNotifications:D,hangoutAcceptedNotifications:N,readMessagesInLocalStorage:v.size},f),y(f),localStorage.setItem("schedulerMessagesCount",f.toString())}catch(e){console.error("Error fetching scheduler messages count:",e)}},O=async e=>{o.b.logCounterFetch("calendar",e,"Header.fetchNewCalendarBlocksCount");try{let{data:t,error:s}=await i.O.from("notifications").select("*").eq("user_id",e).eq("type","care_accepted").eq("is_read",!1);s&&console.error("Error fetching care_accepted notifications:",s);let a=(t||[]).reduce((e,t)=>{var s;let a=(null===(s=t.data)||void 0===s?void 0:s.blocks_created)||2;return e+a},0),r=0;try{let{data:t,error:s}=await i.O.rpc("get_unseen_calendar_updates_count",{p_user_id:e});s||null===t||(r=t)}catch(e){console.log("get_unseen_calendar_updates_count not available yet")}let n=a+r;o.b.logCounterCalculation("calendar",{totalNotifications:(t||[]).length,notificationDetails:(t||[]).map(e=>{var t,s;return{id:e.id,blocks_created:(null===(t=e.data)||void 0===t?void 0:t.blocks_created)||2,care_type:null===(s=e.data)||void 0===s?void 0:s.care_type,created_at:e.created_at}}),unseenUpdatesCount:r},n),D(n),localStorage.setItem("newCalendarBlocksCount",n.toString())}catch(e){console.error("Error fetching calendar blocks count:",e)}},L=async()=>{g&&await Promise.all([N(g.id),I(g.id),S(g.id),O(g.id)])};(0,r.useEffect)(()=>{i.O.auth.getUser().then(async e=>{let{data:t}=e;if(t.user){m(t.user);let{data:e}=await i.O.from("profiles").select("role").eq("id",t.user.id).single();(null==e?void 0:e.role)&&f(e.role),await Promise.all([N(t.user.id),I(t.user.id),S(t.user.id),O(t.user.id)])}})},[]),(0,r.useEffect)(()=>{let e=()=>{g&&setTimeout(async()=>{await Promise.all([S(g.id),O(g.id)])},300)};return window.addEventListener("refreshCounters",e),()=>window.removeEventListener("refreshCounters",e)},[g]),(0,r.useEffect)(()=>{let e=()=>{g&&setTimeout(async()=>{await O(g.id)},200)};return window.addEventListener("calendarBlockViewed",e),()=>window.removeEventListener("calendarBlockViewed",e)},[g]),(0,r.useEffect)(()=>{let e=async()=>{g&&setTimeout(async()=>{await I(g.id)},200)},t=()=>{},s=()=>{g&&I(g.id)},a=()=>{o.b.logEventReceived("schedulerCountUpdated","Header.handleSchedulerCountUpdated"),g&&S(g.id)},r=()=>{o.b.logEventReceived("calendarCountUpdated","Header.handleCalendarCountUpdated"),g&&O(g.id)};return window.addEventListener("messagesViewed",e),window.addEventListener("careRequestUpdated",t),window.addEventListener("responseStatusUpdated",s),window.addEventListener("newMessageSent",e),window.addEventListener("schedulerCountUpdated",a),window.addEventListener("calendarCountUpdated",r),()=>{window.removeEventListener("messagesViewed",e),window.removeEventListener("careRequestUpdated",t),window.removeEventListener("responseStatusUpdated",s),window.removeEventListener("newMessageSent",e),window.removeEventListener("schedulerCountUpdated",a),window.removeEventListener("calendarCountUpdated",r)}},[g]),(0,r.useEffect)(()=>{g&&(async()=>{let{data:e}=await i.O.from("profiles").select("email").eq("id",g.id).single();if(null==e?void 0:e.email){let t=e.email.toLowerCase(),s=i.O.channel("header_invitation_updates").on("postgres_changes",{event:"*",schema:"public",table:"group_invites",filter:"email=eq.".concat(t)},e=>{N(g.id)}).subscribe();return()=>{i.O.removeChannel(s)}}})()},[g]),(0,r.useEffect)(()=>{if(!g)return;let e=i.O.channel("header_care_responses_updates").on("postgres_changes",{event:"*",schema:"public",table:"care_responses",filter:"responder_id=eq.".concat(g.id)},e=>{}).subscribe();return()=>{i.O.removeChannel(e)}},[g]),(0,r.useEffect)(()=>{g&&(async()=>{let{data:e}=await i.O.from("group_members").select("group_id").eq("profile_id",g.id).eq("status","active");if(!e||0===e.length)return;let t=e.map(e=>e.group_id),s=i.O.channel("header_care_requests_updates").on("postgres_changes",{event:"*",schema:"public",table:"care_requests",filter:"group_id=in.(".concat(t.join(","),")")},e=>{}).subscribe();return()=>{i.O.removeChannel(s)}})()},[g]),(0,r.useEffect)(()=>{if(!g)return;let e=i.O.channel("header_notifications_updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:"user_id=eq.".concat(g.id)},e=>{S(g.id),O(g.id)}).subscribe();return()=>{i.O.removeChannel(e)}},[g]),(0,r.useEffect)(()=>(window.manualRefresh=L,()=>{delete window.manualRefresh}),[g]),(0,r.useEffect)(()=>{g&&(S(g.id),O(g.id))},[g]),(0,r.useEffect)(()=>{let e=b+x+E;d.dV.isNativePlatform()&&l.h.setBadge(e)},[b,x,E]),(0,r.useEffect)(()=>{g&&(N(g.id),I(g.id))},[g]);let k=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=s?"px-2 py-1.5 sm:px-3 md:px-4 sm:py-2 rounded-lg transition font-medium shadow-soft text-[10px] sm:text-xs md:text-sm whitespace-nowrap":"px-2 py-1.5 sm:px-3 md:px-4 lg:px-6 sm:py-2 md:py-2.5 lg:py-3 rounded-lg transition font-medium shadow-soft text-[10px] sm:text-xs md:text-sm lg:text-base whitespace-nowrap";return t===e?"".concat(a," bg-emerald-600 text-white cursor-default shadow-medium"):"".concat(a," bg-emerald-500 text-white hover:bg-emerald-600 hover:shadow-medium")};return(0,a.jsxs)("div",{className:"app-container",children:[(0,a.jsx)("div",{className:"app-header",children:(0,a.jsxs)("div",{className:"p-3 max-w-7xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900 text-center mb-2",children:h("appName")}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>u.push("tutor"===_?"/tutor-dashboard":"/dashboard"),className:"p-2 rounded-lg transition shadow-soft bg-emerald-500 text-white hover:bg-emerald-600 hover:shadow-medium",title:"Profile",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,a.jsx)("button",{onClick:()=>u.push("/settings"),className:"p-2 rounded-lg transition shadow-soft bg-gray-500 text-white hover:bg-gray-600 hover:shadow-medium",title:"Settings",children:(0,a.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,a.jsx)("button",{onClick:async()=>{await i.O.auth.signOut(),u.replace("/auth")},className:"p-2 rounded-lg transition shadow-soft bg-red-500 text-white hover:bg-red-600 hover:shadow-medium",title:"Log Out",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]}),(0,a.jsxs)("button",{onClick:()=>{let e="en"===p.language?"es":"en";p.changeLanguage(e)},className:"flex items-center gap-1 px-2 py-1.5 rounded-lg transition shadow-soft bg-white border-2 border-gray-200 hover:border-gray-300 hover:shadow-medium",title:"en"===p.language?"Switch to Spanish":"Cambiar a Ingl\xe9s",children:[(0,a.jsx)("span",{className:"text-lg transition-opacity ".concat("en"===p.language?"opacity-100":"opacity-40"),children:"\uD83C\uDDEC\uD83C\uDDE7"}),(0,a.jsx)("div",{className:"w-10 h-5 bg-gray-200 rounded-full relative mx-1",children:(0,a.jsx)("div",{className:"absolute top-0.5 w-4 h-4 bg-emerald-500 rounded-full transition-all duration-200 ".concat("en"===p.language?"left-0.5":"left-5")})}),(0,a.jsx)("span",{className:"text-lg transition-opacity ".concat("es"===p.language?"opacity-100":"opacity-40"),children:"\uD83C\uDDEA\uD83C\uDDF8"})]})]})]})}),(0,a.jsx)("div",{className:"app-content bg-gray-50",children:s}),(0,a.jsx)("div",{className:"app-footer",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 py-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-center w-full gap-3 sm:gap-4 md:gap-6",children:[(0,a.jsxs)("button",{onClick:()=>u.push("/scheduler"),className:"".concat(k("scheduler")," relative flex-1 flex items-center justify-center"),children:[(0,a.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),b>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 bg-red-500 text-white text-[10px] sm:text-xs rounded-full h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 flex items-center justify-center font-bold shadow-medium",children:b})]}),(0,a.jsxs)("button",{onClick:()=>u.push("/calendar"),className:"".concat(k("calendar",!0)," relative flex-1 flex items-center justify-center"),children:[(0,a.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),x>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 bg-red-500 text-white text-[10px] sm:text-xs rounded-full h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 flex items-center justify-center font-bold shadow-medium",children:x})]}),(0,a.jsxs)("button",{onClick:()=>u.push("/chats"),className:"".concat(k("chats")," relative flex-1 flex items-center justify-center"),children:[(0,a.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),E>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 bg-red-500 text-white text-[10px] sm:text-xs rounded-full h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 flex items-center justify-center font-bold shadow-medium",children:E})]})]})})})]})}},3519:function(e,t,s){s.d(t,{O:function(){return l}});var a=s(1545);let{supabaseUrl:r,supabaseAnonKey:n,appEnv:i,appUrl:o,nodeEnv:c}=function(){let e={NEXT_PUBLIC_SUPABASE_URL:"https://hilkelodfneancwwzvoh.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhpbGtlbG9kZm5lYW5jd3d6dm9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjk2OTEsImV4cCI6MjA3NDc0NTY5MX0.MoVQTvTpYcus2xpIZayAXxsCRgNgV8CoP69ZPd6locw",NEXT_PUBLIC_APP_ENV:"development",NEXT_PUBLIC_APP_URL:"http://localhost:3000",NODE_ENV:"production"},t=Object.entries(e).filter(e=>{let[t,s]=e;return!s}).map(e=>{let[t]=e;return t});if(t.length>0)throw Error("Missing required environment variables: ".concat(t.join(", "),"\n")+"Please check your .env file and ensure all required variables are set.");return{supabaseUrl:e.NEXT_PUBLIC_SUPABASE_URL,supabaseAnonKey:e.NEXT_PUBLIC_SUPABASE_ANON_KEY,appEnv:e.NEXT_PUBLIC_APP_ENV,appUrl:e.NEXT_PUBLIC_APP_URL,nodeEnv:e.NODE_ENV}}();"development"===i&&console.log("\uD83D\uDD27 Environment Configuration:",{env:i,supabaseUrl:r.replace(/\/\/.*@/,"//***@"),appUrl:o,nodeEnv:c});let l=(0,a.eI)(r,n,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{headers:{"X-Client-Info":"sitter-app-".concat(i)}}})},7573:function(e,t,s){s.d(t,{b:function(){return a}});class a{static setEnabled(e){this.enabled=e,console.log("\uD83D\uDD27 Counter Debugger ".concat(e?"ENABLED":"DISABLED"))}static init(){console.log("\uD83D\uDD27 Counter Debugger Initialized"),console.log("\uD83D\uDCDD Available Commands:"),console.log("  - CounterDebugger.showHistory() - Show all logged events"),console.log("  - CounterDebugger.showCounterFlow() - Show counter update flow"),console.log("  - CounterDebugger.showEventDispatches() - Show all window events"),console.log("  - CounterDebugger.clear() - Clear event history"),console.log("  - CounterDebugger.setEnabled(false) - Disable debugging"),window.CounterDebugger=this}static logCounterFetch(e,t,s){if(!this.enabled)return;let a={timestamp:this.getTimestamp(),type:"COUNTER_FETCH",counterType:e,userId:t,triggerReason:s};this.events.push(a),console.log("\uD83D\uDD04 [".concat(a.timestamp,"] FETCHING ").concat(e.toUpperCase()," Counter"),{reason:s,userId:t})}static logCounterCalculation(e,t,s){if(!this.enabled)return;let a={timestamp:this.getTimestamp(),type:"COUNTER_CALCULATION",counterType:e,breakdown:t,finalCount:s};this.events.push(a),console.log("\uD83D\uDCCA [".concat(a.timestamp,"] ").concat(e.toUpperCase()," Counter Calculated"),{finalCount:s,breakdown:t})}static logEventDispatch(e,t,s){if(!this.enabled)return;let a={timestamp:this.getTimestamp(),type:"EVENT_DISPATCH",eventName:e,source:t,additionalData:s};this.events.push(a),console.log("\uD83D\uDCE1 [".concat(a.timestamp,'] EVENT DISPATCHED: "').concat(e,'"'),{source:t,...s})}static logEventReceived(e,t){if(!this.enabled)return;let s={timestamp:this.getTimestamp(),type:"EVENT_RECEIVED",eventName:e,handler:t};this.events.push(s),console.log("\uD83D\uDCE5 [".concat(s.timestamp,'] EVENT RECEIVED: "').concat(e,'"'),{handler:t})}static logReciprocalAcceptance(e,t,s,a){if(!this.enabled)return;let r={timestamp:this.getTimestamp(),type:"RECIPROCAL_ACCEPTANCE",responseId:e,careType:t,requesterId:s,responderId:a};this.events.push(r),console.log("✅ [".concat(r.timestamp,"] RECIPROCAL RESPONSE ACCEPTED"),{responseId:e,careType:t,requesterId:s,responderId:a,note:"⚠️ Calendar counter should increment for BOTH requester and responder"})}static logOpenBlockAcceptance(e,t,s){if(!this.enabled)return;let a={timestamp:this.getTimestamp(),type:"OPEN_BLOCK_ACCEPTANCE",invitationId:e,acceptorId:t,offererParentId:s};this.events.push(a),console.log("✅ [".concat(a.timestamp,"] OPEN BLOCK ACCEPTED"),{invitationId:e,acceptorId:t,offererParentId:s,note:"⚠️ Calendar counter should increment for BOTH acceptor and offerer"})}static logNotificationCreated(e,t,s){if(!this.enabled)return;let a={timestamp:this.getTimestamp(),type:"NOTIFICATION_CREATED",notificationType:e,recipientUserId:t,data:s};this.events.push(a),console.log("\uD83D\uDD14 [".concat(a.timestamp,"] NOTIFICATION CREATED"),{type:e,recipient:t,data:s})}static logDatabaseError(e,t,s){if(!this.enabled)return;let a={timestamp:this.getTimestamp(),type:"DATABASE_ERROR",operation:e,functionName:t,error:s};this.events.push(a),console.error("❌ [".concat(a.timestamp,"] DATABASE ERROR"),{operation:e,functionName:t,error:s})}static showHistory(){return console.log("\uD83D\uDCDA Counter Debugger Event History:"),console.table(this.events),this.events}static showCounterFlow(){let e=this.events.filter(e=>"COUNTER_FETCH"===e.type||"COUNTER_CALCULATION"===e.type||"EVENT_DISPATCH"===e.type||"EVENT_RECEIVED"===e.type);return console.log("\uD83D\uDD04 Counter Update Flow:"),console.table(e),e}static showEventDispatches(){let e=this.events.filter(e=>"EVENT_DISPATCH"===e.type||"EVENT_RECEIVED"===e.type);return console.log("\uD83D\uDCE1 Event Dispatch Flow:"),console.table(e),e}static showRequesterFlow(e){let t=this.events.filter(t=>t.userId===e||t.requesterId===e||t.offererParentId===e);return console.log("\uD83D\uDC64 Requester Flow for User: ".concat(e)),console.table(t),t}static clear(){this.events=[],console.log("\uD83D\uDDD1️ Counter Debugger history cleared")}static getTimestamp(){let e=((Date.now()-this.sessionStart)/1e3).toFixed(2);return"+".concat(e,"s")}}a.enabled=!0,a.sessionStart=Date.now(),a.events=[],a.init()},4954:function(e,t,s){s.d(t,{h:function(){return c}});var a=s(6689),r=s(5105),n=s(2468);let i="sitter_notification_settings",o={pushEnabled:!0,badgeEnabled:!0,soundEnabled:!0,messagesEnabled:!0,careRequestsEnabled:!0,remindersEnabled:!0},c={isNative:()=>a.dV.isNativePlatform(),getSettings(){try{let e=localStorage.getItem(i);return e?{...o,...JSON.parse(e)}:o}catch(e){return o}},saveSettings(e){try{let t={...this.getSettings(),...e};localStorage.setItem(i,JSON.stringify(t))}catch(e){console.error("Error saving notification settings:",e)}},async requestPermissions(){if(!this.isNative())return console.log("Push notifications only available on native platforms"),!1;try{let e=await r.V.requestPermissions();if("granted"===e.receive)return await r.V.register(),!0;return!1}catch(e){return console.error("Error requesting push permissions:",e),!1}},async checkPermissions(){if(!this.isNative())return"denied";try{return(await r.V.checkPermissions()).receive}catch(e){return console.error("Error checking push permissions:",e),"denied"}},initializeListeners(e,t,s){this.isNative()&&(r.V.addListener("registration",t=>{console.log("Push registration success, token:",t.value),e(t.value)}),r.V.addListener("registrationError",e=>{console.error("Push registration error:",e)}),r.V.addListener("pushNotificationReceived",e=>{console.log("Push notification received:",e),t(e)}),r.V.addListener("pushNotificationActionPerformed",e=>{console.log("Push notification action performed:",e),s(e)}))},removeListeners(){this.isNative()&&r.V.removeAllListeners()},async setBadge(e){if(this.isNative())try{if("ios"===a.dV.getPlatform()){let t=await n.s.checkPermissions();"granted"!==t.display&&await n.s.requestPermissions(),await this.storeBadgeCount(e)}}catch(e){console.error("Error setting badge:",e)}},async storeBadgeCount(e){localStorage.setItem("sitter_badge_count",e.toString())},getBadgeCount(){let e=localStorage.getItem("sitter_badge_count");return e?parseInt(e,10):0},async clearBadge(){await this.setBadge(0)},async showLocalNotification(e,t,s){if(this.isNative())try{let a=await n.s.checkPermissions();if("granted"!==a.display){let e=await n.s.requestPermissions();if("granted"!==e.display)return}await n.s.schedule({notifications:[{id:Date.now(),title:e,body:t,schedule:{at:new Date(Date.now()+100)},extra:s}]})}catch(e){console.error("Error showing local notification:",e)}}}}}]);