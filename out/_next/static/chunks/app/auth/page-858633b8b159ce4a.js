(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[235],{5017:function(e,t,r){Promise.resolve().then(r.bind(r,5869))},5869:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var l=r(7437),s=r(2265),n=r(9376),o=r(2972),i=r.n(o),a=r(3519),d=r(5703);function c(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)([]),[o,c]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),[h,g]=(0,s.useState)(""),[f,p]=(0,s.useState)(""),[x,b]=(0,s.useState)(!1),[N,v]=(0,s.useState)("");(0,s.useEffect)(()=>{r(d.r.getUsers())},[]),(0,s.useEffect)(()=>{let{data:t}=a.O.auth.onAuthStateChange(async(t,r)=>{if("SIGNED_IN"===t&&r)try{let t=r.user.user_metadata,l=null==t?void 0:t.pending_profile,s=null==t?void 0:t.pending_children,n=null==t?void 0:t.pending_pets,{data:o,error:i}=await a.O.from("profiles").select("id, role, full_name, profile_photo_url, email").eq("id",r.user.id).single();if((null==i?void 0:i.code)==="PGRST116"&&l){console.log("Creating profile from pending signup data...");let{error:t}=await a.O.from("profiles").insert({id:r.user.id,...l});if(t?console.error("Error creating profile:",t):console.log("Profile created successfully"),s&&s.length>0){for(let e of s){let{error:t}=await a.O.from("children").insert({full_name:e.name,birthdate:e.birthdate||null,school_name:e.schoolName||null,grade:e.grade||null,town:e.town||null,zip_code:e.zipCode||null,parent_id:r.user.id});t&&console.error("Error creating child:",t)}console.log("Created ".concat(s.length," children"))}if(n&&n.length>0){for(let e of n){let{error:t}=await a.O.from("pets").insert({name:e.name,species:e.species||null,breed:e.breed||null,birthdate:e.birthdate||null,special_needs:e.specialNeeds||null,notes:e.notes||null,parent_id:r.user.id});t&&console.error("Error creating pet:",t)}console.log("Created ".concat(n.length," pets"))}await a.O.auth.updateUser({data:{pending_profile:null,pending_children:null,pending_pets:null}}),d.r.addUser({id:r.user.id,email:r.user.email||l.email||"",fullName:l.full_name||"User",profilePhotoUrl:void 0,lastLoginAt:new Date().toISOString()}),e.replace("/dashboard");return}o?(d.r.addUser({id:r.user.id,email:r.user.email||o.email||"",fullName:o.full_name||"User",profilePhotoUrl:o.profile_photo_url||void 0,lastLoginAt:new Date().toISOString()}),"tutor"===o.role?e.replace("/tutor-dashboard"):e.replace("/dashboard")):e.replace("/dashboard")}catch(t){console.error("Error during sign in:",t),e.replace("/dashboard")}});return()=>{null==t||t.subscription.unsubscribe()}},[e]);let _=e=>{m(e),g(e.email),c(!1),v("")},w=async e=>{e.preventDefault(),v(""),b(!0);try{let{error:e}=await a.O.auth.signInWithPassword({email:h.toLowerCase(),password:f});e&&v(e.message)}catch(e){v(e.message||"An error occurred during sign in")}finally{b(!1)}},j=(e,t)=>{e.stopPropagation(),d.r.removeUser(t),r(d.r.getUsers())},y=()=>{m(null),g(""),p(""),c(!0),v("")},U=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,l.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 px-4",children:(0,l.jsxs)("div",{className:"w-full max-w-md",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-center text-gray-900 mb-6",children:"Welcome Back"}),t.length>0&&o&&!u&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Choose an account"}),(0,l.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,l.jsxs)("div",{onClick:()=>_(e),className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:e.profilePhotoUrl?(0,l.jsx)("img",{src:e.profilePhotoUrl,alt:e.fullName,className:"w-12 h-12 rounded-full object-cover"}):(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-indigo-500 flex items-center justify-center text-white font-medium",children:U(e.fullName)})}),(0,l.jsxs)("div",{className:"ml-3 flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.fullName}),(0,l.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.email})]}),(0,l.jsx)("button",{onClick:t=>j(t,e.id),className:"ml-2 p-1 text-gray-400 hover:text-red-500",title:"Remove from list",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,l.jsx)("button",{onClick:()=>{m(null),g(""),p(""),c(!1),v("")},className:"mt-4 w-full py-2 text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:"Use a different account"})]}),(!o||0===t.length||u)&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[u&&(0,l.jsxs)("div",{className:"flex items-center mb-6 pb-4 border-b",children:[u.profilePhotoUrl?(0,l.jsx)("img",{src:u.profilePhotoUrl,alt:u.fullName,className:"w-10 h-10 rounded-full object-cover"}):(0,l.jsx)("div",{className:"w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-medium text-sm",children:U(u.fullName)}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-900",children:u.fullName}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:u.email})]})]}),(0,l.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[!u&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),(0,l.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"username email",autoCapitalize:"none",autoCorrect:"off",required:!0,value:h,onChange:e=>g(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,l.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:f,onChange:e=>p(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base"})]}),N&&(0,l.jsx)("div",{className:"rounded-md bg-red-50 p-3",children:(0,l.jsx)("p",{className:"text-sm text-red-700",children:N})}),(0,l.jsx)("button",{type:"submit",disabled:x,className:"w-full py-3 px-4 bg-indigo-600 text-white font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Signing in...":"Sign In"})]}),u&&t.length>1&&(0,l.jsx)("button",{onClick:y,className:"mt-4 w-full py-2 text-sm text-gray-600 hover:text-gray-700",children:"Switch account"}),!u&&t.length>0&&(0,l.jsx)("button",{onClick:y,className:"mt-4 w-full py-2 text-sm text-gray-600 hover:text-gray-700",children:"Back to saved accounts"})]}),(0,l.jsxs)("div",{className:"mt-6 text-center text-sm text-gray-600",children:["Don't have an account?"," ",(0,l.jsx)(i(),{href:"/signup",className:"text-indigo-600 hover:text-indigo-500 font-medium",children:"Sign up"})]})]})})}},3519:function(e,t,r){"use strict";r.d(t,{O:function(){return d}});var l=r(1545);let{supabaseUrl:s,supabaseAnonKey:n,appEnv:o,appUrl:i,nodeEnv:a}=function(){let e={NEXT_PUBLIC_SUPABASE_URL:"https://hilkelodfneancwwzvoh.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhpbGtlbG9kZm5lYW5jd3d6dm9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjk2OTEsImV4cCI6MjA3NDc0NTY5MX0.MoVQTvTpYcus2xpIZayAXxsCRgNgV8CoP69ZPd6locw",NEXT_PUBLIC_APP_ENV:"development",NEXT_PUBLIC_APP_URL:"http://localhost:3000",NODE_ENV:"production"},t=Object.entries(e).filter(e=>{let[t,r]=e;return!r}).map(e=>{let[t]=e;return t});if(t.length>0)throw Error("Missing required environment variables: ".concat(t.join(", "),"\n")+"Please check your .env file and ensure all required variables are set.");return{supabaseUrl:e.NEXT_PUBLIC_SUPABASE_URL,supabaseAnonKey:e.NEXT_PUBLIC_SUPABASE_ANON_KEY,appEnv:e.NEXT_PUBLIC_APP_ENV,appUrl:e.NEXT_PUBLIC_APP_URL,nodeEnv:e.NODE_ENV}}();"development"===o&&console.log("\uD83D\uDD27 Environment Configuration:",{env:o,supabaseUrl:s.replace(/\/\/.*@/,"//***@"),appUrl:i,nodeEnv:a});let d=(0,l.eI)(s,n,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{headers:{"X-Client-Info":"sitter-app-".concat(o)}}})},5703:function(e,t,r){"use strict";r.d(t,{r:function(){return s}});let l="sitter_remembered_users",s={getUsers(){try{let e=localStorage.getItem(l);return e?JSON.parse(e):[]}catch(e){return[]}},addUser(e){try{let t=this.getUsers().filter(t=>t.id!==e.id),r=[{...e,lastLoginAt:new Date().toISOString()},...t].slice(0,5);localStorage.setItem(l,JSON.stringify(r))}catch(e){console.error("Error saving remembered user:",e)}},removeUser(e){try{let t=this.getUsers().filter(t=>t.id!==e);localStorage.setItem(l,JSON.stringify(t))}catch(e){console.error("Error removing remembered user:",e)}},clearAll(){try{localStorage.removeItem(l)}catch(e){console.error("Error clearing remembered users:",e)}}}}},function(e){e.O(0,[256,972,971,117,744],function(){return e(e.s=5017)}),_N_E=e.O()}]);