(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[329],{3825:function(e,t,r){Promise.resolve().then(r.bind(r,7104))},7104:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P}});var a=r(7437),s=r(2265),i=r(9376),n=r(7988),o=r(1559),l=r(6125),d=r(1344),c=r(15),u=r(5595),p=r(572),m=r(5463),g=r(4613),h=r(5721),x=r(3521),_=r(3519),f=r(415),y=r(2644),b=r(7506),v=r(166),w=r(8151);class j{async requestPermissions(){try{let e=await w.b.requestPermissions();return"granted"===e.location}catch(e){return console.error("Error requesting location permissions:",e),!1}}async checkPermissions(){try{let e=await w.b.checkPermissions();return"granted"===e.location}catch(e){return console.error("Error checking location permissions:",e),!1}}async getCurrentLocation(){try{if(!await this.checkPermissions()&&!await this.requestPermissions())throw Error("Location permission not granted");let e=await w.b.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return this.formatPosition(e)}catch(e){return console.error("Error getting current location:",e),null}}async startTracking(e){try{if(!await this.checkPermissions()&&!await this.requestPermissions())throw Error("Location permission not granted");return this.isTracking&&await this.stopTracking(),this.currentSession=e,this.isTracking=!0,this.watchId=await w.b.watchPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:0},(e,t)=>{if(t){console.error("Location tracking error:",t);return}e&&this.isTracking&&this.currentSession&&this.handleLocationUpdate(e)}),console.log("Location tracking started for session:",e.sessionId),!0}catch(e){return console.error("Error starting location tracking:",e),!1}}async stopTracking(){try{this.watchId&&(await w.b.clearWatch({id:this.watchId}),this.watchId=null),this.isTracking=!1,this.currentSession=null,console.log("Location tracking stopped")}catch(e){console.error("Error stopping location tracking:",e)}}async handleLocationUpdate(e){if(!this.currentSession)return;let t=this.formatPosition(e);try{let{data:e,error:r}=await _.O.rpc("update_location",{p_session_id:this.currentSession.sessionId,p_latitude:t.latitude,p_longitude:t.longitude,p_accuracy:t.accuracy,p_altitude:t.altitude,p_heading:t.heading,p_speed:t.speed});r?console.error("Error updating location:",r):console.log("Location updated successfully")}catch(e){console.error("Error sending location update:",e)}}formatPosition(e){return{latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,altitude:e.coords.altitude,heading:e.coords.heading,speed:e.coords.speed,timestamp:e.timestamp}}async requestDropoff(e,t){try{let{data:r,error:a}=await _.O.rpc("request_dropoff",{p_scheduled_care_id:e,p_receiver_id:t});if(a)throw a;return r}catch(e){throw console.error("Error requesting drop-off:",e),e}}async confirmDropoff(e,t,r){try{let{data:a,error:s}=await _.O.rpc("confirm_dropoff",{p_session_id:e,p_provider_id:t,p_provider_scheduled_care_id:r});if(s)throw s;return a.success&&await this.startTracking({sessionId:e,scheduledCareId:r,providerId:t,receiverId:"",status:"active"}),a}catch(e){throw console.error("Error confirming drop-off:",e),e}}async requestPickup(e,t){try{let{data:r,error:a}=await _.O.rpc("request_pickup",{p_session_id:e,p_receiver_id:t});if(a)throw a;return r}catch(e){throw console.error("Error requesting pick-up:",e),e}}async confirmPickup(e,t){try{let{data:r,error:a}=await _.O.rpc("confirm_pickup",{p_session_id:e,p_provider_id:t});if(a)throw a;return r.success&&await this.stopTracking(),r}catch(e){throw console.error("Error confirming pick-up:",e),e}}async getActiveTrackingSessions(e){try{let{data:t,error:r}=await _.O.rpc("get_active_tracking_sessions",{p_user_id:e});if(r)throw r;return t||[]}catch(e){return console.error("Error getting active tracking sessions:",e),[]}}async getLatestLocation(e){try{let{data:t,error:r}=await _.O.rpc("get_latest_location",{p_session_id:e});if(r)throw r;if(t.success&&t.location)return{latitude:t.location.latitude,longitude:t.location.longitude,accuracy:t.location.accuracy,altitude:t.location.altitude,heading:t.location.heading,speed:t.location.speed,timestamp:new Date(t.location.recorded_at).getTime()};return null}catch(e){return console.error("Error getting latest location:",e),null}}subscribeToLocationUpdates(e,t){let r=_.O.channel("location_updates:".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"location_updates",filter:"session_id=eq.".concat(e)},e=>{t({latitude:e.new.latitude,longitude:e.new.longitude,accuracy:e.new.accuracy,altitude:e.new.altitude,heading:e.new.heading,speed:e.new.speed,timestamp:new Date(e.new.recorded_at).getTime()})}).subscribe();return()=>{_.O.removeChannel(r)}}isCurrentlyTracking(){return this.isTracking}getCurrentSession(){return this.currentSession}constructor(){this.watchId=null,this.currentSession=null,this.updateInterval=1e4,this.isTracking=!1}}let N=new j,k=(0,v.default)(()=>r.e(486).then(r.bind(r,7486)),{loadableGenerated:{webpack:()=>[7486]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center",style:{height:"300px"},children:(0,a.jsx)("p",{className:"text-gray-500",children:"Loading map..."})})});function D(e){let{scheduledCareId:t,currentUserId:r,isProvider:i,careDate:n,startTime:o,endTime:l}=e,{t:d}=(0,b.$G)(),[c,u]=(0,s.useState)(null),[p,m]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null),[x,f]=(0,s.useState)(""),{isTracking:y,activeSessions:v,hasPermission:w,loading:j,error:D,requestDropoff:C,confirmDropoff:E,requestPickup:S,confirmPickup:P,refreshActiveSessions:T,requestPermissions:q}=function(e){let[t,r]=(0,s.useState)(!1),[a,i]=(0,s.useState)(null),[n,o]=(0,s.useState)(null),[l,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!1),[p,m]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{x()},[]),(0,s.useEffect)(()=>{e&&_()},[e]),(0,s.useEffect)(()=>{let e=N.isCurrentlyTracking(),t=N.getCurrentSession();r(e),i(t)},[]);let x=async()=>{try{let e=await N.checkPermissions();u(e)}catch(e){console.error("Error checking permissions:",e)}},_=async()=>{if(e)try{m(!0),h(null);let t=await N.getActiveTrackingSessions(e);d(t)}catch(e){h(e.message||"Error loading active sessions")}finally{m(!1)}},f=async e=>{try{if(m(!0),h(null),!c){if(!await N.requestPermissions())throw Error("Location permission not granted");u(!0)}if(!await N.startTracking(e))throw Error("Failed to start tracking");r(!0),i(e)}catch(e){throw h(e.message||"Error starting tracking"),e}finally{m(!1)}};return{isTracking:t,currentSession:a,latestLocation:n,activeSessions:l,hasPermission:c,loading:p,error:g,requestDropoff:async(e,t)=>{try{m(!0),h(null);let r=await N.requestDropoff(e,t);if(!r.success)throw Error(r.error||"Failed to request drop-off");await _()}catch(e){throw h(e.message||"Error requesting drop-off"),e}finally{m(!1)}},confirmDropoff:async(e,t,a)=>{try{m(!0),h(null);let s=await N.confirmDropoff(e,t,a);if(!s.success)throw Error(s.error||"Failed to confirm drop-off");r(!0),i(N.getCurrentSession()),await _()}catch(e){throw h(e.message||"Error confirming drop-off"),e}finally{m(!1)}},requestPickup:async(e,t)=>{try{m(!0),h(null);let r=await N.requestPickup(e,t);if(!r.success)throw Error(r.error||"Failed to request pick-up");await _()}catch(e){throw h(e.message||"Error requesting pick-up"),e}finally{m(!1)}},confirmPickup:async(e,t)=>{try{m(!0),h(null);let a=await N.confirmPickup(e,t);if(!a.success)throw Error(a.error||"Failed to confirm pick-up");r(!1),i(null),o(null),await _()}catch(e){throw h(e.message||"Error confirming pick-up"),e}finally{m(!1)}},startTracking:f,stopTracking:async()=>{try{m(!0),h(null),await N.stopTracking(),r(!1),i(null),o(null)}catch(e){throw h(e.message||"Error stopping tracking"),e}finally{m(!1)}},refreshActiveSessions:_,requestPermissions:async()=>{try{m(!0),h(null);let e=await N.requestPermissions();u(e),e||h("Location permission denied")}catch(e){h(e.message||"Error requesting permissions")}finally{m(!1)}}}}(r),{location:O}=function(e){let[t,r]=(0,s.useState)(null),[a,i]=(0,s.useState)(!1),[n,o]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!e){r(null);return}i(!0),N.getLatestLocation(e).then(e=>{r(e),i(!1)}).catch(e=>{o(e.message),i(!1)});let t=N.subscribeToLocationUpdates(e,e=>{r(e)});return()=>{t()}},[e]),{location:t,loading:a,error:n}}(null==c?void 0:c.session_id);(0,s.useEffect)(()=>{I()},[v,t]),(0,s.useEffect)(()=>{let e=setInterval(()=>{T()},1e4);return()=>clearInterval(e)},[T]);let I=async()=>{let e=v.find(e=>e.scheduled_care_id===t);if(u(e),e){let t=e.provider_id===r?e.receiver_id:e.provider_id;if(t&&t!==r){let{data:e}=await _.O.from("profiles").select("full_name").eq("id",t).single();e&&f(e.full_name)}}},L=async()=>{console.log("=== Drop-off Request (SIMPLIFIED) ==="),console.log("scheduledCareId:",t),console.log("currentUserId (receiver):",r);try{await C(t,r),m(!1),await T()}catch(e){console.error("Error requesting drop-off:",e)}},F=async()=>{if(c){if(!w&&(await q(),!w)){alert("Location permission is required to start tracking");return}console.log("=== Confirm Drop-off (SIMPLIFIED) ==="),console.log("session_id:",c.session_id),console.log("currentUserId (provider):",r),console.log("scheduledCareId (provider):",t);try{await E(c.session_id,r,t),m(!1),await T()}catch(e){console.error("Error confirming drop-off:",e)}}},M=async()=>{if(c){console.log("=== Pick-up Request (SIMPLIFIED) ==="),console.log("session_id:",c.session_id),console.log("currentUserId (receiver):",r);try{await S(c.session_id,r),m(!1),await T()}catch(e){console.error("Error requesting pick-up:",e)}}},R=async()=>{if(c){console.log("=== Confirm Pick-up (SIMPLIFIED) ==="),console.log("session_id:",c.session_id),console.log("currentUserId (provider):",r);try{await P(c.session_id,r),m(!1),await T()}catch(e){console.error("Error confirming pick-up:",e)}}},A=e=>{h(e),m(!0)},U=(()=>{if(!c)return i?null:{text:d("dropOff"),icon:"\uD83D\uDCCD",color:"bg-blue-500 hover:bg-blue-600",action:()=>A("dropoff"),disabled:!1,description:d("notifyProviderDropOff")};let e=c.status;return"pending_dropoff"===e?i?{text:d("confirmDropOff"),icon:"✓",color:"bg-green-500 hover:bg-green-600",action:F,disabled:!1,description:x?d("hasIndicatedDropOff",{name:x}):d("confirmDropOffStart")}:{text:d("waitingForConfirmation"),icon:"⏳",color:"bg-gray-400",action:()=>{},disabled:!0,description:d("waitingForProvider")}:"active"===e?i?{text:d("trackingActive"),icon:"\uD83D\uDCE1",color:"bg-green-500",action:()=>{},disabled:!0,description:d("locationSharingActive")}:{text:d("pickUp"),icon:"\uD83C\uDFE0",color:"bg-orange-500 hover:bg-orange-600",action:()=>A("pickup"),disabled:!1,description:d("notifyProviderPickUp")}:"pending_pickup"===e?i?{text:d("confirmPickUp"),icon:"✓",color:"bg-green-500 hover:bg-green-600",action:R,disabled:!1,description:x?d("hasIndicatedPickUp",{name:x}):d("confirmPickUpStop")}:{text:d("waitingForConfirmation"),icon:"⏳",color:"bg-gray-400",action:()=>{},disabled:!0,description:d("waitingForProvider")}:null})();return console.log("=== LocationTrackingPanel Render (SIMPLIFIED) ==="),console.log("currentUserId:",r),console.log("isProvider (from care_type):",i),console.log("scheduledCareId:",t),console.log("activeSession:",c),console.log("buttonConfig:",U),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"border-b pb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:d("locationTracking")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[n," • ",o," - ",l]})]}),c&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 rounded-lg p-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("active"===c.status?"bg-green-500 animate-pulse":"pending_dropoff"===c.status||"pending_pickup"===c.status?"bg-yellow-500":"bg-gray-400")}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["active"===c.status&&"Tracking Active","pending_dropoff"===c.status&&"Awaiting Drop-Off Confirmation","pending_pickup"===c.status&&"Awaiting Pick-Up Confirmation"]}),c.dropoff_confirmed_at&&(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Started: ",new Date(c.dropoff_confirmed_at).toLocaleTimeString()]}),x&&(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["With: ",x]})]})]}),c&&"active"===c.status&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k,{location:O,providerName:c.provider_id===r?"You":x,height:"300px",showAccuracy:!0}),O&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 text-center",children:["Last updated: ",new Date(O.timestamp).toLocaleString()]})]}),U&&(0,a.jsxs)("div",{className:"space-y-2",children:[U.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 text-center",children:U.description}),(0,a.jsxs)("button",{onClick:U.action,disabled:U.disabled||j,className:"w-full ".concat(U.color," text-white font-semibold py-3 px-4 rounded-lg\n              transition duration-200 flex items-center justify-center space-x-2\n              disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,a.jsx)("span",{className:"text-xl",children:U.icon}),(0,a.jsx)("span",{children:j?"Processing...":U.text})]})]}),!w&&c&&"pending_dropoff"===c.status&&c.provider_id===r&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Location permission is required to start tracking"}),(0,a.jsx)("button",{onClick:q,className:"mt-2 text-sm text-yellow-900 underline",children:"Grant Permission"})]}),D&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,a.jsx)("p",{className:"text-sm text-red-800",children:D})}),p&&g&&(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"dropoff"===g?"Confirm Drop-Off":"Confirm Pick-Up"}),(0,a.jsx)("p",{className:"text-gray-600",children:"dropoff"===g?(0,a.jsx)(a.Fragment,{children:"Are you dropping off your child? The provider will be notified to confirm and start location sharing."}):(0,a.jsx)(a.Fragment,{children:"Are you picking up your child? The provider will be notified to confirm and stop location sharing."})}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:()=>m(!1),className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition",children:"Cancel"}),(0,a.jsx)("button",{onClick:"dropoff"===g?L:M,className:"flex-1 ".concat("dropoff"===g?"bg-blue-500 hover:bg-blue-600":"bg-orange-500 hover:bg-orange-600"," text-white font-semibold py-2 px-4 rounded-lg transition"),disabled:j,children:j?"Processing...":"Confirm"})]})]})})]})}var C=r(7072);function E(e){let t,{selectedCare:r}=e,{t:i,i18n:n}=(0,b.$G)(),[o,l]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{u()},[]);let u=async()=>{try{let{data:{user:e}}=await _.O.auth.getUser();if(!e)return;l(e)}catch(e){console.error("Error loading user:",e)}finally{c(!1)}};if(!o||d)return(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200 text-center py-4",children:(0,a.jsx)("p",{className:"text-gray-500",children:i("loadingLocationTracking")})});let p="provided"===r.care_type;return(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsx)(D,{scheduledCareId:r.id,currentUserId:o.id,isProvider:p,careDate:(t=r.care_date,(0,f.o8)(t,n.language)),startTime:(0,f.mr)(r.start_time),endTime:(0,f.mr)(r.end_time)})})}function S(){let{t:e,i18n:t}=(0,b.$G)(),r=e=>(0,f.o8)(e,t.language),[v,w]=(0,s.useState)(new Date),[j,N]=(0,s.useState)("all"),k=(e,t)=>{if(!e)return t;let r=e.match(/\[Next-day care: Actual end time is ([0-9]{2}:[0-9]{2})\]/);return r?r[1]:t},[D,S]=(0,s.useState)(null),[P,T]=(0,s.useState)("monthly"),[q,O]=(0,s.useState)([]),[I,L]=(0,s.useState)(!0),[F,M]=(0,s.useState)(null),[R,A]=(0,s.useState)(null),[U,Z]=(0,s.useState)(!1),[B,H]=(0,s.useState)(!1),[G,W]=(0,s.useState)(!1),[z,Y]=(0,s.useState)(!1),[V,$]=(0,s.useState)(!1),[J,Q]=(0,s.useState)([]),[K,X]=(0,s.useState)([]),[ee,et]=(0,s.useState)([]),[er,ea]=(0,s.useState)([]),[es,ei]=(0,s.useState)({type:"care",group_id:"",child_id:"",date:"",start_time:"",end_time:"",end_date:"",hosting_child_ids:[],invited_child_ids:[],notes:""}),[en,eo]=(0,s.useState)({invitedParents:[],reciprocalTimes:[]}),[el,ed]=(0,s.useState)([]),[ec,eu]=(0,s.useState)(!1),[ep,em]=(0,s.useState)(null),[eg,eh]=(0,s.useState)(!1),[ex,e_]=(0,s.useState)(null),ef=(0,i.useSearchParams)();(0,s.useEffect)(()=>{let e=ef.get("date");if(e){let t=new Date(e);S(t),w(t)}else S(new Date)},[ef]),(0,s.useEffect)(()=>{let e=ef.get("selectBlock");if(e&&q.length>0){let t=q.find(t=>t.id===e);t&&(A(t),Z(!0))}},[ef,q]),(0,s.useEffect)(()=>{if("weekly"===P&&D){let e=eE(D),t=(0,n.Z)(D,new Date),r=6;e.length>0?r=e.reduce((e,t)=>Math.min(e,parseInt(t.start_time.split(":")[0])),24):t&&(r=Math.max(6,new Date().getHours()+1)),setTimeout(()=>{let e=document.getElementById("hour-".concat(r));e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)}},[P,D]),(0,s.useEffect)(()=>{ey(),eH()},[v]),(0,s.useEffect)(()=>{if(I||0===q.length)return;let e=setTimeout(async()=>{let e=localStorage.getItem("seenCalendarAcceptances"),t=e?new Set(JSON.parse(e)):new Set;q.forEach(e=>{e.related_request_id&&t.add("reciprocal-".concat(e.related_request_id)),t.add("block-".concat(e.id))}),localStorage.setItem("seenCalendarAcceptances",JSON.stringify(Array.from(t))),localStorage.setItem("newCalendarBlocksCount","0");try{let{data:{user:e}}=await _.O.auth.getUser();if(e){let{error:t}=await _.O.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("type","care_accepted").eq("is_read",!1);t&&console.error("Error marking care_accepted notifications as read:",t)}}catch(e){console.error("Error updating notifications:",e)}window.dispatchEvent(new Event("calendarCountUpdated"))},2e3);return()=>clearTimeout(e)},[I,q]),(0,s.useEffect)(()=>{let e=e=>{ey()};return window.addEventListener("careNotesUpdated",e),()=>{window.removeEventListener("careNotesUpdated",e)}},[]),(0,s.useEffect)(()=>{let e=_.O.channel("scheduled_care_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"scheduled_care"},e=>{ey()}).subscribe();return()=>{_.O.removeChannel(e)}},[]),(0,s.useEffect)(()=>{(async()=>{if(U&&R&&R.has_unseen_updates)try{let{data:{user:e}}=await _.O.auth.getUser();if(!e)return;"pet"===R.care_category?await _.O.rpc("mark_scheduled_pet_care_viewed",{p_scheduled_pet_care_id:R.id,p_user_id:e.id}):await _.O.rpc("mark_scheduled_care_viewed",{p_scheduled_care_id:R.id,p_user_id:e.id}),O(e=>e.map(e=>e.id===R.id?{...e,has_unseen_updates:!1}:e)),A(e=>e?{...e,has_unseen_updates:!1}:null),window.dispatchEvent(new CustomEvent("calendarBlockViewed"))}catch(e){console.error("Error marking block as viewed:",e)}})()},[U,null==R?void 0:R.id]),(0,s.useEffect)(()=>{es.group_id?eG(es.group_id):X([])},[es.group_id]);let ey=async()=>{try{L(!0);let{data:{user:e}}=await _.O.auth.getUser();if(!e){M("User not authenticated");return}let t=(0,o.Z)(v),r=(0,l.Z)(v),[a,s]=await Promise.all([_.O.rpc("get_scheduled_care_for_calendar",{p_parent_id:e.id,p_start_date:t.toISOString().split("T")[0],p_end_date:r.toISOString().split("T")[0]}),_.O.rpc("get_scheduled_pet_care_for_calendar",{p_parent_id:e.id,p_start_date:t.toISOString().split("T")[0],p_end_date:r.toISOString().split("T")[0]})]);a.error&&console.error("Error fetching child care:",a.error),s.error&&console.error("Error fetching pet care:",s.error);let i=(a.data||[]).map(e=>({...e,care_category:"child"})),n=(s.data||[]).map(e=>({...e,care_category:"pet"})),d=[...i,...n];O(d)}catch(e){M("Error fetching scheduled care"),console.error("Error fetching scheduled care:",e)}finally{L(!1)}},eb=async e=>new Promise((t,r)=>{let a=new FileReader;a.onload=e=>{var a;let s=new Image;s.onload=()=>{let e=document.createElement("canvas"),a=s.width,i=s.height;a>i?a>1920&&(i=Math.round(1920*i/a),a=1920):i>1920&&(a=Math.round(1920*a/i),i=1920),e.width=a,e.height=i;let n=e.getContext("2d");if(!n){r(Error("Failed to get canvas context"));return}n.drawImage(s,0,0,a,i),e.toBlob(e=>{e?t(e):r(Error("Failed to compress image"))},"image/jpeg",.8)},s.onerror=()=>r(Error("Failed to load image")),s.src=null===(a=e.target)||void 0===a?void 0:a.result},a.onerror=()=>r(Error("Failed to read file")),a.readAsDataURL(e)}),ev=async e=>{if(R){eh(!0),e_(null);try{let{data:{user:t}}=await _.O.auth.getUser();if(!t){e_("Please log in to upload photos");return}if(!e.type.startsWith("image/")){e_("Please select an image file");return}if(e.size>10485760){e_("Image file is too large. Please select an image under 10MB.");return}let r=await eb(e),a=new File([r],e.name,{type:"image/jpeg"}),s="".concat(t.id,"/").concat(R.id,"/").concat(Date.now(),"_").concat(e.name.replace(/[^a-zA-Z0-9.-]/g,"_")),{data:i,error:n}=await _.O.storage.from("care-photos").upload(s,a,{cacheControl:"3600",upsert:!1});if(n){console.error("Upload error:",n),e_("Failed to upload photo. Please try again.");return}let{data:{publicUrl:o}}=_.O.storage.from("care-photos").getPublicUrl(s),l=[...R.photo_urls||[],o],d="pet"===R.care_category?"scheduled_pet_care":"scheduled_care",{error:c}=await _.O.from(d).update({photo_urls:l,last_updated_by:t.id,last_updated_at:new Date().toISOString()}).eq("id",R.id);if(c){console.error("Error updating photo URLs:",c),e_("Failed to save photo reference. Please try again.");return}A(e=>e?{...e,photo_urls:l}:null),await ey();try{let{error:e}=await _.O.rpc("notify_photo_upload",{p_scheduled_care_id:R.id,p_uploader_id:t.id,p_photo_count:l.length});e&&console.error("Error sending notification:",e)}catch(e){console.error("Error sending notification:",e)}alert("Photo uploaded successfully!")}catch(e){console.error("Photo upload error:",e),e_("Failed to upload photo. Please try again.")}finally{eh(!1)}}},ew=async e=>{if(R&&confirm("Are you sure you want to delete this photo?"))try{let{data:{user:t}}=await _.O.auth.getUser();if(!t)return;let r=e.split("/care-photos/");if(r.length<2)return;let a=r[1],{error:s}=await _.O.storage.from("care-photos").remove([a]);if(s){console.error("Error deleting photo:",s),alert("Failed to delete photo. Please try again.");return}let i=(R.photo_urls||[]).filter(t=>t!==e),n="pet"===R.care_category?"scheduled_pet_care":"scheduled_care",{data:{user:o}}=await _.O.auth.getUser(),l={photo_urls:i,last_updated_by:null==o?void 0:o.id,last_updated_at:new Date().toISOString()};if("provided"===R.care_type){let{error:e}=await _.O.from(n).update(l).eq("id",R.id);if(e){console.error("Error updating photo URLs:",e);return}await _.O.from(n).update(l).eq("related_request_id",R.related_request_id).in("care_type",["needed","received"]).neq("id",R.id)}else{let{error:e}=await _.O.from(n).update(l).eq("id",R.id);if(e){console.error("Error updating photo URLs:",e);return}}A(e=>e?{...e,photo_urls:i}:null),await ey(),alert("Photo deleted successfully!")}catch(e){console.error("Photo deletion error:",e),alert("Failed to delete photo. Please try again.")}},ej=(e,t)=>{let r="".concat(e.toString().padStart(2,"0"),":00"),a="".concat((e+1).toString().padStart(2,"0"),":00");S(t),ei({type:"care",group_id:"",child_id:"",date:(0,p.Z)(t,"yyyy-MM-dd"),start_time:r,end_time:a,notes:"",event_title:""}),Y(!0)},eN=e=>{S(e),T("weekly")},ek=e=>{w(t=>"next"===e?(0,m.Z)(t,1):(0,g.Z)(t,1))},eD=e=>{if(D){let t="next"===e?(0,h.Z)(D,7):(0,h.Z)(D,-7);S(t),w(t)}},eC=(0,C.QS)({onSwipedLeft:()=>{"weekly"===P?eD("next"):ek("next")},onSwipedRight:()=>{"weekly"===P?eD("prev"):ek("prev")},trackMouse:!1,preventScrollOnSwipe:!1,delta:50}),eE=e=>q.filter(t=>{let r=(0,f.DG)(t.care_date),a=(0,f.L9)(e),s=r===a;if("pet"===t.care_category&&t.end_date){let e=(0,f.DG)(t.end_date),i=new Date(a),n=new Date(r),o=new Date(e);s=i>=n&&i<=o}let i="all"===j||"children"===j&&"child"===t.care_category||"pets"===j&&"pet"===t.care_category;return s&&i}).reduce((e,t)=>{let r=e.find(e=>e.care_date===t.care_date&&e.start_time===t.start_time&&e.end_time===t.end_time&&e.care_type===t.care_type&&e.group_name===t.group_name);return r?(r.children_count+=t.children_count,t.children_names&&t.children_names.length>0&&(r.children_names=[...new Set([...r.children_names,...t.children_names])])):e.push(t),e},[]),eS=async e=>{Z(!1),W(!0),await eq(e.id)},eP=async e=>{try{var t;let{data:r,error:a}=await _.O.from("scheduled_care").select("\n          group_id,\n          related_request_id,\n          scheduled_care_children(\n            child_id,\n            children(id, full_name)\n          )\n        ").eq("id",e.id).single();if(a){console.error("Error fetching care block data:",a),M("Error loading care block details");return}let s={...e,group_id:r.group_id,related_request_id:r.related_request_id,children_data:(null===(t=r.scheduled_care_children)||void 0===t?void 0:t.map(e=>({id:e.children.id,full_name:e.children.full_name})))||[]};A(s),Z(!1),$(!0)}catch(e){console.error("Error in handleReschedule:",e),M("Error loading care block details")}},eT=async()=>{$(!1),await ey()},eq=async e=>{try{eu(!0);let{data:{user:t}}=await _.O.auth.getUser();if(!t)return;let{data:r,error:a}=await _.O.from("scheduled_care").select("group_id, parent_id").eq("id",e).single();if(a){M("Error fetching care block");return}let{data:s,error:i}=await _.O.from("scheduled_care_children").select("child_id").eq("scheduled_care_id",e);if(i){M("Error fetching block children");return}let n=new Set((s||[]).map(e=>e.child_id)),{data:o,error:l}=await _.O.from("child_group_members").select("child_id").eq("group_id",r.group_id).eq("active",!0);if(l){M("Error fetching active children");return}let d=(o||[]).map(e=>e.child_id),{data:c,error:u}=await _.O.from("children").select("\n          id,\n          full_name,\n          parent_id,\n          profiles!inner(id, full_name)\n        ").in("id",d);if(u){M("Error fetching children details");return}let p=new Set(c.filter(e=>Array.from(n).includes(e.id)).map(e=>e.parent_id));p.add(t.id),p.add(r.parent_id);let m=c.filter(e=>!Array.from(n).includes(e.id)).filter(e=>!p.has(e.parent_id)).filter(e=>e.parent_id!==t.id).map(e=>({id:e.id,full_name:e.full_name})),g=(await Promise.all(m.map(async e=>{let{data:t,error:a}=await _.O.from("child_group_members").select("active").eq("child_id",e.id).eq("group_id",r.group_id).single();if(a||!t.active)return null;let{data:s,error:i}=await _.O.from("children").select("parent_id").eq("id",e.id).single();if(i)return null;let{data:n,error:o}=await _.O.from("profiles").select("id, full_name").eq("id",s.parent_id).single();if(o)return null;let{data:l,error:d}=await _.O.from("group_members").select("status").eq("group_id",r.group_id).eq("profile_id",n.id).single();return d?null:"active"===l.status?{id:n.id,name:n.full_name,children:[e]}:null}))).filter(e=>null!==e);ed(g)}catch(e){M("Error fetching available parents")}finally{eu(!1)}},eO=e=>{eo(t=>{let r=t.reciprocalTimes[e];return(null==r?void 0:r.parentId)?{...t,invitedParents:t.invitedParents.filter(e=>e.id!==r.parentId),reciprocalTimes:t.reciprocalTimes.filter((t,r)=>r!==e)}:{...t,reciprocalTimes:t.reciprocalTimes.filter((t,r)=>r!==e)}})},eI=(e,t,r)=>{eo(a=>({...a,reciprocalTimes:a.reciprocalTimes.map((a,s)=>s===e?{...a,[t]:r}:a)}))},eL=e=>{eo(t=>{if(!t.invitedParents.some(t=>t.id===e.id))return{...t,invitedParents:[...t.invitedParents,e],reciprocalTimes:[...t.reciprocalTimes,{date:"",startTime:"",endTime:"",notes:"",parentId:e.id}]};{let r=t.invitedParents.findIndex(t=>t.id===e.id);return{...t,invitedParents:t.invitedParents.filter(t=>t.id!==e.id),reciprocalTimes:t.reciprocalTimes.filter((e,t)=>t!==r)}}})},eF=async()=>{if(!R||0===en.invitedParents.length)return;let e=new Date;for(let t of en.reciprocalTimes)if(new Date("".concat(t.date,"T").concat(t.startTime,":00"))<=e){alert("Cannot schedule reciprocal care in the past. Please select future dates and times for all reciprocal time blocks.");return}try{let{data:{user:e}}=await _.O.auth.getUser();if(!e)return;let{data:t,error:r}=await _.O.rpc("create_open_block_invitation",{p_existing_block_id:R.id,p_inviting_parent_id:e.id,p_invited_parent_ids:en.invitedParents.map(e=>e.id),p_reciprocal_dates:en.reciprocalTimes.map(e=>e.date),p_reciprocal_start_times:en.reciprocalTimes.map(e=>e.startTime),p_reciprocal_end_times:en.reciprocalTimes.map(e=>e.endTime),p_notes:en.notes||""});if(r){console.error("❌ Error creating open block invitations:",r),alert("Error creating open block invitations: "+r.message);return}alert("Open block invitations have been sent"),W(!1),Z(!1),A(null),eo({invitedParents:[],reciprocalTimes:[]}),await ey()}catch(e){console.error("❌ Exception in handleCreateOpenBlock:",e),M("Error creating open block"),alert("Error creating open block invitations")}},eM=e=>e.substring(0,5),eR=(e,t)=>{let r;if(!e||!t)return{duration:0,isNextDay:!1,error:null};let[a,s]=e.split(":").map(Number),[i,n]=t.split(":").map(Number),o=60*a+s,l=60*i+n,d=!1;l>=o?r=l-o:(r=1440-o+l,d=!0);let c=r/60;return r>1439?{duration:c,isNextDay:d,error:"Maximum duration is 23 hours and 59 minutes"}:{duration:c,isNextDay:d,error:null}},eA=(e,t)=>{if(!e||!t)return em(null),!0;let r=eR(e,t);return r.error?(em(r.error),!1):(em(null),!0)},eU=(e,t,r)=>e&&t&&r&&eR(t,r).isNextDay?new Date(new Date(e+"T00:00:00").getTime()+864e5):null,eZ=(e,t)=>{if("pet"!==e.care_category||!e.end_date)return{isMultiDay:!1,isFirstDay:!1,isLastDay:!1,dayNumber:1,totalDays:1};let r=(0,f.DG)(e.care_date),a=(0,f.DG)(e.end_date),s=(0,f.L9)(t),i=new Date(r),n=new Date(a),o=new Date(s),l=o.getTime()===i.getTime();return{isMultiDay:!0,isFirstDay:l,isLastDay:o.getTime()===n.getTime(),dayNumber:Math.floor((o.getTime()-i.getTime())/864e5)+1,totalDays:Math.floor((n.getTime()-i.getTime())/864e5)+1}},eB=(e,t,r,a,s)=>{if("rescheduled"===t)return"bg-orange-100 border border-orange-300 text-orange-800";if("pet"===s)return"provided"===e?"bg-orange-100 border border-orange-300 text-orange-800":"bg-purple-100 border border-purple-300 text-purple-800";if("hangout"===e||"sleepover"===e)return a?"bg-green-100 border border-green-300 text-green-800":"bg-blue-100 border border-blue-300 text-blue-800";switch(e){case"needed":return"bg-blue-100 border border-blue-300 text-blue-800";case"provided":return"bg-green-100 border border-green-300 text-green-800";case"event":return"bg-purple-100 border border-purple-300 text-purple-800";default:return"bg-gray-100 border border-gray-300 text-gray-800"}},eH=async()=>{try{let{data:{user:e}}=await _.O.auth.getUser();if(!e)return;let{data:t,error:r}=await _.O.from("group_members").select("\n          group_id,\n          groups!inner(id, name, group_type)\n        ").eq("profile_id",e.id).eq("status","active");if(r){M("Error fetching groups");return}let a=t.map(e=>({id:e.groups.id,name:e.groups.name,group_type:e.groups.group_type}));Q(a)}catch(e){M("Error fetching groups")}},eG=async e=>{try{let{data:{user:t}}=await _.O.auth.getUser();if(!t)return;let r=J.find(t=>t.id===e);if((null==r?void 0:r.group_type)==="event"){let{data:r,error:a}=await _.O.from("child_group_members").select("\n            child_id,\n            children(id, full_name, parent_id)\n          ").eq("group_id",e).eq("active",!0).eq("parent_id",t.id);if(a){M("Error fetching children for event group");return}let s=(null==r?void 0:r.map(e=>{var t,r;return{id:(null===(t=e.children[0])||void 0===t?void 0:t.id)||"",name:(null===(r=e.children[0])||void 0===r?void 0:r.full_name)||"",group_id:e.child_id}}))||[];X(s)}else{let{data:r,error:a}=await _.O.from("child_group_members").select("\n            child_id,\n            group_id\n          ").eq("group_id",e).eq("active",!0);if(a){M("Error fetching memberships");return}if(!r||0===r.length){X([]);return}let s=r.map(e=>e.child_id),{data:i,error:n}=await _.O.from("children").select("id, full_name, parent_id").in("id",s).eq("parent_id",t.id);if(n){M("Error fetching children for care group");return}let o=(null==i?void 0:i.map(t=>({id:t.id,name:t.full_name,group_id:e})))||[];X(o)}}catch(e){M("Error in fetchChildren")}},eW=async e=>{try{let{data:{user:t}}=await _.O.auth.getUser();if(!t)return;let{data:r,error:a}=await _.O.from("pet_group_members").select("\n          pet_id,\n          group_id\n        ").eq("group_id",e).eq("active",!0);if(a){M("Error fetching pet memberships");return}if(!r||0===r.length){et([]);return}let s=r.map(e=>e.pet_id),{data:i,error:n}=await _.O.from("pets").select("id, name, species, parent_id").in("id",s).eq("parent_id",t.id);if(n){M("Error fetching pets for group");return}let o=(null==i?void 0:i.map(t=>({id:t.id,name:t.name,species:t.species||void 0,group_id:e})))||[];et(o)}catch(e){M("Error in fetchPets")}},ez=async e=>{try{let{data:t,error:r}=await _.O.from("child_group_members").select("\n          child_id,\n          children!inner(id, full_name, parent_id)\n        ").eq("group_id",e).eq("active",!0);if(r){console.error("Error fetching all group children:",r);return}if(!t||0===t.length){ea([]);return}let a=t.map(t=>({id:t.children.id,name:t.children.full_name,group_id:e,parent_id:t.children.parent_id}));ea(a)}catch(e){console.error("Error in fetchAllGroupChildren:",e)}},eY=e=>{S(e),ei({type:"care",group_id:"",child_id:"",date:(0,p.Z)(e,"yyyy-MM-dd"),start_time:"",end_time:"",end_date:"",hosting_child_ids:[],invited_child_ids:[],notes:""}),Y(!0)},eV=async()=>{if(!eA(es.start_time,es.end_time))return;let e=new Date("".concat(es.date,"T").concat(es.start_time,":00")),t=new Date;if(e<=t){alert("Cannot schedule care in the past. Please select a future date and time.");return}if(es.end_date){let r=new Date("".concat(es.end_date,"T").concat(es.end_time,":00"));if(r<=t){alert("End date and time cannot be in the past. Please select a future date and time.");return}if(r<=e){alert("End date and time must be after start date and time.");return}}try{let{data:{user:e}}=await _.O.auth.getUser();if(!e)return;let t=eR(es.start_time,es.end_time).isNextDay,a=t?"23:59:59":es.end_time,s=t?"".concat(es.notes||"","\n\n[Next-day care: Actual end time is ").concat(es.end_time,"]").trim():es.notes;if("care"===es.type){let{data:t,error:r}=await _.O.rpc("create_reciprocal_care_request",{requester_id:e.id,group_id:es.group_id,requested_date:es.date,start_time:es.start_time,end_time:a,child_id:es.child_id,notes:s||null});if(r){alert("Error creating care request: "+r.message);return}t&&await _.O.rpc("send_care_request_notifications",{p_care_request_id:t}),alert("Care request created successfully! Messages sent to group members.")}else if("pet_care"===es.type){if(!es.pet_id){alert("Please select a pet");return}let t=new Date(es.date),a=new Date(es.end_date||es.date),s=q.filter(e=>{if("pet"!==e.care_category)return!1;let r=new Date(e.care_date),s=new Date(e.end_date||e.care_date);return r<=a&&s>=t});if(s.length>0){let e=s.map(e=>e.end_date?"".concat(r(e.care_date)," - ").concat(r(e.end_date)):r(e.care_date)).join(", ");alert("Cannot create pet care request: You already have scheduled pet care during these dates (".concat(e,"). Please choose different dates."));return}let{data:i,error:n}=await _.O.rpc("create_pet_care_request",{requester_id:e.id,group_id:es.group_id,requested_date:es.date,start_time:es.start_time,end_time:es.end_time,pet_id:es.pet_id,end_date:es.end_date||null,notes:es.notes||null});if(n){alert("Error creating pet care request: "+n.message);return}alert("Pet care request created successfully! Group members have been notified.")}else if("hangout"===es.type){if(0===es.hosting_child_ids.length){alert("Please select at least one hosting child");return}if(0===es.invited_child_ids.length){alert("Please select at least one child to invite");return}let{data:t,error:r}=await _.O.rpc("create_hangout_invitation",{p_requesting_parent_id:e.id,p_group_id:es.group_id,p_care_date:es.date,p_start_time:es.start_time,p_end_time:es.end_time,p_hosting_child_ids:es.hosting_child_ids,p_invited_child_ids:es.invited_child_ids,p_notes:es.notes||null});if(r){alert("Error creating hangout: "+r.message);return}alert("Hangout created successfully! Invitations sent.")}else if("sleepover"===es.type){if(0===es.hosting_child_ids.length){alert("Please select at least one hosting child");return}if(0===es.invited_child_ids.length){alert("Please select at least one child to invite");return}let t=es.end_date||es.date,{data:r,error:a}=await _.O.rpc("create_sleepover_invitation",{p_requesting_parent_id:e.id,p_group_id:es.group_id,p_care_date:es.date,p_start_time:es.start_time,p_end_date:t,p_end_time:es.end_time,p_hosting_child_ids:es.hosting_child_ids,p_invited_child_ids:es.invited_child_ids,p_notes:es.notes||null});if(a){alert("Error creating sleepover: "+a.message);return}alert("Sleepover created successfully! Invitations sent.")}Y(!1),ei({type:"care",group_id:"",child_id:"",date:"",start_time:"",end_time:"",end_date:"",hosting_child_ids:[],invited_child_ids:[],notes:""}),await ey()}catch(e){M("Error creating request"),alert("Error creating request")}},e$=()=>{T("monthly"),S(null)};if(I)return(0,a.jsx)(x.Z,{currentPage:"calendar",children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 mb-6"}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-4",children:Array.from({length:35}).map((e,t)=>(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded"},t))})]})})})});if(F)return(0,a.jsx)(x.Z,{currentPage:"calendar",children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-red-800",children:F}),(0,a.jsx)("button",{onClick:ey,className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Try Again"})]})})})});let eJ=(0,o.Z)(v),eQ=(0,l.Z)(v),eK=(0,u.Z)({start:eJ,end:eQ}),eX=eJ.getDay(),e0=6-eQ.getDay();return[...Array.from({length:eX},(e,t)=>null),...eK,...Array.from({length:e0},(e,t)=>null)],(0,a.jsx)(x.Z,{currentPage:"calendar",children:(0,a.jsx)("div",{className:"p-3 sm:p-4 md:p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 sm:mb-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-6 w-full sm:w-auto",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:e("calendar")}),(0,a.jsxs)("div",{className:"flex items-center bg-white rounded-lg border border-gray-300 p-1",children:[(0,a.jsx)("button",{onClick:()=>N("all"),className:"px-3 py-1.5 sm:px-4 sm:py-2 rounded-md text-xs sm:text-sm font-medium transition-colors ".concat("all"===j?"bg-gray-600 text-white":"text-gray-600 hover:text-gray-900"),children:e("all")}),(0,a.jsx)("button",{onClick:()=>N("children"),className:"px-3 py-1.5 sm:px-4 sm:py-2 rounded-md text-xs sm:text-sm font-medium transition-colors ".concat("children"===j?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:e("children")}),(0,a.jsx)("button",{onClick:()=>N("pets"),className:"px-3 py-1.5 sm:px-4 sm:py-2 rounded-md text-xs sm:text-sm font-medium transition-colors ".concat("pets"===j?"bg-purple-600 text-white":"text-gray-600 hover:text-gray-900"),children:e("pets")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-between sm:justify-start",children:[(0,a.jsx)("button",{onClick:()=>ek("prev"),className:"p-1.5 sm:p-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50",children:(0,a.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("h2",{className:"text-base sm:text-lg md:text-xl font-semibold text-gray-700 whitespace-nowrap ".concat("weekly"===P?"cursor-pointer hover:text-blue-600 transition-colors":""),onClick:()=>{"weekly"===P&&e$()},title:"weekly"===P?"Click to return to monthly view":"",children:"".concat(e(["january","february","march","april","may","june","july","august","september","october","november","december"][v.getMonth()])," ").concat(v.getFullYear())}),(0,a.jsx)("button",{onClick:()=>ek("next"),className:"p-1.5 sm:p-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50",children:(0,a.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]}),(0,a.jsxs)("div",{...eC,children:["monthly"===P?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-7 bg-gray-100",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((e,t)=>(0,a.jsxs)("div",{className:"p-1 sm:p-2 text-center text-[10px] sm:text-xs font-medium text-gray-700",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:e}),(0,a.jsx)("span",{className:"sm:hidden",children:e.charAt(0)})]},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7",children:(()=>{let e=(0,o.Z)(v),t=(0,l.Z)(v),r=(0,u.Z)({start:e,end:t}),a=e.getDay(),s=6-t.getDay();return[...Array.from({length:a},(e,t)=>null),...r,...Array.from({length:s},(e,t)=>null)]})().map((e,t)=>{if(!e)return(0,a.jsx)("div",{className:"min-h-[60px] sm:min-h-[80px] md:min-h-[120px] bg-gray-50"},t);let r=eE(e),s=(0,n.Z)(e,new Date),i=D&&(0,n.Z)(e,D);return(0,a.jsxs)("div",{className:"min-h-[60px] sm:min-h-[80px] md:min-h-[120px] p-1 sm:p-2 md:p-3 border-r border-b border-gray-200 cursor-pointer hover:bg-gray-50 ".concat(s?"bg-blue-50":""," ").concat(i?"bg-blue-100 border-blue-300":""),onClick:()=>eN(e),children:[(0,a.jsx)("div",{className:"text-sm sm:text-base font-medium mb-1 sm:mb-2 md:mb-3 ".concat(s?"text-blue-600":i?"text-blue-800":"text-gray-900"),children:(0,p.Z)(e,"d")}),(0,a.jsxs)("div",{className:"space-y-0.5 sm:space-y-1 md:space-y-1.5",children:[r.slice(0,2).map((t,r)=>{let s=eZ(t,e);return(0,a.jsxs)("div",{className:"relative p-0.5 sm:p-1 md:p-1.5 text-[9px] sm:text-[10px] md:text-xs leading-tight ".concat(eB(t.care_type,t.action_type,t.status,t.is_host,t.care_category)," cursor-pointer hover:opacity-80 ").concat(s.isMultiDay?s.isFirstDay?"rounded-l border-r-0":s.isLastDay?"rounded-r border-l-0":"rounded-none border-x-0":"rounded"," ").concat(t.has_unseen_updates?"ring-2 ring-orange-400 ring-offset-1":""),title:"".concat(t.group_name," - ").concat(eM(t.start_time)," to ").concat(eM(k(t.notes||"",t.end_time))).concat(s.isMultiDay?" (Day ".concat(s.dayNumber," of ").concat(s.totalDays,")"):"").concat(t.has_unseen_updates?" (New updates!)":""),onClick:e=>{e.stopPropagation(),A(t),H(!1),Z(!0)},children:[t.has_unseen_updates&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-500 rounded-full border border-white",title:"New updates"}),(0,a.jsx)("div",{className:"font-semibold truncate text-[9px] sm:text-[10px] md:text-xs",children:s.isMultiDay?s.isFirstDay?"\uD83D\uDC3E ".concat("rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"provided"===t.care_type?"Providing":"Receiving"," →"):s.isLastDay?"→ ".concat("rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"provided"===t.care_type?"Providing":"Receiving"," ●"):"→ ".concat("rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"provided"===t.care_type?"Providing":"Receiving"," →"):"rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"event"===t.care_type?"Event":"provided"===t.care_type?"Providing":"hangout"===t.care_type?"Hangout":"sleepover"===t.care_type?"Sleepover":"open_block"===t.care_type?"Open":"Receiving"}),(0,a.jsx)("div",{className:"opacity-90 truncate text-[8px] sm:text-[9px] md:text-[10px]",children:s.isMultiDay?"Day ".concat(s.dayNumber,"/").concat(s.totalDays):"".concat(eM(t.start_time).replace(" ",""),"-").concat(eM(k(t.notes||"",t.end_time)).replace(" ",""))})]},r)}),r.length>2&&(0,a.jsx)("div",{className:"h-2 bg-gray-300 rounded-full opacity-80",title:"".concat(r.length-2," more items")})]})]},t)})})]}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:(0,a.jsx)("div",{className:"grid grid-cols-7",children:(e=>{let t=(0,d.Z)(e,{weekStartsOn:0}),r=(0,c.Z)(e,{weekStartsOn:0});return(0,u.Z)({start:t,end:r})})(D).map((e,t)=>{let r=eE(e),s=(0,n.Z)(e,new Date),i=(0,n.Z)(e,D);return(0,a.jsxs)("div",{className:"relative min-h-[60px] sm:min-h-[80px] md:min-h-[120px] p-1 sm:p-2 md:p-3 border-r border-b border-gray-200 cursor-pointer hover:bg-gray-50 ".concat(s?"bg-blue-50":""," ").concat(i?"bg-blue-100 border-blue-300":""),onClick:()=>eN(e),children:[(0,a.jsx)("div",{className:"text-[10px] sm:text-xs md:text-sm font-medium mb-1 sm:mb-2 ".concat(s?"text-blue-600":i?"text-blue-800":"text-gray-900"),children:(0,p.Z)(e,"EEE")}),(0,a.jsx)("div",{className:"text-base sm:text-lg md:text-xl font-bold ".concat(s?"text-blue-600":i?"text-blue-800":"text-gray-900"),children:(0,p.Z)(e,"d")}),(0,a.jsxs)("div",{className:"space-y-0.5 sm:space-y-1 md:space-y-1.5 mt-1 sm:mt-2 md:mt-3",children:[r.slice(0,4).map((t,r)=>{let s=eZ(t,e);return(0,a.jsxs)("div",{className:"relative p-0.5 sm:p-1 md:p-2 text-[9px] sm:text-[10px] md:text-xs leading-tight ".concat(eB(t.care_type,t.action_type,t.status,t.is_host,t.care_category)," cursor-pointer hover:opacity-80 ").concat(s.isMultiDay?s.isFirstDay?"rounded-l border-r-0":s.isLastDay?"rounded-r border-l-0":"rounded-none border-x-0":"rounded"," ").concat(t.has_unseen_updates?"ring-2 ring-orange-400 ring-offset-1":""),title:"".concat(t.group_name," - ").concat(eM(t.start_time)," to ").concat(eM(k(t.notes||"",t.end_time))).concat(s.isMultiDay?" (Day ".concat(s.dayNumber," of ").concat(s.totalDays,")"):"").concat(t.has_unseen_updates?" (New updates!)":""),onClick:e=>{e.stopPropagation(),A(t),H(!1),Z(!0)},children:[t.has_unseen_updates&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-500 rounded-full border border-white",title:"New updates"}),(0,a.jsx)("div",{className:"font-semibold truncate text-[9px] sm:text-[10px] md:text-xs",children:s.isMultiDay?s.isFirstDay?"\uD83D\uDC3E ".concat("rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"provided"===t.care_type?"Providing":"Receiving"," →"):s.isLastDay?"→ ".concat("rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"provided"===t.care_type?"Providing":"Receiving"," ●"):"→ ".concat("rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"provided"===t.care_type?"Providing":"Receiving"," →"):"rescheduled"===t.action_type&&"rescheduled"===t.status?"Rescheduling":"event"===t.care_type?"Event":"provided"===t.care_type?"Providing":"hangout"===t.care_type?"Hangout":"sleepover"===t.care_type?"Sleepover":"open_block"===t.care_type?"Open":"Receiving"}),(0,a.jsx)("div",{className:"opacity-90 truncate text-[8px] sm:text-[9px] md:text-[10px]",children:s.isMultiDay?"Day ".concat(s.dayNumber,"/").concat(s.totalDays):"".concat(eM(t.start_time).replace(" ",""),"-").concat(eM(k(t.notes||"",t.end_time)).replace(" ",""))})]},r)}),r.length>4&&(0,a.jsx)("div",{className:"h-2.5 bg-gray-300 rounded-full opacity-80",title:"".concat(r.length-4," more items")})]}),0===t&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),eD("prev")},className:"absolute bottom-1 left-1 text-gray-600 hover:text-blue-600 text-xl sm:text-2xl font-bold transition-colors",title:"Previous week",children:"<"}),6===t&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),eD("next")},className:"absolute bottom-1 right-1 text-gray-600 hover:text-blue-600 text-xl sm:text-2xl font-bold transition-colors",title:"Next week",children:">"})]},t)})})}),"weekly"===P&&D&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-b border-gray-200 bg-gray-50",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:(0,p.Z)(D,"EEEE, MMMM d, yyyy")}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Double-click on any hour to schedule care or events"})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:(e=>{let t=eE(e),r=Array.from({length:24},(e,t)=>0+t),a=new Set;return t.forEach(e=>{let t=parseInt(e.start_time.split(":")[0]),r=parseInt(e.end_time.split(":")[0]);for(let e=t;e<r;e++)a.add(e)}),r.map(e=>{let r="".concat(e.toString().padStart(2,"0"),":00");(e+1).toString().padStart(2,"0");let s=t.filter(t=>parseInt(t.start_time.split(":")[0])===e),i=t.filter(t=>{let r=parseInt(t.start_time.split(":")[0]),a=parseInt(t.end_time.split(":")[0]);return r<e&&a>e});return{hour:e,time:r,startingCare:s,continuingCare:i,isOccupied:a.has(e)}})})(D).map(t=>(0,a.jsxs)("div",{id:"hour-".concat(t.hour),className:"flex border-b border-gray-100 hover:bg-gray-50 cursor-pointer ".concat(t.isOccupied?"bg-blue-50":""),onDoubleClick:()=>ej(t.hour,D),children:[(0,a.jsx)("div",{className:"w-14 sm:w-16 md:w-20 p-1.5 sm:p-2 md:p-3 text-[10px] sm:text-xs md:text-sm font-medium text-gray-600 border-r border-gray-100 bg-gray-50",children:t.time}),(0,a.jsx)("div",{className:"flex-1 p-2 sm:p-3 min-h-[50px] sm:min-h-[60px]",children:t.startingCare.length>0?(0,a.jsx)("div",{className:"space-y-2",children:t.startingCare.map((t,r)=>{let s=new Date("2000-01-01T".concat(t.start_time)),i=new Date("2000-01-01T".concat(t.end_time)).getTime()-s.getTime(),n=s.getMinutes();return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-4 relative ".concat(t.has_unseen_updates?"border-orange-400 ring-2 ring-orange-400 ring-offset-1":"border-gray-200"),style:{minHeight:"".concat(Math.max(60,60*Math.ceil(i/36e5)),"px"),marginTop:"".concat(n/60*60,"px")},onDoubleClick:e=>{e.stopPropagation(),A(t),H(!1),Z(!0)},children:[t.has_unseen_updates&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2 flex items-center gap-1 bg-orange-500 text-white text-xs font-medium px-2 py-0.5 rounded-full",children:(0,a.jsx)("span",{children:"New updates"})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("group"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:t.group_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("date"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:(0,p.Z)(D,"MMM d, yyyy")})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("time"),":"]}),(0,a.jsxs)("span",{className:"ml-2 text-gray-900",children:[eM(t.start_time)," - ",eM(k(t.notes||"",t.end_time))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("type"),":"]}),(0,a.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat(eB(t.care_type,t.action_type,t.status,t.is_host,t.care_category)),children:"event"===t.care_type?"Event":"provided"===t.care_type?e("providingCare"):"hangout"===t.care_type?"Hangout":"sleepover"===t.care_type?"Sleepover":"open_block"===t.care_type?e("openBlock"):e("receivingCare")})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("status"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:t.status})]}),t.providing_parent_name&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("provider"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:t.providing_parent_name})]}),t.children_names&&t.children_names.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:t.pet_id?"".concat(e("pet"),":"):"".concat(e("children"),":")}),(0,a.jsx)("div",{className:"ml-2 mt-1",children:t.children_names.map((e,t)=>(0,a.jsx)("span",{className:"inline-block bg-gray-100 rounded px-2 py-1 text-xs mr-1 mb-1",children:e},t))})]}),t.notes&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("notes"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:t.notes})]})]})]},"".concat(t.id,"-").concat(r))})}):t.continuingCare.length>0?(0,a.jsx)("div",{className:"text-gray-400 text-xs italic",children:"← Continuing from previous hour"}):(0,a.jsx)("div",{className:"text-gray-400 text-sm italic",children:"Double-click to schedule"})})]},t.hour))})]}),(0,a.jsxs)("div",{className:"mt-6 flex flex-wrap items-center gap-4 sm:gap-6 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded border border-gray-400",style:{background:"linear-gradient(to bottom right, rgb(191, 219, 254) 50%, rgb(187, 247, 208) 50%)"}}),(0,a.jsx)("span",{children:e("childCare")})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded border border-gray-400",style:{background:"linear-gradient(to bottom right, rgb(233, 213, 255) 50%, rgb(254, 243, 199) 50%)"}}),(0,a.jsx)("span",{children:e("petCare")})]})]}),"weekly"===P&&(0,a.jsx)("div",{className:"mt-6 flex items-center space-x-4",children:(0,a.jsxs)("button",{onClick:()=>{D&&eY(D)},className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:["Schedule for ",D?(0,p.Z)(D,"MMM d"):"Selected Day"]})})]}),U&&R&&(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-full flex flex-col",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Care Details"}),(0,a.jsx)("button",{onClick:()=>Z(!1),className:"text-gray-400 hover:text-gray-600 text-2xl font-bold leading-none p-1","aria-label":"Close",children:"\xd7"})]})}),(0,a.jsx)("div",{className:"px-6 py-4 overflow-y-auto flex-1",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("group"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:R.group_name})]}),"pet"===R.care_category?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("dropOff"),":"]}),(0,a.jsxs)("span",{className:"ml-2 text-gray-900",children:[r(R.care_date)," ",e("at")," ",eM(R.start_time)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("pickUp"),":"]}),(0,a.jsxs)("span",{className:"ml-2 text-gray-900",children:[r(R.end_date||R.care_date)," ",e("at")," ",eM(k(R.notes||"",R.end_time))]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("date"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:r(R.care_date)})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("time"),":"]}),(0,a.jsxs)("span",{className:"ml-2 text-gray-900",children:[eM(R.start_time)," - ",eM(k(R.notes||"",R.end_time))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("type"),":"]}),(0,a.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat(eB(R.care_type,R.action_type,R.status,R.is_host,R.care_category)),children:"event"===R.care_type?"Event":"provided"===R.care_type?e("providingCare"):"hangout"===R.care_type?"Hangout":"sleepover"===R.care_type?"Sleepover":"open_block"===R.care_type?e("openBlock"):e("receivingCare")})]}),R.providing_parent_name&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("provider"),":"]}),(0,a.jsx)("span",{className:"ml-2 text-gray-900",children:R.providing_parent_name})]}),R.children_names&&R.children_names.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"pet"===R.care_category?"".concat(e("pet"),":"):"".concat(e("children"),":")}),"provided"===R.care_type&&"pet"!==R.care_category&&(0,a.jsxs)("button",{onClick:()=>eS(R),className:"text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center gap-1",title:"Open this block to other children",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,a.jsx)("span",{children:e("openBlock")})]})]}),(0,a.jsx)("div",{className:"ml-2 mt-1",children:R.children_names.map((e,t)=>(0,a.jsx)("span",{className:"inline-block bg-gray-100 rounded px-2 py-1 text-xs mr-1 mb-1",children:e},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium text-gray-700",children:[e("notes"),":"]}),"provided"===R.care_type||("hangout"===R.care_type||"sleepover"===R.care_type)&&R.is_host?(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("textarea",{value:R.notes||"",onChange:e=>{A(t=>t?{...t,notes:e.target.value}:null),H(!0)},placeholder:"provided"===R.care_type?"Add your care plans and details here...":"Add details about this event (shared with all participants)...",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",rows:3}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"provided"===R.care_type?e("shareCarePlans"):e("notesVisibleAll")})]}):(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-3 text-sm text-gray-700",children:R.notes||("hangout"===R.care_type||"sleepover"===R.care_type?e("noNotesHost"):e("noNotesProvider"))}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"hangout"===R.care_type||"sleepover"===R.care_type?e("eventDetailsHost"):e("carePlansProvider")})]})]}),("provided"===R.care_type||("hangout"===R.care_type||"sleepover"===R.care_type)&&R.is_host)&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e("photos")}),(0,a.jsxs)("label",{className:"cursor-pointer",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&ev(r),e.target.value=""},className:"hidden",disabled:eg}),(0,a.jsx)("div",{className:"p-2 rounded-lg transition ".concat(eg?"bg-gray-200 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"),title:"Add Photo",children:(0,a.jsxs)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),eg&&(0,a.jsx)("p",{className:"text-sm text-blue-600 mb-2",children:e("uploadingPhoto")}),ex&&(0,a.jsx)("p",{className:"text-sm text-red-600 mb-2",children:ex}),R.photo_urls&&R.photo_urls.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:R.photo_urls.map((e,t)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("img",{src:e,alt:"Care photo ".concat(t+1),className:"w-full h-32 sm:h-40 object-cover rounded-lg border border-gray-200",onClick:()=>window.open(e,"_blank"),style:{cursor:"pointer"}}),(0,a.jsx)("button",{onClick:()=>ew(e),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition",title:"Delete photo",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"provided"===R.care_type?e("uploadPhotosReceiving"):e("uploadPhotosAll")})]}),("needed"===R.care_type||("hangout"===R.care_type||"sleepover"===R.care_type)&&!R.is_host)&&R.photo_urls&&R.photo_urls.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"needed"===R.care_type?e("photosFromProvider"):e("photosFromHost")}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:R.photo_urls.map((e,t)=>(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("img",{src:e,alt:"Care photo ".concat(t+1),className:"w-full h-32 sm:h-40 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition",onClick:()=>window.open(e,"_blank")})},t))}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:e("clickPhotoFullSize")})]}),"provided"===R.care_type||"needed"===R.care_type?(0,a.jsx)(E,{selectedCare:R}):null]})}),(0,a.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex-shrink-0",children:[("hangout"===R.care_type||"sleepover"===R.care_type)&&R.is_host&&(0,a.jsx)("button",{onClick:async()=>{if(void 0!==R.notes)try{var e;let{data:{user:t}}=await _.O.auth.getUser();if(!t){alert("Please log in to update notes");return}let{data:r,error:a}=await _.O.rpc("update_hangout_sleepover_notes",{p_scheduled_care_id:R.id,p_parent_id:t.id,p_new_notes:R.notes||""});if(a){console.error("Error saving notes:",a),alert("Failed to save notes. Please try again.");return}await ey(),H(!1),alert((null===(e=r[0])||void 0===e?void 0:e.message)||"Notes saved and shared with all participants!")}catch(e){console.error("Error saving notes:",e),alert("Failed to save notes. Please try again.")}},disabled:!B,className:"w-full px-4 py-2 rounded-lg mb-3 ".concat(B?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:B?"Save Notes (Share with All)":"No Changes"}),"provided"===R.care_type&&(0,a.jsxs)(a.Fragment,{children:["pet"!==R.care_category&&(0,a.jsx)("button",{onClick:()=>eP(R),className:"w-full px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 mb-3",children:e("reschedule")}),(0,a.jsx)("button",{onClick:async()=>{if(void 0!==R.notes)try{var e;let{data:{user:t}}=await _.O.auth.getUser();if(!t){alert("Please log in to update notes");return}let r="pet"===R.care_category?"update_pet_care_notes":"update_reciprocal_care_notes",{data:a,error:s}=await _.O.rpc(r,{p_scheduled_care_id:R.id,p_parent_id:t.id,p_new_notes:R.notes||""});if(s){console.error("Error saving notes:",s),alert("Failed to save notes: ".concat(s.message));return}if(!a||0===a.length){console.error("No data returned from function"),alert("Failed to save notes - no response from server");return}await ey(),H(!1),alert((null===(e=a[0])||void 0===e?void 0:e.message)||"Notes saved and shared with receiver!")}catch(e){console.error("Error saving notes:",e),alert("Failed to save notes: ".concat(e))}},disabled:!B,className:"w-full px-4 py-2 rounded-lg ".concat(B?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:B?"Save Notes (Share with Receiver)":"No Changes"})]})]})]})}),z&&(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 overflow-y-auto",style:{top:"100px",bottom:"90px",zIndex:9999},children:(0,a.jsx)("div",{className:"flex items-start justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 sticky top-0 bg-white rounded-t-lg z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"care"===es.type?e("createNewCareRequest"):"hangout"===es.type?e("createNewHangout"):"sleepover"===es.type?e("createNewSleepover"):e("createNewPetCareRequest")}),(0,a.jsx)("button",{onClick:()=>Y(!1),className:"text-gray-600 hover:text-gray-900 p-2 -mr-2 rounded-full hover:bg-gray-100",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsxs)("div",{className:"px-6 py-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e("type")}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>ei(e=>({...e,type:"care",hosting_child_ids:[],invited_child_ids:[],end_date:""})),className:"px-4 py-3 rounded-md border-2 transition-all text-center flex items-center justify-center ".concat("care"===es.type?"border-blue-500 bg-blue-50 text-blue-700 font-semibold":"border-gray-300 hover:border-gray-400"),children:e("careRequestType")}),(0,a.jsx)("button",{type:"button",onClick:()=>ei(e=>({...e,type:"hangout",child_id:"",end_date:""})),className:"px-4 py-3 rounded-md border-2 transition-all text-center flex items-center justify-center ".concat("hangout"===es.type?"border-green-500 bg-green-50 text-green-700 font-semibold":"border-gray-300 hover:border-gray-400"),children:e("hangout")}),(0,a.jsx)("button",{type:"button",onClick:()=>ei(e=>({...e,type:"pet_care",child_id:"",pet_id:"",hosting_child_ids:[],invited_child_ids:[]})),className:"px-4 py-3 rounded-md border-2 transition-all text-center flex items-center justify-center ".concat("pet_care"===es.type?"border-purple-500 bg-purple-50 text-purple-700 font-semibold":"border-gray-300 hover:border-gray-400"),children:e("petCareEmoji")})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"care"===es.type?e("date"):e("startDate")}),(0,a.jsx)("input",{type:"date",value:es.date,onChange:e=>ei(t=>({...t,date:e.target.value})),min:new Date().toISOString().split("T")[0],max:"".concat(new Date().getFullYear()+5,"-12-31"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),("pet_care"===es.type||"hangout"===es.type)&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e("endDate"),(0,a.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:e("optionalForMultiDay")})]}),(0,a.jsx)("input",{type:"date",value:es.end_date,onChange:e=>ei(t=>({...t,end_date:e.target.value})),min:es.date||new Date().toISOString().split("T")[0],max:"".concat(new Date().getFullYear()+5,"-12-31"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e("startTime")}),(0,a.jsx)("input",{type:"time",value:es.start_time,onChange:e=>{let t=e.target.value;ei(e=>({...e,start_time:t})),eA(t,es.end_time)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e("endTime"),es.start_time&&es.end_time&&eR(es.start_time,es.end_time).isNextDay&&(0,a.jsx)("span",{className:"ml-1 text-blue-600 font-semibold",children:"+1"})]}),(0,a.jsx)("input",{type:"time",value:es.end_time,onChange:e=>{let t=e.target.value;if(es.date&&es.start_time&&t){if(eR(es.start_time,t).isNextDay){let e=new Date(new Date(es.date+"T00:00:00").getTime()+864e5),r=(0,p.Z)(e,"yyyy-MM-dd");ei(e=>({...e,end_time:t,end_date:r}))}else ei(e=>({...e,end_time:t,end_date:""}))}else ei(e=>({...e,end_time:t}));eA(es.start_time,t)},className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ".concat(ep?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"),required:!0}),(()=>{let t=eU(es.date,es.start_time,es.end_time);return t?(0,a.jsxs)("div",{className:"mt-1 text-sm text-blue-600 font-medium",children:[e("endsOn")," ",r(t)]}):null})()]})]}),es.start_time&&es.end_time&&es.date&&(0,a.jsxs)("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-1",children:e("timeRangeSummary")}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:(()=>{let t=eR(es.start_time,es.end_time),s=eU(es.date,es.start_time,es.end_time);return t.isNextDay&&s?(0,a.jsxs)("span",{children:[r(new Date(es.date+"T00:00:00"))," ",e("atTime")," ",eM(es.start_time)," → ",r(s)," ",e("atTime")," ",eM(es.end_time),(0,a.jsxs)("span",{className:"ml-2 text-blue-600 font-medium",children:["(",t.duration.toFixed(1)," ",e("hoursLabel"),")"]})]}):(0,a.jsxs)("span",{children:[r(new Date(es.date+"T00:00:00"))," ",e("fromTime")," ",eM(es.start_time)," ",e("toTime")," ",eM(es.end_time),(0,a.jsxs)("span",{className:"ml-2 text-gray-500",children:["(",t.duration.toFixed(1)," ",e("hoursLabel"),")"]})]})})()})]}),ep&&(0,a.jsx)("div",{className:"text-red-600 text-sm mt-1",children:ep}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e("group")}),(0,a.jsxs)("select",{value:es.group_id,onChange:e=>{let t=e.target.value;ei(e=>({...e,group_id:t,child_id:"",pet_id:"",hosting_child_ids:[],invited_child_ids:[]})),t&&("pet_care"===es.type?eW(t):(eG(t),"care"!==es.type&&ez(t)))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,a.jsx)("option",{value:"",children:e("selectGroup")}),("pet_care"===es.type?J.filter(e=>"pet"===e.group_type):"care"===es.type||"hangout"===es.type?J.filter(e=>"care"===e.group_type):J).map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.group_type,")"]},e.id))]})]}),"care"===es.type&&es.group_id&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e("child")}),(0,a.jsxs)("select",{value:es.child_id,onChange:e=>ei(t=>({...t,child_id:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,a.jsx)("option",{value:"",children:e("selectChild")}),K.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),"pet_care"===es.type&&es.group_id&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e("pet")}),(0,a.jsxs)("select",{value:es.pet_id,onChange:e=>ei(t=>({...t,pet_id:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0,children:[(0,a.jsx)("option",{value:"",children:e("selectPet")}),ee.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.species?"(".concat(e.species,")"):""]},e.id))]})]}),("hangout"===es.type||"sleepover"===es.type)&&es.group_id&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e("hostingChildrenLabel")," * ",e("hostingChildrenDesc")]}),(0,a.jsx)("div",{className:"border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto",children:0===K.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e("noChildrenAvailable")}):(0,a.jsx)("div",{className:"space-y-2",children:K.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:es.hosting_child_ids.includes(e.id),onChange:t=>{let r=t.target.checked;ei(t=>({...t,hosting_child_ids:r?[...t.hosting_child_ids,e.id]:t.hosting_child_ids.filter(t=>t!==e.id)}))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})})]}),("hangout"===es.type||"sleepover"===es.type)&&es.group_id&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e("invitedChildrenLabel")," * ",e("invitedChildrenDesc")]}),(0,a.jsx)("div",{className:"border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto",children:0===er.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e("noChildrenInGroup")}):(0,a.jsx)("div",{className:"space-y-2",children:er.filter(e=>!K.some(t=>t.id===e.id)).map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:es.invited_child_ids.includes(e.id),onChange:t=>{let r=t.target.checked;ei(t=>({...t,invited_child_ids:r?[...t.invited_child_ids,e.id]:t.invited_child_ids.filter(t=>t!==e.id)}))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e("notesOptional")}),(0,a.jsx)("textarea",{value:es.notes,onChange:e=>ei(t=>({...t,notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:e("anyAdditionalNotes")})]})]}),(0,a.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:eV,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"care"===es.type?e("createRequestBtn"):"hangout"===es.type?e("createHangoutBtn"):"sleepover"===es.type?e("createSleepoverBtn"):e("createPetCareBtn")}),(0,a.jsx)("button",{onClick:()=>Y(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:e("cancel")})]})})]})})}),G&&R&&(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-full overflow-y-auto",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e("openBlockInvitation")}),(0,a.jsx)("button",{onClick:()=>W(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[e("careBlock")," ",r(R.care_date)," ",e("atTime")," ",eM(R.start_time)," - ",eM(k(R.notes||"",R.end_time))]})]}),(0,a.jsxs)("div",{className:"px-6 py-4 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e("selectParentsToInvite")}),ec?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:e("loadingAvailableParents")})]}):el.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:el.map(t=>{let r=en.invitedParents.some(e=>e.id===t.id);return(0,a.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat(r?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>eL(t),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:t.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:1===t.children.length?e("childCount",{count:1}):e("childrenCount",{count:t.children.length})})]}),(0,a.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat(r?"bg-blue-500 border-blue-500":"border-gray-300"),children:r&&(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full m-0.5"})})]})},t.id)})}):(0,a.jsxs)("div",{className:"text-center py-4 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,a.jsx)("p",{className:"text-gray-500",children:e("noAvailableParents")}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:e("noEligibleParents")})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e("reciprocalCareTimesNeeded")}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e("timeBlocksOfferedDesc")}),en.reciprocalTimes.map((t,r)=>(t.parentId&&en.invitedParents.find(e=>e.id===t.parentId),(0,a.jsxs)("div",{className:"border rounded-lg p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h5",{className:"font-medium",children:[e("offer")," ",r+1]}),(0,a.jsx)("button",{onClick:()=>eO(r),className:"text-red-500 hover:text-red-700 text-sm",children:e("remove")})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("date")}),(0,a.jsx)("input",{type:"date",value:t.date,onChange:e=>eI(r,"date",e.target.value),min:new Date().toISOString().split("T")[0],max:"".concat(new Date().getFullYear()+5,"-12-31"),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("startTime")}),(0,a.jsx)("input",{type:"time",value:t.startTime,onChange:e=>eI(r,"startTime",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("endTime")}),(0,a.jsx)("input",{type:"time",value:t.endTime,onChange:e=>eI(r,"endTime",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]})]})]},r))),(0,a.jsx)("button",{onClick:()=>{eo(e=>({...e,reciprocalTimes:[...e.reciprocalTimes,{date:"",startTime:"",endTime:"",notes:""}]}))},className:"w-full px-4 py-2 border-2 border-dashed border-gray-300 text-gray-600 rounded-lg hover:border-gray-400 hover:text-gray-700",children:e("addTimeBlock")})]})]}),(0,a.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:eF,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:0===en.invitedParents.length,children:e("createOpenBlockInvitations")})})]})}),V&&R&&R.group_id&&(0,a.jsx)(y.Z,{isOpen:V,onClose:()=>$(!1),careBlock:{id:R.id,group_id:R.group_id,care_date:R.care_date,start_time:R.start_time,end_time:R.end_time,related_request_id:R.related_request_id||"",group_name:R.group_name,children:R.children_data||[]},onRescheduleSuccess:eT})]})})})}function P(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)(x.Z,{children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading..."})})})}),children:(0,a.jsx)(S,{})})}},415:function(e,t,r){"use strict";function a(e){if(!e)return null;try{let t;if("string"==typeof e){if(e.match(/^\d{4}-\d{2}-\d{2}$/)){let[r,a,s]=e.split("-").map(Number);t=new Date(r,a-1,s)}else t=new Date(e)}else t=e;if(isNaN(t.getTime()))return null;return t}catch(t){return console.warn("Failed to parse date:",e,t),null}}function s(e,t){if(!e)return"";let r=a(e);if(!r)return"";let s=t||localStorage.getItem("i18nextLng")||"en";return r.toLocaleDateString("es"===s?"es-ES":"en-US",{month:"short",day:"numeric",year:"numeric"})}function i(e){let t;if(!e)return"";if(e.includes("T")||e.includes(" "))t=new Date(e);else{let[r,a]=e.split(":");(t=new Date).setHours(parseInt(r,10),parseInt(a,10),0,0)}if(isNaN(t.getTime()))return"";let r=localStorage.getItem("i18nextLng")||"en";return t.toLocaleTimeString("es"===r?"es-ES":"en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function n(e){return e.toISOString().split("T")[0]}function o(e){if(!e)return"";if(e.match(/^\d{4}-\d{2}-\d{2}$/))return e;let t=a(e);return t?n(t):e}r.d(t,{DG:function(){return o},L9:function(){return n},mr:function(){return i},o8:function(){return s}})},2644:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(7437),s=r(2265),i=r(3519);function n(e){let{isOpen:t,onClose:r,careBlock:n,onRescheduleSuccess:o}=e,[l,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[p,m]=(0,s.useState)(""),[g,h]=(0,s.useState)(""),[x,_]=(0,s.useState)(!1),[f,y]=(0,s.useState)(""),b=async e=>{if(e.preventDefault(),!l||!c||!p||!g){y("Please fill in all fields");return}_(!0),y("");try{var t;console.log("\uD83D\uDE80 Starting reschedule request..."),console.log("\uD83D\uDCCB Care Block ID:",n.id),console.log("\uD83D\uDCC5 New Date:",l),console.log("⏰ New Start Time:",c),console.log("⏰ New End Time:",p),console.log("\uD83D\uDCDD Reason:",g);let{data:e,error:a}=await i.O.rpc("initiate_improved_reschedule",{p_scheduled_care_id:n.id,p_new_date:l,p_new_start_time:c,p_new_end_time:p,p_reschedule_reason:g});if(console.log("\uD83D\uDD0D RPC Call Result:"),console.log("  - Error:",a),console.log("  - Data:",e),console.log("  - Data Type:",typeof e),console.log("  - Data Length:",null==e?void 0:e.length),a)throw console.error("❌ RPC Error:",a),a;if(!e||0===e.length)throw console.error("❌ No data returned from RPC call"),Error("No data returned from reschedule function");let s=e[0];if(console.log("\uD83D\uDCCA Function Result:",s),console.log("✅ Success:",s.success),console.log("\uD83D\uDCDD Message:",s.message),console.log("\uD83C\uDD94 New Request ID:",s.new_request_id),console.log("\uD83D\uDC65 Participating Parents:",s.participating_parents),!s.success)throw console.error("❌ Function returned success=false:",s.message),Error(s.message||"Failed to initiate reschedule request");console.log("✅ Reschedule request initiated successfully!"),console.log("\uD83D\uDC65 Participating parents count:",(null===(t=s.participating_parents)||void 0===t?void 0:t.length)||0),s.participating_parents&&Array.isArray(s.participating_parents)&&s.participating_parents.forEach((e,t)=>{console.log("\uD83D\uDC64 Parent ".concat(t+1,":"),e)}),console.log("\uD83D\uDD0D Verifying care_responses were created...");let{data:d,error:u}=await i.O.from("care_responses").select("*").eq("request_id",s.new_request_id).eq("action_type","reschedule_response");if(console.log("\uD83D\uDCCB Care Responses Check:"),console.log("  - Error:",u),console.log("  - Count:",(null==d?void 0:d.length)||0),console.log("  - Responses:",d),u)console.error("❌ Error checking care_responses:",u);else if(d&&0!==d.length)console.log("✅ Care responses found:",d.length),d.forEach((e,t)=>{console.log("\uD83D\uDCDD Care Response ".concat(t+1,":"),{id:e.id,request_id:e.request_id,responder_id:e.responder_id,status:e.status,action_type:e.action_type})});else{console.error("❌ NO CARE_RESPONSES CREATED! Trying to create them from rescheduled blocks..."),console.log("\uD83D\uDD27 Request ID:",s.new_request_id);try{let{data:e,error:t}=await i.O.rpc("create_care_responses_from_rescheduled_blocks",{p_reschedule_request_id:s.new_request_id});console.log("\uD83D\uDD27 Create Care Responses Result:",e),console.log("\uD83D\uDD27 Create Care Responses Error:",t),t?console.error("❌ Failed to create care_responses from rescheduled blocks:",t):e&&e.length>0&&e[0].success&&console.log("✅ Successfully created care_responses from rescheduled blocks:",e[0].care_responses_created)}catch(e){console.error("❌ Error calling create_care_responses_from_rescheduled_blocks:",e)}}o(),r()}catch(e){console.error("Error creating reschedule request:",e),y("Failed to create reschedule request. Please try again.")}finally{_(!1)}};return t?(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-full overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Reschedule Care Block"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Current Schedule"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Group:"})," ",n.group_name,(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Date:"})," ",new Date(n.care_date+"T00:00:00").toLocaleDateString(),(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Time:"})," ",n.start_time," - ",n.end_time,(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Children:"})," ",n.children&&n.children.length>0?n.children.map(e=>e.full_name).join(", "):"No children assigned"]})]}),(0,a.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Date"}),(0,a.jsx)("input",{type:"date",id:"newDate",value:l,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newStartTime",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Time"}),(0,a.jsx)("input",{type:"time",id:"newStartTime",value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newEndTime",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Time"}),(0,a.jsx)("input",{type:"time",id:"newEndTime",value:p,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Reschedule"}),(0,a.jsx)("textarea",{id:"reason",value:g,onChange:e=>h(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Please explain why you need to reschedule...",required:!0})]}),f&&(0,a.jsx)("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:f}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:x?"Creating...":"Create Reschedule Request"})]})]})]})}):null}}},function(e){e.O(0,[256,506,634,758,521,971,117,744],function(){return e(e.s=3825)}),_N_E=e.O()}]);