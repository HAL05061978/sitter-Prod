(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{950:function(e,t,s){Promise.resolve().then(s.bind(s,2231))},2231:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var l=s(7437),r=s(2265),a=s(9376),n=s(3519),o=s(3521),i=s(3837),d=s(1545);class c{async sendGroupInviteEmail(e){let{to:t,groupName:s,senderName:l,customNote:r,inviteId:a,appUrl:n}=e;try{if(!this.isProduction)return console.log("\uD83D\uDCE7 GROUP INVITE EMAIL (Development Mode):"),console.log("To: ".concat(t)),console.log("Subject: Group Invitation: ".concat(s)),console.log("From: ".concat(l)),console.log("Signup Link: ".concat(n,"/signup?invite=").concat(a)),console.log("Custom Note: ".concat(r||"None")),{success:!0};let{data:e,error:o}=await this.supabase.functions.invoke("send-group-invite",{body:{to:t,groupName:s,senderName:l,customNote:r,inviteId:a,appUrl:n}});if(o)return console.error("Email sending error:",o),{success:!1,error:o.message};return{success:!0}}catch(e){return console.error("Email service error:",e),{success:!1,error:e.message}}}async sendConfirmationEmail(e){let{to:t,userName:s,confirmationLink:l,appUrl:r}=e;try{if(!this.isProduction)return console.log("\uD83D\uDCE7 CONFIRMATION EMAIL (Development Mode):"),console.log("To: ".concat(t)),console.log("Subject: Welcome to Care-N-Care - Confirm Your Account"),console.log("Confirmation Link: ".concat(l)),{success:!0};let{data:e,error:a}=await this.supabase.functions.invoke("send-confirmation",{body:{to:t,userName:s,confirmationLink:l,appUrl:r}});if(a)return console.error("Confirmation email error:",a),{success:!1,error:a.message};return{success:!0}}catch(e){return console.error("Confirmation email service error:",e),{success:!1,error:e.message}}}async sendWelcomeEmail(e){let{to:t,userName:s,appUrl:l}=e;try{if(!this.isProduction)return console.log("\uD83D\uDCE7 WELCOME EMAIL (Development Mode):"),console.log("To: ".concat(t)),console.log("Subject: Welcome to Care-N-Care!"),console.log("App URL: ".concat(l)),{success:!0};let{data:e,error:r}=await this.supabase.functions.invoke("send-welcome",{body:{to:t,userName:s,appUrl:l}});if(r)return console.error("Welcome email error:",r),{success:!1,error:r.message};return{success:!0}}catch(e){return console.error("Welcome email service error:",e),{success:!1,error:e.message}}}constructor(){this.supabase=(0,d.eI)("https://hilkelodfneancwwzvoh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhpbGtlbG9kZm5lYW5jd3d6dm9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjk2OTEsImV4cCI6MjA3NDc0NTY5MX0.MoVQTvTpYcus2xpIZayAXxsCRgNgV8CoP69ZPd6locw"),this.isProduction=!0}}let u=new c;var m=s(6129),p=s(2644),x=s(7295);function h(e){let{image:t,onCropComplete:s,onCancel:a,aspectRatio:n=1,circularCrop:o=!0}=e,[i,d]=(0,r.useState)({x:0,y:0}),[c,u]=(0,r.useState)(1),[m,p]=(0,r.useState)(null),[h,b]=(0,r.useState)(!1),f=(0,r.useCallback)((e,t)=>{p(t)},[]),j=async()=>{if(m){b(!0);try{let e=await g(t,m);s(e)}catch(e){console.error("Error cropping image:",e),b(!1)}}};return(0,l.jsx)("div",{className:"fixed left-0 right-0 flex items-center justify-center bg-black bg-opacity-75 p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-4 max-w-2xl w-full mx-4 max-h-full flex flex-col",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Crop & Position Image"}),(0,l.jsx)("div",{className:"relative w-full h-96 bg-gray-900 rounded-lg mb-4",children:(0,l.jsx)(x.ZP,{image:t,crop:i,zoom:c,aspect:n,cropShape:o?"round":"rect",showGrid:!1,onCropChange:d,onCropComplete:f,onZoomChange:u})}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Zoom"}),(0,l.jsx)("input",{type:"range",min:1,max:3,step:.1,value:c,onChange:e=>u(parseFloat(e.target.value)),className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,l.jsx)("button",{onClick:a,disabled:h,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition disabled:opacity-50",children:"Cancel"}),(0,l.jsx)("button",{onClick:j,disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition disabled:opacity-50",children:h?"Processing...":"Apply & Upload"})]})]})})}async function g(e,t){let s=await new Promise((t,s)=>{let l=new Image;l.addEventListener("load",()=>t(l)),l.addEventListener("error",e=>s(e)),l.setAttribute("crossOrigin","anonymous"),l.src=e}),l=document.createElement("canvas"),r=l.getContext("2d");if(!r)throw Error("Could not get canvas context");return l.width=t.width,l.height=t.height,r.drawImage(s,t.x,t.y,t.width,t.height,0,0,t.width,t.height),new Promise((e,t)=>{l.toBlob(s=>{s?e(s):t(Error("Canvas is empty"))},"image/jpeg")})}var b=s(7072),f=s(7506),j=s(257);function v(){let e=(0,a.useRouter)(),{t}=(0,f.$G)(),[s,d]=(0,r.useState)(!0),[c,x]=(0,r.useState)(null),[g,v]=(0,r.useState)(null),[y,N]=(0,r.useState)([]),[w,_]=(0,r.useState)([]),[C,S]=(0,r.useState)([]),[D,k]=(0,r.useState)([]),[E,P]=(0,r.useState)([]),[O,q]=(0,r.useState)({}),[I,F]=(0,r.useState)({}),[A,L]=(0,r.useState)("profile"),[G,R]=(0,r.useState)(!1),[T,z]=(0,r.useState)(""),[M,U]=(0,r.useState)(""),[B,Z]=(0,r.useState)(""),[W,Y]=(0,r.useState)(""),[V,J]=(0,r.useState)(""),[H,X]=(0,r.useState)(""),[Q,K]=(0,r.useState)(""),[$,ee]=(0,r.useState)(""),[et,es]=(0,r.useState)(""),[el,er]=(0,r.useState)(""),[ea,en]=(0,r.useState)(""),[eo,ei]=(0,r.useState)(""),[ed,ec]=(0,r.useState)(""),[eu,em]=(0,r.useState)(""),[ep,ex]=(0,r.useState)(!1),[eh,eg]=(0,r.useState)(null),[eb,ef]=(0,r.useState)(!1),[ej,ev]=(0,r.useState)(null),[ey,eN]=(0,r.useState)(""),[ew,e_]=(0,r.useState)(null),[eC,eS]=(0,r.useState)(""),[eD,ek]=(0,r.useState)(""),[eE,eP]=(0,r.useState)(""),[eO,eq]=(0,r.useState)(""),[eI,eF]=(0,r.useState)(""),[eA,eL]=(0,r.useState)(""),[eG,eR]=(0,r.useState)(""),[eT,ez]=(0,r.useState)(!1),[eM,eU]=(0,r.useState)(""),[eB,eZ]=(0,r.useState)(""),[eW,eY]=(0,r.useState)(""),[eV,eJ]=(0,r.useState)(""),[eH,eX]=(0,r.useState)(""),[eQ,eK]=(0,r.useState)(""),[e$,e0]=(0,r.useState)([]),[e2,e1]=(0,r.useState)(!1),[e3,e4]=(0,r.useState)(""),[e5,e6]=(0,r.useState)(!1),[e7,e8]=(0,r.useState)([]),[e9,te]=(0,r.useState)(!1),[tt,ts]=(0,r.useState)(""),[tl,tr]=(0,r.useState)(!1),[ta,tn]=(0,r.useState)(!1),[to,ti]=(0,r.useState)(""),[td,tc]=(0,r.useState)(!1),[tu,tm]=(0,r.useState)(""),[tp,tx]=(0,r.useState)(""),[th,tg]=(0,r.useState)(""),[tb,tf]=(0,r.useState)(""),[tj,tv]=(0,r.useState)(""),[ty,tN]=(0,r.useState)(""),[tw,t_]=(0,r.useState)(""),[tC,tS]=(0,r.useState)(!1),[tD,tk]=(0,r.useState)(""),[tE,tP]=(0,r.useState)(null),[tO,tq]=(0,r.useState)(""),[tI,tF]=(0,r.useState)(""),[tA,tL]=(0,r.useState)(""),[tG,tR]=(0,r.useState)(""),[tT,tz]=(0,r.useState)(""),[tM,tU]=(0,r.useState)(""),[tB,tZ]=(0,r.useState)(""),[tW,tY]=(0,r.useState)(""),[tV,tJ]=(0,r.useState)(!1),[tH,tX]=(0,r.useState)(null),[tQ,tK]=(0,r.useState)(""),[t$,t0]=(0,r.useState)(null),[t2,t1]=(0,r.useState)(null),[t3,t4]=(0,r.useState)(""),[t5,t6]=(0,r.useState)(""),[t7,t8]=(0,r.useState)(""),[t9,se]=(0,r.useState)(!1),[st,ss]=(0,r.useState)(""),[sl,sr]=(0,r.useState)(""),[sa,sn]=(0,r.useState)("care"),[so,si]=(0,r.useState)(""),[sd,sc]=(0,r.useState)(!1),[su,sm]=(0,r.useState)(""),[sp,sx]=(0,r.useState)(""),[sh,sg]=(0,r.useState)("care"),[sb,sf]=(0,r.useState)(!1),[sj,sv]=(0,r.useState)(""),[sy,sN]=(0,r.useState)(""),[sw,s_]=(0,r.useState)(!1),[sC,sS]=(0,r.useState)([]),[sD,sk]=(0,r.useState)("receiving"),[sE,sP]=(0,r.useState)(""),[sO,sq]=(0,r.useState)(!1),[sI,sF]=(0,r.useState)(null),[sA,sL]=(0,r.useState)(""),[sG,sR]=(0,r.useState)(null),[sT,sz]=(0,r.useState)(null),sM=["profile","groups","children","pets"],sU=(0,b.QS)({onSwipedLeft:()=>{let e=sM.indexOf(A);e<sM.length-1&&L(sM[e+1])},onSwipedRight:()=>{let e=sM.indexOf(A);e>0&&L(sM[e-1])},trackMouse:!1,preventScrollOnSwipe:!1,delta:50});(0,r.useEffect)(()=>{n.O.auth.getUser().then(async t=>{let{data:s}=t;if(s.user){var l;x(s.user);let{data:t}=await n.O.from("profiles").select("full_name, email, phone, role, address, city, state, zip_code, bio, profile_photo_url, emergency_contact, emergency_contact_phone, profession, employer").eq("id",s.user.id).single();if((null==t?void 0:t.role)==="tutor"){e.replace("/tutor-dashboard");return}v(t);let r=null===(l=s.user.user_metadata)||void 0===l?void 0:l.pending_children;if(r&&Array.isArray(r)&&r.length>0){for(let e of(console.log("Found pending children in metadata:",r),await n.O.auth.updateUser({data:{pending_children:null}}),r)){let{error:t}=await n.O.from("children").insert({full_name:e.name,birthdate:e.birthdate,school_name:e.schoolName,grade:e.grade,town:e.town,zip_code:e.zipCode,parent_id:s.user.id});t&&console.error("Error creating child:",t)}console.log("Pending children created successfully")}let{data:a}=await n.O.from("children").select("*").eq("parent_id",s.user.id).order("created_at",{ascending:!1});N(a||[]);let{data:o}=await n.O.from("pets").select("*").eq("parent_id",s.user.id).order("created_at",{ascending:!1});_(o||[]),await sB(s.user.id,a||[]),d(!1)}else e.replace("/auth")})},[e]),(0,r.useEffect)(()=>{c&&sB(c.id,y)},[y,w,c]);let sB=async(e,t)=>{let{data:s}=await n.O.from("groups").select("*").eq("created_by",e).order("created_at",{ascending:!1}),{data:l}=await n.O.from("group_members").select("group_id, status").eq("profile_id",e).eq("status","active"),r=[];l&&(r=l.map(e=>e.group_id));let{data:a}=await n.O.from("groups").select("*").in("id",r).order("created_at",{ascending:!1}),o=[...s||[],...a||[]].filter((e,t,s)=>t===s.findIndex(t=>t.id===e.id));if(S(o),t.length>0){let e=t.map(e=>e.id),{data:s,error:l}=await n.O.from("child_group_members").select("*").in("child_id",e).eq("active",!0);l?console.error("Error loading memberships:",l):k(s||[])}if(w.length>0){let e=w.map(e=>e.id),{data:t,error:s}=await n.O.from("pet_group_members").select("*").in("pet_id",e).eq("active",!0);s?console.error("Error loading pet memberships:",s):P(t||[])}if(o&&o.length>0){let e=o.map(e=>e.id),{data:t}=await n.O.from("child_group_members").select("*").in("group_id",e).eq("active",!0);if(t&&t.length>0){let e=Array.from(new Set(t.map(e=>e.child_id))),{data:s}=await n.O.from("children").select("*, profiles!parent_id(full_name)").in("id",e);if(s){let e=s.map(e=>{var t;return{...e,parent_full_name:(null===(t=e.profiles)||void 0===t?void 0:t.full_name)||null}}),l={};o.forEach(s=>{let r=t.filter(e=>e.group_id===s.id);l[s.id]=r.map(t=>e.find(e=>e.id===t.child_id)).filter(Boolean)}),q(l)}}let{data:s}=await n.O.from("pet_group_members").select("*").in("group_id",e).eq("active",!0);if(s&&s.length>0){let e=Array.from(new Set(s.map(e=>e.pet_id))),{data:t}=await n.O.from("pets").select("*").in("id",e);if(t){let e=Array.from(new Set(t.map(e=>e.parent_id).filter(Boolean))),{data:l}=await n.O.from("profiles").select("id, full_name").in("id",e),r=new Map((l||[]).map(e=>[e.id,e.full_name])),a=t.map(e=>({...e,parent_full_name:r.get(e.parent_id)||null})),i={};o.forEach(e=>{let t=s.filter(t=>t.group_id===e.id);i[e.id]=t.map(e=>a.find(t=>t.id===e.pet_id)).filter(Boolean)}),F(i)}}}};function sZ(e){if(!e)return null;let t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6)," ").concat(t.slice(6)):e}function sW(e){if(!e)return null;let t=new Date,s=new Date(e),l=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth();return(r<0||0===r&&t.getDate()<s.getDate())&&l--,l}function sY(e){return e?new Date(e+"T00:00:00").toLocaleDateString():"Not set"}function sV(e){return e.created_by===(null==c?void 0:c.id)}let sJ=async e=>new Promise((t,s)=>{let l=new FileReader;l.onload=e=>{var l;let r=new Image;r.onload=()=>{let e=document.createElement("canvas"),l=r.width,a=r.height;l>a?l>800&&(a*=800/l,l=800):a>800&&(l*=800/a,a=800),e.width=l,e.height=a;let n=e.getContext("2d");n&&n.drawImage(r,0,0,l,a),e.toBlob(e=>{e?t(e):s(Error("Failed to compress image"))},"image/jpeg",.85)},r.onerror=()=>s(Error("Failed to load image")),r.src=null===(l=e.target)||void 0===l?void 0:l.result},l.onerror=()=>s(Error("Failed to read file")),l.readAsDataURL(e)}),sH=(e,t)=>{if(!e.type.startsWith("image/")){"profile"===t?eg("Please select an image file"):"child"===t?ev("Please select an image file"):tX("Please select an image file");return}if(e.size>10485760){let e="Image file is too large. Please select an image under 10MB.";"profile"===t?eg(e):"child"===t?ev(e):tX(e);return}let s=new FileReader;s.onload=()=>{sR(s.result),sz(t)},s.readAsDataURL(e)},sX=async e=>{if(c&&sT){"profile"===sT?(ex(!0),eg(null)):"child"===sT?(ef(!0),ev(null)):(tJ(!0),tX(null)),sR(null),sz(null);try{let t=await sJ(new File([e],"cropped.jpg",{type:"image/jpeg"})),s=new File([t],"cropped.jpg",{type:"image/jpeg"}),l="profile"===sT?"profile-photos":"child"===sT?"children-photos":"pet-photos",r="".concat(c.id,"/").concat(Date.now(),"_cropped.jpg"),{data:a,error:o}=await n.O.storage.from(l).upload(r,s,{cacheControl:"3600",upsert:!1});if(o)throw console.error("Upload error:",o),Error("Failed to upload photo");let{data:{publicUrl:i}}=n.O.storage.from(l).getPublicUrl(r);"profile"===sT?(es(i),eg(null)):"child"===sT?(eN(i),ev(null)):(tK(i),tX(null)),console.log("".concat(sT," photo uploaded successfully:"),i)}catch(t){console.error("Photo upload error:",t);let e="Failed to upload photo. Please try again.";"profile"===sT?eg(e):"child"===sT?ev(e):tX(e)}finally{"profile"===sT?ex(!1):"child"===sT?ef(!1):tJ(!1)}}};async function sQ(){if(em(""),!T.trim()){em("Full name is required");return}if(!B.trim()){em("Phone is required");return}if(10!==B.replace(/\D/g,"").length){em("Phone number must be 10 digits");return}if(Q&&5!==Q.length&&0!==Q.length){em("ZIP code must be 5 digits");return}let e={full_name:T.trim(),phone:B.trim(),address:W.trim()||null,city:V.trim()||null,state:H.trim()||null,zip_code:Q.trim()||null,bio:$.trim()||null,profile_photo_url:et.trim()||null,emergency_contact:el.trim()||null,emergency_contact_phone:ea.trim()||null,profession:eo.trim()||null,employer:ed.trim()||null};console.log("Updating profile with data:",e);let{data:t,error:s}=await n.O.from("profiles").update(e).eq("id",null==c?void 0:c.id).select();if(console.log("Update result:",{data:t,error:s}),s){em(s.message);return}v(t[0]),R(!1)}async function sK(e){if(K(e),J(""),5===e.length){let t=await (0,m.f)(e);t&&J(t.city)}}let s$=async e=>{if(e.preventDefault(),!c||!eM.trim()||!eB.trim()){ti("Please fill in all fields");return}if(eB>new Date().toISOString().split("T")[0]){ti("Birthdate cannot be in the future");return}let t=sW(eB);if(null!==t&&(t<0||t>18)){ti("Child must be between 0 and 18 years old");return}tn(!0),ti("");let{error:s}=await n.O.from("children").insert([{full_name:eM.trim(),birthdate:eB,parent_id:c.id,school_name:eW.trim()||null,grade:eV.trim()||null,town:eH.trim()||null,zip_code:eQ.trim()||null}]);if(tn(!1),s)ti(s.message);else{e5&&e3&&eQ&&await s5(e3,eQ,eH);let{data:e}=await n.O.from("children").select("*").eq("parent_id",c.id).order("created_at",{ascending:!1});N(e||[]),eU(""),eZ(""),eY(""),eJ(""),eX(""),eK(""),e6(!1),e4(""),ez(!1)}};async function s0(e){if(e_(e.id),eS(e.full_name),ek(e.birthdate||""),eP(e.school_name||""),eq(e.grade||""),eF(e.town||""),eL(e.zip_code||""),eN(e.photo_url||""),eR(""),ev(null),e.zip_code&&5===e.zip_code.length){te(!0);let{data:t,error:s}=await n.O.from("schools").select("*").eq("zip_code",e.zip_code).order("name");!s&&t&&e8(t),te(!1)}}async function s2(e){if(eR(""),!eC.trim()){eR("Child name is required");return}if(!eD.trim()){eR("Birthdate is required");return}if(eD>new Date().toISOString().split("T")[0]){eR("Birthdate cannot be in the future");return}let t={full_name:eC.trim(),birthdate:eD,school_name:(null==eE?void 0:eE.trim())||null,grade:(null==eO?void 0:eO.trim())||null,town:(null==eI?void 0:eI.trim())||null,zip_code:(null==eA?void 0:eA.trim())||null,photo_url:(null==ey?void 0:ey.trim())||null};console.log("Updating child with data:",t);let{data:s,error:l}=await n.O.from("children").update(t).eq("id",e.id).eq("parent_id",null==c?void 0:c.id).select();if(console.log("Update result:",{data:s,error:l}),l){eR(l.message);return}let{data:r,error:a}=await n.O.from("children").select("*").eq("parent_id",null==c?void 0:c.id).order("created_at",{ascending:!1});if(console.log("Fetched children after update:",r),a){eR(a.message);return}N(r||[]),e_(null)}function s1(){e_(null),eR("")}async function s3(e){if(eK(e),eX(""),e0([]),5===e.length){let t=await (0,m.f)(e);t&&eX(t.city),e1(!0);let{data:s,error:l}=await n.O.from("schools").select("*").eq("zip_code",e).order("name");!l&&s&&e0(s),e1(!1)}}async function s4(e){if(eL(e),eF(""),e8([]),5===e.length){let t=await (0,m.f)(e);t&&eF(t.city),te(!0);let{data:s,error:l}=await n.O.from("schools").select("*").eq("zip_code",e).order("name");!l&&s&&e8(s),te(!1)}}async function s5(e,t,s){try{console.log("Sending missing school notification:",{schoolName:e,zipCode:t,town:s}),await u.sendEmail({to:j.env.NEXT_PUBLIC_ADMIN_EMAIL||"admin@example.com",subject:"Missing School: ".concat(e," in ").concat(s," (").concat(t,")"),html:"\n          <h2>Missing School Notification</h2>\n          <p>A user has reported a school that is not in the database:</p>\n          <ul>\n            <li><strong>School Name:</strong> ".concat(e,"</li>\n            <li><strong>ZIP Code:</strong> ").concat(t,"</li>\n            <li><strong>Town:</strong> ").concat(s,"</li>\n          </ul>\n          <p>Please add this school to the database if appropriate.</p>\n          <p><em>Reported by user: ").concat((null==c?void 0:c.email)||"Unknown","</em></p>\n        "),text:"Missing School: ".concat(e,"\nZIP Code: ").concat(t,"\nTown: ").concat(s,"\n\nReported by: ").concat((null==c?void 0:c.email)||"Unknown")}),console.log("Missing school notification sent successfully")}catch(e){console.error("Error sending missing school notification:",e)}}let s6=async e=>{if(e.preventDefault(),!c||!tu.trim()){tk("Please enter a pet name");return}tS(!0),tk("");let{data:t,error:s}=await n.O.from("pets").insert([{parent_id:c.id,name:tu.trim(),species:tp.trim()||null,breed:th.trim()||null,age:tb?parseInt(tb):null,birthdate:tj||null,special_needs:ty.trim()||null,notes:tw.trim()||null}]).select();tS(!1),s?tk(s.message):(t&&_([...w,t[0]]),tm(""),tx(""),tg(""),tf(""),tv(""),tN(""),t_(""),tc(!1))};async function s7(e){if(tY(""),!tO.trim()){tY("Pet name is required");return}let{data:t,error:s}=await n.O.from("pets").update({name:tO.trim(),species:tI.trim()||null,breed:tA.trim()||null,age:tG?parseInt(tG):null,birthdate:tT||null,special_needs:tM.trim()||null,notes:tB.trim()||null,photo_url:(null==tQ?void 0:tQ.trim())||null}).eq("id",e.id).eq("parent_id",null==c?void 0:c.id).select();if(s){tY(s.message);return}let{data:l,error:r}=await n.O.from("pets").select("*").eq("parent_id",null==c?void 0:c.id).order("created_at",{ascending:!1});if(r){tY(r.message);return}_(l||[]),tP(null)}function s8(){tP(null),tY("")}let s9=async e=>{if(e.preventDefault(),!c||!su.trim()){sv("Please enter a group name");return}sf(!0),sv("");let{data:t,error:s}=await n.O.from("groups").insert([{name:su.trim(),description:sp.trim()||null,created_by:c.id,group_type:sh}]).select();if(s){sf(!1),sv(s.message);return}let l=t&&t[0];if(!l){sf(!1),sv("Failed to create group.");return}let{error:r}=await n.O.from("group_members").insert([{group_id:l.id,profile_id:c.id,role:"parent",joined_at:new Date().toISOString()}]);if(sf(!1),r){sv("Group created, but failed to add you as a member: "+r.message);return}await sB(c.id,y),sm(""),sx(""),sg("care"),sc(!1)};function le(e){t0(e.id),ss(e.name),sr(e.description||""),sn(e.group_type),si("")}async function lt(e){if(si(""),!st.trim()){si("Group name is required");return}let{error:t}=await n.O.from("groups").update({name:st.trim(),description:sl.trim(),group_type:sa}).eq("id",e.id).eq("created_by",null==c?void 0:c.id).select();if(t){si(t.message);return}S(t=>t.map(t=>t.id===e.id?{...t,name:st.trim(),description:sl.trim(),group_type:sa}:t)),t0(null)}function ls(){t0(null),si("")}function ll(e){t1(e.id),t4(""),t6(""),t8("")}function lr(){t1(null),t8(""),t4(""),t6(""),se(!1)}async function la(e,t){if(e.preventDefault(),se(!0),t8(""),!t3.trim()){t8("Email is required"),se(!1);return}if((null==g?void 0:g.email)&&t3.trim().toLowerCase()===g.email.toLowerCase()){t8("You cannot invite yourself to your own group"),se(!1);return}let s=(null==g?void 0:g.full_name)||(null==c?void 0:c.email)||"A parent",l=t.name,r=t5.trim()?"\n\nNote from ".concat(s,": ").concat(t5.trim()):"",a=("You have been invited to join the group '".concat(l,"' by ").concat(s,".").concat(r),(0,i.Z)()),{error:o}=await n.O.from("group_invites").insert([{id:a,group_id:t.id,email:t3.trim().toLowerCase(),invited_by:null==c?void 0:c.id,status:"pending"}]);if(o){t8(o.message),se(!1);return}let{data:d,error:m}=await n.O.from("group_members").select("profile_id").eq("group_id",t.id);if(m){t8(m.message),se(!1);return}let p=(d||[]).map(e=>e.profile_id).filter(Boolean);(null==c?void 0:c.id)&&!p.includes(c.id)&&p.push(c.id);{let e="http://localhost:3000";"".concat(e,"/signup?invite=").concat(a);let t=await u.sendGroupInviteEmail({to:t3.trim().toLowerCase(),groupName:l,senderName:s,customNote:t5.trim()||void 0,inviteId:a,appUrl:e});if(!t.success){t8(t.error||"Failed to send invitation email"),se(!1);return}t8(""),t1(null),t4(""),t6(""),se(!1),alert("Invitation email sent! The recipient will receive a link to create an account and join your group.")}}async function ln(e,t){if(sN(""),E.find(s=>s.pet_id===e.id&&s.group_id===t.id))try{console.log("\uD83D\uDD04 Deactivating pet from group:",e.id,t.id);let{error:s}=await n.O.from("pet_group_members").update({active:!1}).eq("pet_id",e.id).eq("group_id",t.id);if(s){console.error("❌ Error deactivating pet from group:",s),sN("Failed to remove pet from group");return}console.log("✅ Pet deactivated successfully"),P(E.filter(s=>!(s.pet_id===e.id&&s.group_id===t.id))),F({...I,[t.id]:(I[t.id]||[]).filter(t=>t.id!==e.id)}),console.log("\uD83D\uDD04 UI updated optimistically")}catch(e){console.error("❌ Error removing pet from group:",e),sN("Failed to remove pet from group")}else try{console.log("\uD83D\uDD04 Activating pet in group:",e.id,t.id);let{error:s}=await n.O.from("pet_group_members").upsert({pet_id:e.id,group_id:t.id,added_by:c.id,active:!0},{onConflict:"pet_id,group_id"});if(s){console.error("❌ Error activating pet in group:",s),sN("Failed to add pet to group");return}console.log("✅ Pet activated successfully");let l={id:(0,i.Z)(),pet_id:e.id,group_id:t.id,added_by:c.id,added_at:new Date().toISOString(),active:!0};P([...E,l]);let r={...e,parent_full_name:(null==g?void 0:g.full_name)||"You"};F({...I,[t.id]:[...I[t.id]||[],r]}),console.log("\uD83D\uDD04 UI updated optimistically")}catch(e){console.error("❌ Error adding pet to group:",e),sN("Failed to add pet to group")}}async function lo(e,t){if(sN(""),D.find(s=>s.child_id===e.id&&s.group_id===t.id))try{console.log("\uD83D\uDD04 Deactivating child from group:",e.id,t.id);let{error:s}=await n.O.from("child_group_members").update({active:!1}).eq("child_id",e.id).eq("group_id",t.id);if(s){console.error("❌ Error deactivating child from group:",s),sN("Failed to remove child from group");return}console.log("✅ Child deactivated successfully"),k(D.filter(s=>!(s.child_id===e.id&&s.group_id===t.id))),q({...O,[t.id]:(O[t.id]||[]).filter(t=>t.id!==e.id)}),console.log("\uD83D\uDD04 UI updated optimistically")}catch(e){console.error("❌ Error removing child from group:",e),sN("Failed to remove child from group")}else try{console.log("\uD83D\uDD04 Activating child in group:",e.id,t.id);let{data:s}=await n.O.from("child_group_members").select("*").eq("child_id",e.id).eq("group_id",t.id).single();if(s){let{error:s}=await n.O.from("child_group_members").update({active:!0}).eq("child_id",e.id).eq("group_id",t.id);if(s){console.error("❌ Error reactivating child in group:",s),sN("Failed to add child to group");return}}else{let{error:s}=await n.O.from("child_group_members").insert({child_id:e.id,group_id:t.id,parent_id:c.id,added_by:c.id,active:!0});if(s){console.error("❌ Error adding child to group:",s),sN("Failed to add child to group");return}}console.log("✅ Child activated successfully");let l={id:(0,i.Z)(),child_id:e.id,group_id:t.id,added_by:c.id,added_at:new Date().toISOString(),active:!0};k([...D,l]);let r={...e,parent_full_name:(null==g?void 0:g.full_name)||"You"};q({...O,[t.id]:[...O[t.id]||[],r]}),console.log("\uD83D\uDD04 UI updated optimistically")}catch(e){console.error("❌ Error adding child to group:",e),sN("Failed to add child to group")}}return s?(0,l.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:"Loading..."}):(0,l.jsxs)(o.Z,{currentPage:"dashboard",children:[(0,l.jsxs)("div",{className:"p-3 sm:p-4 md:p-6 max-w-7xl mx-auto bg-white",children:[(0,l.jsxs)("div",{className:"flex border-b border-gray-200 mb-4 sm:mb-6 overflow-x-auto",children:[(0,l.jsx)("button",{onClick:()=>L("profile"),className:"px-3 sm:px-4 md:px-6 py-2 sm:py-3 font-medium text-xs sm:text-sm md:text-base transition-colors whitespace-nowrap ".concat("profile"===A?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:t("profile")}),(0,l.jsx)("button",{onClick:()=>L("groups"),className:"px-3 sm:px-4 md:px-6 py-2 sm:py-3 font-medium text-xs sm:text-sm md:text-base transition-colors whitespace-nowrap ".concat("groups"===A?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:t("groups")}),(0,l.jsx)("button",{onClick:()=>L("children"),className:"px-3 sm:px-4 md:px-6 py-2 sm:py-3 font-medium text-xs sm:text-sm md:text-base transition-colors whitespace-nowrap ".concat("children"===A?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:t("children")}),(0,l.jsx)("button",{onClick:()=>L("pets"),className:"px-3 sm:px-4 md:px-6 py-2 sm:py-3 font-medium text-xs sm:text-sm md:text-base transition-colors whitespace-nowrap ".concat("pets"===A?"border-b-2 border-purple-600 text-purple-600":"text-gray-500 hover:text-gray-700"),children:t("pets")})]}),(0,l.jsxs)("div",{...sU,children:["profile"===A&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-3 sm:p-4 md:p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-lg sm:text-xl font-semibold",children:t("profile")}),!G&&(0,l.jsx)("button",{onClick:function(){R(!0),z((null==g?void 0:g.full_name)||""),U((null==g?void 0:g.email)||""),Z((null==g?void 0:g.phone)||""),Y((null==g?void 0:g.address)||""),J((null==g?void 0:g.city)||""),X((null==g?void 0:g.state)||""),K((null==g?void 0:g.zip_code)||""),ee((null==g?void 0:g.bio)||""),es((null==g?void 0:g.profile_photo_url)||""),er((null==g?void 0:g.emergency_contact)||""),en((null==g?void 0:g.emergency_contact_phone)||""),ei((null==g?void 0:g.profession)||""),ec((null==g?void 0:g.employer)||""),em("")},className:"px-4 py-2 bg-blue-600 text-white text-sm sm:text-base rounded-lg hover:bg-blue-700 transition shadow-soft hover:shadow-medium",children:t("editProfile")})]}),G?(0,l.jsxs)("div",{className:"space-y-4",children:[eu&&(0,l.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 text-red-600 rounded-lg text-sm",children:eu}),(0,l.jsxs)("div",{className:"border border-blue-200 rounded-lg p-4 bg-blue-50",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:t("profilePhoto")}),(0,l.jsxs)("label",{className:"cursor-pointer",children:[(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&sH(s,"profile"),e.target.value=""},className:"hidden",disabled:ep}),(0,l.jsxs)("div",{className:"p-2 rounded-lg transition flex items-center gap-2 ".concat(ep?"bg-gray-200 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"),title:"Upload Photo from Camera/Gallery",children:[(0,l.jsxs)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,l.jsx)("span",{className:"text-white text-sm font-medium",children:ep?t("uploading"):t("choosePhoto")})]})]})]}),(0,l.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Upload a photo from your camera or gallery (max 10MB, automatically compressed)"}),ep&&(0,l.jsx)("p",{className:"text-sm text-blue-600 mt-2",children:"Uploading and compressing photo..."}),eh&&(0,l.jsx)("p",{className:"text-sm text-red-600 mt-2",children:eh}),et&&!ep&&(0,l.jsx)("div",{className:"mt-3 flex justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"Preview:"}),(0,l.jsx)("img",{src:et,alt:"Profile Preview",className:"w-32 h-32 rounded-full object-cover border-4 border-blue-300",onError:e=>{e.target.style.display="none"}})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("fullName")," *"]}),(0,l.jsx)("input",{type:"text",value:T,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("phone")," *"]}),(0,l.jsx)("input",{type:"tel",value:B,onChange:e=>Z(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(123) 456-7890",required:!0})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("emailReadOnly")}),(0,l.jsx)("input",{type:"email",value:(null==g?void 0:g.email)||(null==c?void 0:c.email)||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed",readOnly:!0,disabled:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("bioAboutMe")}),(0,l.jsx)("textarea",{value:$,onChange:e=>ee(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tell us about yourself...",rows:4})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("profession")}),(0,l.jsx)("input",{type:"text",value:eo,onChange:e=>ei(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Teacher, Engineer"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("employer")}),(0,l.jsx)("input",{type:"text",value:ed,onChange:e=>ec(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Company name"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("address")}),(0,l.jsx)("input",{type:"text",value:W,onChange:e=>Y(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Street address"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("city")}),(0,l.jsx)("input",{type:"text",value:V,onChange:e=>J(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"City name"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("state")}),(0,l.jsx)("input",{type:"text",value:H,onChange:e=>X(e.target.value.toUpperCase()),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"CA",maxLength:2})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("zipCode")}),(0,l.jsx)("input",{type:"text",value:Q,onChange:e=>sK(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"12345",maxLength:5})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("emergencyContactName")}),(0,l.jsx)("input",{type:"text",value:el,onChange:e=>er(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contact name"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("emergencyContactPhone")}),(0,l.jsx)("input",{type:"tel",value:ea,onChange:e=>en(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(123) 456-7890"})]})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[(0,l.jsx)("button",{onClick:sQ,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:t("saveChanges")}),(0,l.jsx)("button",{onClick:function(){R(!1),em("")},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition",children:t("cancel")})]})]}):(0,l.jsxs)("div",{className:"space-y-4 text-sm sm:text-base",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(null==g?void 0:g.profile_photo_url)?(0,l.jsx)("img",{src:g.profile_photo_url,alt:"Profile",className:"w-32 h-32 rounded-full object-cover border-4 border-blue-200",onError:e=>{e.target.style.display="none"}}):(0,l.jsx)("div",{className:"w-32 h-32 rounded-full bg-gray-200 border-4 border-gray-300 flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:t("noPhoto")})})}),(0,l.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("name"),":"]})," ",(null==g?void 0:g.full_name)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("phone"),":"]})," ",sZ(null==g?void 0:g.phone)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("email"),":"]})," ",(null==g?void 0:g.email)||(null==c?void 0:c.email)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]})]})]}),(null==g?void 0:g.bio)&&(0,l.jsxs)("div",{className:"pt-2 border-t",children:[(0,l.jsxs)("strong",{children:[t("bio"),":"]})," ",(0,l.jsx)("p",{className:"mt-1 text-gray-700",children:g.bio})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2 border-t",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("profession"),":"]})," ",(null==g?void 0:g.profession)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("employer"),":"]})," ",(null==g?void 0:g.employer)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]})]}),(0,l.jsxs)("div",{className:"space-y-1 pt-2 border-t",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("strong",{children:[t("address"),":"]})}),(0,l.jsxs)("div",{className:"pl-4",children:[(0,l.jsx)("div",{children:(null==g?void 0:g.address)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})}),(0,l.jsxs)("div",{children:[(null==g?void 0:g.city)||(0,l.jsxs)("span",{className:"text-gray-400",children:["(",t("city"),")"]}),", ",(null==g?void 0:g.state)||(0,l.jsxs)("span",{className:"text-gray-400",children:["(",t("state"),")"]})," ",(null==g?void 0:g.zip_code)||(0,l.jsxs)("span",{className:"text-gray-400",children:["(",t("zip"),")"]})]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2 border-t",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("emergencyContact"),":"]})," ",(null==g?void 0:g.emergency_contact)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("emergencyPhone"),":"]})," ",sZ(null==g?void 0:g.emergency_contact_phone)||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]})]})]})]}),"children"===A&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-3 sm:p-4 md:p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-lg sm:text-xl font-semibold",children:t("children")}),(0,l.jsx)("button",{onClick:()=>ez(!eT),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-soft hover:shadow-medium",children:eT?t("cancel"):t("addChild")})]}),eT&&(0,l.jsxs)("form",{onSubmit:s$,className:"mb-6 p-3 sm:p-4 bg-white rounded-lg border border-cyan-200",children:[(0,l.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-3 sm:mb-4",children:t("addNewChild")}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("childName")," *"]}),(0,l.jsx)("input",{type:"text",value:eM,onChange:e=>eU(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter child's name",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("birthdate")," *"]}),(0,l.jsx)("input",{type:"date",value:eB,onChange:e=>eZ(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",max:new Date().toISOString().split("T")[0],required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("zipCode")}),(0,l.jsx)("input",{type:"text",value:eQ,onChange:e=>s3(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter zip code",maxLength:5})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("town")}),(0,l.jsx)("input",{type:"text",value:eH,onChange:e=>eX(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Auto-filled from ZIP code"}),eH&&(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-populated from ZIP code"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("schoolName")}),e2?(0,l.jsx)("div",{className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-gray-500",children:t("loadingSchools")}):e5?(0,l.jsxs)("div",{children:[(0,l.jsx)("input",{type:"text",value:e3,onChange:e=>{e4(e.target.value),eY(e.target.value)},className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter the school name not shown",autoFocus:!0}),(0,l.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"We'll notify the admin to add this school to the database."}),(0,l.jsx)("button",{type:"button",onClick:()=>{e6(!1),e4("")},className:"text-xs text-blue-600 hover:text-blue-700 mt-1",children:"Back to school list"})]}):e$.length>0?(0,l.jsxs)("select",{value:eW,onChange:e=>{let t=e.target.value;"__missing__"===t?(e6(!0),eY("")):"__custom__"===t?eY(""):eY(t)},className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,l.jsx)("option",{value:"",children:"Select a school"}),e$.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id)),(0,l.jsx)("option",{value:"__missing__",children:"\uD83D\uDD14 School not shown (notify admin)"}),(0,l.jsx)("option",{value:"__custom__",children:"✏️ Other (type manually)"})]}):(0,l.jsx)("input",{type:"text",value:eW,onChange:e=>eY(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter school name or ZIP code first"}),"__custom__"===eW&&!e5&&(0,l.jsx)("input",{type:"text",value:"",onChange:e=>eY(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mt-2",placeholder:"Enter school name",autoFocus:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("grade")}),(0,l.jsx)("input",{type:"text",value:eV,onChange:e=>eJ(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter grade (e.g., 4, K, 12)"})]})]}),to&&(0,l.jsx)("div",{className:"text-red-600 mb-4",children:to}),(0,l.jsx)("button",{type:"submit",disabled:ta,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 shadow-soft hover:shadow-medium",children:ta?t("adding"):t("addChild")})]}),0===y.length?(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,l.jsx)("p",{children:t("noChildren")}),(0,l.jsx)("p",{className:"text-sm",children:t("clickAddChild")})]}):(0,l.jsx)("div",{className:"space-y-4",children:y.map(e=>{let s=sW(e.birthdate);return(0,l.jsx)("div",{className:"border border-cyan-200 rounded-lg p-4 flex flex-col gap-2 bg-white",children:ew===e.id?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"border border-blue-200 rounded-lg p-4 bg-blue-50 mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"block font-medium",children:t("childPhotoOptional")}),(0,l.jsxs)("label",{className:"cursor-pointer",children:[(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&sH(s,"child"),e.target.value=""},className:"hidden",disabled:eb}),(0,l.jsxs)("div",{className:"p-2 rounded-lg transition flex items-center gap-2 ".concat(eb?"bg-gray-200 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"),title:"Upload Photo from Camera/Gallery",children:[(0,l.jsxs)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,l.jsx)("span",{className:"text-white text-sm font-medium",children:eb?t("uploading"):t("choosePhoto")})]})]})]}),(0,l.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Upload a photo from your camera or gallery (max 10MB, automatically compressed)"}),eb&&(0,l.jsx)("p",{className:"text-sm text-blue-600 mt-2",children:"Uploading and compressing photo..."}),ej&&(0,l.jsx)("p",{className:"text-sm text-red-600 mt-2",children:ej}),ey&&!eb&&(0,l.jsx)("div",{className:"mt-3 flex justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"Preview:"}),(0,l.jsx)("img",{src:ey,alt:"Child Preview",className:"w-24 h-24 rounded-full object-cover border-4 border-blue-300",onError:e=>{e.target.style.display="none"}})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("childName")," *"]}),(0,l.jsx)("input",{type:"text",value:eC,onChange:e=>eS(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Child's name",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("birthdate")," *"]}),(0,l.jsx)("input",{type:"date",value:eD,onChange:e=>ek(e.target.value),className:"w-full px-3 py-2 border rounded",max:new Date().toISOString().split("T")[0],required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("zipCode")}),(0,l.jsx)("input",{type:"text",value:eA,onChange:e=>s4(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Zip code",maxLength:5})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("town")}),(0,l.jsx)("input",{type:"text",value:eI,onChange:e=>eF(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Auto-filled from ZIP code"}),eI&&(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-populated from ZIP code"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("schoolName")}),e9?(0,l.jsx)("div",{className:"w-full px-3 py-2 border rounded text-gray-500",children:t("loadingSchools")}):e7.length>0?(0,l.jsxs)("select",{value:eE,onChange:e=>eP(e.target.value),className:"w-full px-3 py-2 border rounded",children:[(0,l.jsx)("option",{value:"",children:"Select a school"}),e7.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id)),(0,l.jsx)("option",{value:"__custom__",children:"Other (type manually)"})]}):(0,l.jsx)("input",{type:"text",value:eE,onChange:e=>eP(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Enter school name or ZIP code first"}),"__custom__"===eE&&(0,l.jsx)("input",{type:"text",value:"",onChange:e=>eP(e.target.value),className:"w-full px-3 py-2 border rounded mt-2",placeholder:"Enter school name",autoFocus:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("grade")}),(0,l.jsx)("input",{type:"text",value:eO,onChange:e=>eq(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Grade"})]})]}),eG&&(0,l.jsx)("div",{className:"text-red-600 mt-2",children:eG}),(0,l.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,l.jsx)("button",{type:"button",onClick:()=>s2(e),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:t("save")}),(0,l.jsx)("button",{onClick:s1,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition",children:t("cancel")})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("span",{className:"font-medium text-lg",children:e.full_name}),(0,l.jsx)("button",{onClick:()=>s0(e),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:t("edit")})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,l.jsxs)("div",{className:"flex-shrink-0",children:[e.photo_url?(0,l.jsx)("img",{src:e.photo_url,alt:e.full_name,className:"w-24 h-24 rounded-full object-cover border-4 border-blue-200",onError:e=>{let t=e.target;t.style.display="none";let s=t.nextElementSibling;s&&(s.style.display="flex")}}):null,(0,l.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-400 to-cyan-400 border-4 border-blue-200 flex items-center justify-center",style:{display:e.photo_url?"none":"flex"},children:(0,l.jsx)("span",{className:"text-white text-2xl font-bold",children:e.full_name.charAt(0).toUpperCase()})})]}),(0,l.jsxs)("div",{className:"flex-1 space-y-2 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("name"),":"]})," ",e.full_name]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("birthday"),":"]})," ",sY(e.birthdate)]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("age"),":"]})," ",null!==s?"".concat(s," ").concat(t("yearsOld")):t("unknown")]})]})]}),(e.school_name||e.grade)&&(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("school"),":"]}),(0,l.jsx)("div",{className:"text-gray-700",children:e.school_name||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("grade"),":"]}),(0,l.jsx)("div",{className:"text-gray-700",children:e.grade||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})})]})]}),(e.town||e.zip_code)&&(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("town"),":"]}),(0,l.jsx)("div",{className:"text-gray-700",children:e.town||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("zipCode"),":"]}),(0,l.jsx)("div",{className:"text-gray-700",children:e.zip_code||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})})]})]}),(0,l.jsxs)("p",{className:"text-xs text-gray-400 mt-3 pt-2 border-t",children:["Added: ",new Date(e.created_at).toLocaleDateString()]})]})},e.id)})})]}),"pets"===A&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-lg sm:text-xl font-semibold",children:t("pets")}),(0,l.jsx)("button",{onClick:()=>tc(!td),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition shadow-soft hover:shadow-medium",children:td?t("cancel"):t("addPet")})]}),td&&(0,l.jsxs)("form",{onSubmit:s6,className:"mb-6 p-4 bg-white rounded-lg border border-purple-200",children:[(0,l.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-4",children:t("addNewPet")}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("petName")}),(0,l.jsx)("input",{type:"text",value:tu,onChange:e=>tm(e.target.value),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter pet's name",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("species")}),(0,l.jsx)("input",{type:"text",value:tp,onChange:e=>tx(e.target.value),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"e.g., Dog, Cat, Bird"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("breed")}),(0,l.jsx)("input",{type:"text",value:th,onChange:e=>tg(e.target.value),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter breed"})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("petAge")," (",t("yearsOld"),")"]}),(0,l.jsx)("input",{type:"number",value:tb,onChange:e=>tf(e.target.value),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter age",min:"0"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("petBirthdate")}),(0,l.jsx)("input",{type:"date",value:tj,onChange:e=>tv(e.target.value),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",max:new Date().toISOString().split("T")[0]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("specialNeeds")}),(0,l.jsx)("input",{type:"text",value:ty,onChange:e=>tN(e.target.value),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Any special care requirements"})]}),(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("notes")}),(0,l.jsx)("textarea",{value:tw,onChange:e=>t_(e.target.value),className:"w-full px-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Additional information about your pet",rows:3})]})]}),tD&&(0,l.jsx)("div",{className:"text-red-600 mb-4",children:tD}),(0,l.jsx)("button",{type:"submit",disabled:tC,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 shadow-soft hover:shadow-medium",children:tC?t("adding"):t("addPet")})]}),0===w.length?(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,l.jsx)("p",{children:t("noPets")}),(0,l.jsx)("p",{className:"text-sm",children:t("clickAddPet")})]}):(0,l.jsx)("div",{className:"space-y-4",children:w.map(e=>(0,l.jsx)("div",{className:"border border-purple-200 rounded-lg p-4 flex flex-col gap-2 bg-white",children:tE===e.id?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"border border-purple-200 rounded-lg p-4 bg-purple-50 mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"block font-medium",children:t("petPhotoOptional")}),(0,l.jsxs)("label",{className:"cursor-pointer",children:[(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&sH(s,"pet"),e.target.value=""},className:"hidden",disabled:tV}),(0,l.jsxs)("div",{className:"p-2 rounded-lg transition flex items-center gap-2 ".concat(tV?"bg-gray-200 cursor-not-allowed":"bg-purple-500 hover:bg-purple-600"),title:"Upload Photo from Camera/Gallery",children:[(0,l.jsxs)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,l.jsx)("span",{className:"text-white text-sm font-medium",children:tV?t("uploading"):t("choosePhoto")})]})]})]}),(0,l.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Upload a photo from your camera or gallery (max 10MB, automatically compressed)"}),tV&&(0,l.jsx)("p",{className:"text-sm text-purple-600 mt-2",children:"Uploading and compressing photo..."}),tH&&(0,l.jsx)("p",{className:"text-sm text-red-600 mt-2",children:tH}),tQ&&!tV&&(0,l.jsx)("div",{className:"mt-3 flex justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"Preview:"}),(0,l.jsx)("img",{src:tQ,alt:"Pet Preview",className:"w-24 h-24 rounded-full object-cover border-4 border-purple-300",onError:e=>{e.target.style.display="none"}})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)("input",{type:"text",value:tO,onChange:e=>tq(e.target.value),className:"px-3 py-2 border rounded",placeholder:"Pet's name",required:!0}),(0,l.jsx)("input",{type:"text",value:tI,onChange:e=>tF(e.target.value),className:"px-3 py-2 border rounded",placeholder:"Species"}),(0,l.jsx)("input",{type:"text",value:tA,onChange:e=>tL(e.target.value),className:"px-3 py-2 border rounded",placeholder:"Breed"}),(0,l.jsx)("input",{type:"number",value:tG,onChange:e=>tR(e.target.value),className:"px-3 py-2 border rounded",placeholder:"Age",min:"0"}),(0,l.jsx)("input",{type:"date",value:tT,onChange:e=>tz(e.target.value),className:"px-3 py-2 border rounded",max:new Date().toISOString().split("T")[0]}),(0,l.jsx)("input",{type:"text",value:tM,onChange:e=>tU(e.target.value),className:"px-3 py-2 border rounded",placeholder:"Special needs"})]}),(0,l.jsx)("textarea",{value:tB,onChange:e=>tZ(e.target.value),className:"px-3 py-2 border rounded",placeholder:"Notes",rows:2}),tW&&(0,l.jsx)("div",{className:"text-red-600 mb-2",children:tW}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>s7(e),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:"Save"}),(0,l.jsx)("button",{onClick:s8,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition",children:"Cancel"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("span",{className:"font-medium text-lg",children:e.name}),(0,l.jsx)("button",{onClick:()=>{var t;tP(e.id),tq(e.name),tF(e.species||""),tL(e.breed||""),tR((null===(t=e.age)||void 0===t?void 0:t.toString())||""),tz(e.birthdate||""),tU(e.special_needs||""),tZ(e.notes||""),tK(e.photo_url||""),tY(""),tX(null)},className:"px-3 py-1 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:t("edit")})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,l.jsxs)("div",{className:"flex-shrink-0",children:[e.photo_url?(0,l.jsx)("img",{src:e.photo_url,alt:e.name,className:"w-24 h-24 rounded-full object-cover border-4 border-purple-200",onError:e=>{let t=e.target;t.style.display="none";let s=t.nextElementSibling;s&&(s.style.display="flex")}}):null,(0,l.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 border-4 border-purple-200 flex items-center justify-center",style:{display:e.photo_url?"none":"flex"},children:(0,l.jsx)("span",{className:"text-white text-2xl font-bold",children:e.name.charAt(0).toUpperCase()})})]}),(0,l.jsxs)("div",{className:"flex-1 space-y-2 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("name"),":"]})," ",e.name]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("species"),":"]})," ",e.species||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[t("breed"),":"]})," ",e.breed||(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})]})]})]}),(null!==e.age||e.birthdate)&&(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("age"),":"]}),(0,l.jsx)("div",{className:"text-gray-700",children:null!==e.age?"".concat(e.age," ").concat(t("yearsOld")):(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("birthday"),":"]}),(0,l.jsx)("div",{className:"text-gray-700",children:e.birthdate?sY(e.birthdate):(0,l.jsx)("span",{className:"text-gray-400",children:t("notSet")})})]})]}),e.special_needs&&(0,l.jsxs)("div",{className:"mt-3 pt-3 border-t",children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("specialNeeds"),":"]}),(0,l.jsx)("div",{className:"text-gray-700 mt-1",children:e.special_needs})]}),e.notes&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsxs)("strong",{className:"text-sm",children:[t("notes"),":"]}),(0,l.jsx)("div",{className:"text-gray-700 mt-1",children:e.notes})]}),(0,l.jsxs)("p",{className:"text-xs text-gray-400 mt-3 pt-2 border-t",children:["Added: ",new Date(e.created_at).toLocaleDateString()]})]})},e.id))})]}),"groups"===A&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-lg sm:text-xl font-semibold",children:t("groups")}),(0,l.jsx)("button",{onClick:()=>sc(!sd),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium shadow-soft hover:shadow-medium",children:sd?t("cancel"):t("addGroup")})]}),sy&&(0,l.jsx)("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded",children:sy}),sd&&(0,l.jsxs)("form",{onSubmit:s9,className:"mb-4 p-4 bg-white rounded-lg border border-cyan-200",children:[(0,l.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-4",children:t("createNewGroup")}),(0,l.jsxs)("div",{className:"space-y-4 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("groupType")}),(0,l.jsxs)("select",{value:sh,onChange:e=>sg(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-500",children:[(0,l.jsx)("option",{value:"care",children:t("careGroup")}),(0,l.jsx)("option",{value:"pet",children:t("petGroup")})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:t("groupName")}),(0,l.jsx)("input",{type:"text",value:su,onChange:e=>sm(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter group name",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[t("description")," (",t("optional"),")"]}),(0,l.jsx)("textarea",{value:sp,onChange:e=>sx(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter group description",rows:3})]})]}),sj&&(0,l.jsx)("div",{className:"text-red-600 mb-4",children:sj}),(0,l.jsx)("button",{type:"submit",disabled:sb,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition disabled:opacity-50",children:sb?t("creating"):t("createGroup")})]}),0===C.length?(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,l.jsx)("p",{children:t("noGroups")}),(0,l.jsx)("p",{className:"text-sm",children:t("createGroupFirst")})]}):(0,l.jsxs)("div",{className:"space-y-8",children:[C.filter(e=>"pet"!==e.group_type).length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-4 text-blue-800 flex items-center gap-2",children:(0,l.jsx)("span",{className:"px-3 py-1 bg-blue-100 rounded",children:t("childrenGroups")})}),(0,l.jsx)("div",{className:"space-y-6",children:C.filter(e=>"pet"!==e.group_type).map(e=>{let s=O[e.id]||[];return I[e.id],sV(e),(0,l.jsxs)("div",{className:"border border-cyan-200 rounded p-6 bg-white",children:[(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold mb-2",children:e.name}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>le(e),className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:t("edit")}),(0,l.jsx)("button",{onClick:()=>ll(e),className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition",children:t("invite")})]})]}),t$===e.id?(0,l.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,l.jsx)("h4",{className:"font-medium mb-3",children:"Edit Group"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Group Type"}),(0,l.jsxs)("select",{value:sa,onChange:e=>sn(e.target.value),className:"w-full px-3 py-2 border rounded",children:[(0,l.jsx)("option",{value:"care",children:"Care Group (For child care)"}),(0,l.jsx)("option",{value:"pet",children:"Pet Group (For pet care)"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Group Name"}),(0,l.jsx)("input",{type:"text",value:st,onChange:e=>ss(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Group name",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,l.jsx)("textarea",{value:sl,onChange:e=>sr(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Group description",rows:2})]}),so&&(0,l.jsx)("div",{className:"text-red-600 text-sm",children:so}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>lt(e),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:"Save"}),(0,l.jsx)("button",{onClick:ls,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition",children:"Cancel"})]})]})]}):(0,l.jsx)(l.Fragment,{children:e.description&&(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:e.description})}),t2===e.id&&(0,l.jsxs)("div",{className:"mb-4 p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,l.jsx)("h4",{className:"font-medium mb-3",children:"Invite Parent to Group"}),(0,l.jsxs)("form",{onSubmit:t=>la(t,e),className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Parent Email"}),(0,l.jsx)("input",{type:"email",value:t3,onChange:e=>t4(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"parent@example.com",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Note (Optional)"}),(0,l.jsx)("textarea",{value:t5,onChange:e=>t6(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Add a personal note...",rows:2})]}),t7&&(0,l.jsx)("div",{className:"text-red-600 text-sm",children:t7}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{type:"submit",disabled:t9,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition disabled:opacity-50",children:t9?"Sending...":"Send Invite"}),(0,l.jsx)("button",{type:"button",onClick:lr,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition",children:"Cancel"})]})]})]}),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h4",{className:"font-medium mb-3",children:[t("allChildrenInGroup"),":"]}),0===s.length?(0,l.jsx)("div",{className:"text-gray-500",children:t("noChildrenInGroup")}):(0,l.jsx)("div",{className:"space-y-2",children:s.map(e=>{let s=e.parent_id===(null==c?void 0:c.id);return(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg ".concat(s?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200"),children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"font-medium",children:e.full_name}),e.birthdate&&(0,l.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",Math.floor((new Date().getTime()-new Date(e.birthdate).getTime())/31536e6),")"]}),s&&(0,l.jsx)("span",{className:"ml-2 text-xs bg-blue-600 text-white px-2 py-1 rounded",children:"You"})]}),(0,l.jsxs)("span",{className:"text-xs text-gray-500",children:[t("parent"),": ",e.parent_full_name||t("unknown")]})]},e.id)})})]}),y.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("h4",{className:"font-medium mb-3",children:[t("addRemoveYourChildren"),":"]}),(0,l.jsx)("div",{className:"space-y-2",children:y.map(r=>{let a=s.some(e=>e.id===r.id);return(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg border border-gray-200",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"font-medium",children:r.full_name}),r.birthdate&&(0,l.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",sW(r.birthdate),")"]})]}),(0,l.jsx)("button",{onClick:()=>lo(r,e),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(a?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),children:a?t("remove"):t("add")})]},r.id)})})]}),0===y.length&&(0,l.jsx)("div",{className:"text-gray-500",children:"No children added yet. Add children from the Children tab first."})]}),!1]},e.id)})})]}),C.filter(e=>"pet"===e.group_type).length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-4 text-purple-800 flex items-center gap-2",children:(0,l.jsx)("span",{className:"px-3 py-1 bg-purple-100 rounded",children:t("petGroups")})}),(0,l.jsx)("div",{className:"space-y-6",children:C.filter(e=>"pet"===e.group_type).map(e=>{O[e.id];let s=I[e.id]||[];return sV(e),(0,l.jsxs)("div",{className:"border border-purple-200 rounded p-6 bg-white",children:[(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold mb-2",children:e.name}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>le(e),className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:t("edit")}),(0,l.jsx)("button",{onClick:()=>ll(e),className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition",children:t("invite")})]})]}),t$===e.id?(0,l.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,l.jsx)("h4",{className:"font-medium mb-3",children:"Edit Group"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Group Type"}),(0,l.jsxs)("select",{value:sa,onChange:e=>sn(e.target.value),className:"w-full px-3 py-2 border rounded",children:[(0,l.jsx)("option",{value:"care",children:"Care Group (For child care)"}),(0,l.jsx)("option",{value:"pet",children:"Pet Group (For pet care)"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Group Name"}),(0,l.jsx)("input",{type:"text",value:st,onChange:e=>ss(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Group name",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,l.jsx)("textarea",{value:sl,onChange:e=>sr(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Group description",rows:2})]}),so&&(0,l.jsx)("div",{className:"text-red-600 text-sm",children:so}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>lt(e),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:"Save"}),(0,l.jsx)("button",{onClick:ls,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition",children:"Cancel"})]})]})]}):(0,l.jsx)(l.Fragment,{children:e.description&&(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:e.description})}),t2===e.id&&(0,l.jsxs)("div",{className:"mb-4 p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,l.jsx)("h4",{className:"font-medium mb-3",children:"Invite Parent to Group"}),(0,l.jsxs)("form",{onSubmit:t=>la(t,e),className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Parent Email"}),(0,l.jsx)("input",{type:"email",value:t3,onChange:e=>t4(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"parent@example.com",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Note (Optional)"}),(0,l.jsx)("textarea",{value:t5,onChange:e=>t6(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Add a personal note...",rows:2})]}),t7&&(0,l.jsx)("div",{className:"text-red-600 text-sm",children:t7}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{type:"submit",disabled:t9,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition disabled:opacity-50",children:t9?"Sending...":"Send Invite"}),(0,l.jsx)("button",{type:"button",onClick:lr,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition",children:"Cancel"})]})]})]}),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h4",{className:"font-medium mb-3",children:[t("allPetsInGroup"),":"]}),0===s.length?(0,l.jsx)("div",{className:"text-gray-500",children:t("noPetsInGroup")}):(0,l.jsx)("div",{className:"space-y-2",children:s.map(e=>{let s=e.parent_id===(null==c?void 0:c.id);return(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg ".concat(s?"bg-purple-50 border border-purple-200":"bg-gray-50 border border-gray-200"),children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"font-medium",children:e.name}),e.species&&(0,l.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",e.species,")"]}),s&&(0,l.jsx)("span",{className:"ml-2 text-xs bg-purple-600 text-white px-2 py-1 rounded",children:"You"})]}),(0,l.jsxs)("span",{className:"text-xs text-gray-500",children:[t("parent"),": ",e.parent_full_name||t("unknown")]})]},e.id)})})]}),w.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("h4",{className:"font-medium mb-3",children:[t("addRemoveYourPets"),":"]}),(0,l.jsx)("div",{className:"space-y-2",children:w.map(r=>{let a=s.some(e=>e.id===r.id);return(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg border border-gray-200",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"font-medium",children:r.name}),r.species&&(0,l.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",r.species,")"]})]}),(0,l.jsx)("button",{onClick:()=>ln(r,e),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(a?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),children:a?t("remove"):t("add")})]},r.id)})})]}),0===w.length&&(0,l.jsx)("div",{className:"text-gray-500",children:"No pets added yet. Add pets from the Pets tab first."})]})]},e.id)})})]})]})]})})]})]}),sw&&(0,l.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-full overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:sE}),(0,l.jsx)("button",{onClick:()=>s_(!1),className:"text-gray-400 hover:text-gray-600",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),popupContent]})}),sA&&(0,l.jsx)("div",{className:"fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",children:sA}),sO&&sI&&(0,l.jsx)(p.Z,{isOpen:sO,onClose:()=>{sq(!1),sF(null)},careBlock:{id:sI.id,group_id:sI.group_id,care_date:sI.date,start_time:sI.start_time,end_time:sI.end_time,related_request_id:sI.related_request_id,group_name:sI.group_name,children:sI.children},onRescheduleSuccess:()=>{sL("Reschedule request created successfully! Parents will be notified to accept or decline."),setTimeout(()=>sL(""),5e3),sq(!1),sF(null)}}),sG&&(0,l.jsx)(h,{image:sG,onCropComplete:sX,onCancel:()=>{sR(null),sz(null)},aspectRatio:1,circularCrop:!0})]})}},6129:function(e,t,s){"use strict";async function l(e){let t=e.replace(/\D/g,"");if(5!==t.length)return null;try{let e=await fetch("https://api.zippopotam.us/us/".concat(t));if(!e.ok)return null;let s=await e.json();if(s.places&&s.places.length>0){let e=s.places[0];return{zipCode:t,city:e["place name"],state:e["state abbreviation"],county:e.county||void 0}}return null}catch(e){return console.error("Error looking up ZIP code:",e),null}}s.d(t,{f:function(){return l}})},2644:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var l=s(7437),r=s(2265),a=s(3519);function n(e){let{isOpen:t,onClose:s,careBlock:n,onRescheduleSuccess:o}=e,[i,d]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[x,h]=(0,r.useState)(""),[g,b]=(0,r.useState)(!1),[f,j]=(0,r.useState)(""),v=async e=>{if(e.preventDefault(),!i||!c||!m||!x){j("Please fill in all fields");return}b(!0),j("");try{var t;console.log("\uD83D\uDE80 Starting reschedule request..."),console.log("\uD83D\uDCCB Care Block ID:",n.id),console.log("\uD83D\uDCC5 New Date:",i),console.log("⏰ New Start Time:",c),console.log("⏰ New End Time:",m),console.log("\uD83D\uDCDD Reason:",x);let{data:e,error:l}=await a.O.rpc("initiate_improved_reschedule",{p_scheduled_care_id:n.id,p_new_date:i,p_new_start_time:c,p_new_end_time:m,p_reschedule_reason:x});if(console.log("\uD83D\uDD0D RPC Call Result:"),console.log("  - Error:",l),console.log("  - Data:",e),console.log("  - Data Type:",typeof e),console.log("  - Data Length:",null==e?void 0:e.length),l)throw console.error("❌ RPC Error:",l),l;if(!e||0===e.length)throw console.error("❌ No data returned from RPC call"),Error("No data returned from reschedule function");let r=e[0];if(console.log("\uD83D\uDCCA Function Result:",r),console.log("✅ Success:",r.success),console.log("\uD83D\uDCDD Message:",r.message),console.log("\uD83C\uDD94 New Request ID:",r.new_request_id),console.log("\uD83D\uDC65 Participating Parents:",r.participating_parents),!r.success)throw console.error("❌ Function returned success=false:",r.message),Error(r.message||"Failed to initiate reschedule request");console.log("✅ Reschedule request initiated successfully!"),console.log("\uD83D\uDC65 Participating parents count:",(null===(t=r.participating_parents)||void 0===t?void 0:t.length)||0),r.participating_parents&&Array.isArray(r.participating_parents)&&r.participating_parents.forEach((e,t)=>{console.log("\uD83D\uDC64 Parent ".concat(t+1,":"),e)}),console.log("\uD83D\uDD0D Verifying care_responses were created...");let{data:d,error:u}=await a.O.from("care_responses").select("*").eq("request_id",r.new_request_id).eq("action_type","reschedule_response");if(console.log("\uD83D\uDCCB Care Responses Check:"),console.log("  - Error:",u),console.log("  - Count:",(null==d?void 0:d.length)||0),console.log("  - Responses:",d),u)console.error("❌ Error checking care_responses:",u);else if(d&&0!==d.length)console.log("✅ Care responses found:",d.length),d.forEach((e,t)=>{console.log("\uD83D\uDCDD Care Response ".concat(t+1,":"),{id:e.id,request_id:e.request_id,responder_id:e.responder_id,status:e.status,action_type:e.action_type})});else{console.error("❌ NO CARE_RESPONSES CREATED! Trying to create them from rescheduled blocks..."),console.log("\uD83D\uDD27 Request ID:",r.new_request_id);try{let{data:e,error:t}=await a.O.rpc("create_care_responses_from_rescheduled_blocks",{p_reschedule_request_id:r.new_request_id});console.log("\uD83D\uDD27 Create Care Responses Result:",e),console.log("\uD83D\uDD27 Create Care Responses Error:",t),t?console.error("❌ Failed to create care_responses from rescheduled blocks:",t):e&&e.length>0&&e[0].success&&console.log("✅ Successfully created care_responses from rescheduled blocks:",e[0].care_responses_created)}catch(e){console.error("❌ Error calling create_care_responses_from_rescheduled_blocks:",e)}}o(),s()}catch(e){console.error("Error creating reschedule request:",e),j("Failed to create reschedule request. Please try again.")}finally{b(!1)}};return t?(0,l.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-full overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Reschedule Care Block"}),(0,l.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Current Schedule"}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,l.jsx)("strong",{children:"Group:"})," ",n.group_name,(0,l.jsx)("br",{}),(0,l.jsx)("strong",{children:"Date:"})," ",new Date(n.care_date+"T00:00:00").toLocaleDateString(),(0,l.jsx)("br",{}),(0,l.jsx)("strong",{children:"Time:"})," ",n.start_time," - ",n.end_time,(0,l.jsx)("br",{}),(0,l.jsx)("strong",{children:"Children:"})," ",n.children&&n.children.length>0?n.children.map(e=>e.full_name).join(", "):"No children assigned"]})]}),(0,l.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"newDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Date"}),(0,l.jsx)("input",{type:"date",id:"newDate",value:i,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"newStartTime",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Time"}),(0,l.jsx)("input",{type:"time",id:"newStartTime",value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"newEndTime",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Time"}),(0,l.jsx)("input",{type:"time",id:"newEndTime",value:m,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Reschedule"}),(0,l.jsx)("textarea",{id:"reason",value:x,onChange:e=>h(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Please explain why you need to reschedule...",required:!0})]}),f&&(0,l.jsx)("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:f}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:g?"Creating...":"Create Reschedule Request"})]})]})]})}):null}}},function(e){e.O(0,[256,506,634,799,521,971,117,744],function(){return e(e.s=950)}),_N_E=e.O()}]);