(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{335:function(e,t,r){Promise.resolve().then(r.bind(r,3647))},415:function(e,t,r){"use strict";function a(e){if(!e)return null;try{let t;if("string"==typeof e){if(e.match(/^\d{4}-\d{2}-\d{2}$/)){let[r,a,s]=e.split("-").map(Number);t=new Date(r,a-1,s)}else t=new Date(e)}else t=e;if(isNaN(t.getTime()))return null;return t}catch(t){return console.warn("Failed to parse date:",e,t),null}}function s(e,t){if(!e)return"";let r=a(e);if(!r)return"";let s=t||localStorage.getItem("i18nextLng")||"en";return r.toLocaleDateString("es"===s?"es-ES":"en-US",{month:"short",day:"numeric",year:"numeric"})}function i(e){let t;if(!e)return"";if(e.includes("T")||e.includes(" "))t=new Date(e);else{let[r,a]=e.split(":");(t=new Date).setHours(parseInt(r,10),parseInt(a,10),0,0)}if(isNaN(t.getTime()))return"";let r=localStorage.getItem("i18nextLng")||"en";return t.toLocaleTimeString("es"===r?"es-ES":"en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function n(e){return e.toISOString().split("T")[0]}function d(e){if(!e)return"";if(e.match(/^\d{4}-\d{2}-\d{2}$/))return e;let t=a(e);return t?n(t):e}r.d(t,{DG:function(){return d},L9:function(){return n},mr:function(){return i},o8:function(){return s}})},3647:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var a=r(7437),s=r(2265),i=r(9376),n=r(3521),d=r(3519),c=r(415);function o(e){let{isOpen:t,onClose:r,rescheduleRequestId:i,careResponseId:n,onResponseSuccess:c}=e;console.log("\uD83D\uDD35 RescheduleResponseModal loaded - ENHANCED VERSION with decline workflow");let[o,l]=(0,s.useState)(null),[p,u]=(0,s.useState)(""),[_,m]=(0,s.useState)(!1),[h,g]=(0,s.useState)(""),[x,b]=(0,s.useState)(!0),[f,y]=(0,s.useState)(!0),[v,j]=(0,s.useState)([]),[w,N]=(0,s.useState)(""),[q,k]=(0,s.useState)(!1),[C,E]=(0,s.useState)(""),[O,S]=(0,s.useState)(""),[R,D]=(0,s.useState)(""),[T,A]=(0,s.useState)("");(0,s.useEffect)(()=>{t&&i&&(I(),P())},[t,i]);let I=async()=>{try{b(!0);let{data:e,error:t}=await d.O.from("care_requests").select("id, counter_proposal_to, requester_id, requested_date, start_time, end_time, reciprocal_date, reciprocal_start_time, reciprocal_end_time, notes").eq("id",i).single();if(t)throw t;let r={reschedule_request:{id:e.id,is_counter_proposal:null!==e.counter_proposal_to,counter_proposal_to:e.counter_proposal_to},original_request:{id:e.id,date:e.reciprocal_date,start_time:e.reciprocal_start_time,end_time:e.reciprocal_end_time,notes:e.notes},new_request:{id:e.id,date:e.requested_date,start_time:e.start_time,end_time:e.end_time,notes:e.notes},participating_parents:[],responses:[]};console.log("✅ Reschedule details loaded:",r),console.log("✅ Is counter-proposal:",r.reschedule_request.is_counter_proposal),l(r),r.new_request.start_time&&S(r.new_request.start_time.substring(0,5)),r.new_request.end_time&&D(r.new_request.end_time.substring(0,5))}catch(e){console.error("Error fetching reschedule details:",e),g("Failed to load reschedule details")}finally{b(!1)}},P=async()=>{try{let{data:{user:e}}=await d.O.auth.getUser();if(!e)throw Error("User not authenticated");let{data:t,error:r}=await d.O.from("care_requests").select("requester_id").eq("id",i).single();if(r||!t){console.error("Could not find request:",r);return}console.log("Fetching arrangements between:",e.id,"and",t.requester_id);let{data:a,error:s}=await d.O.rpc("get_arrangements_between_parents",{p_parent1_id:e.id,p_parent2_id:t.requester_id});if(console.log("Arrangements result:",{data:a,error:s}),s)throw s;if(j(a||[]),a&&a.length>0){let e=a.find(e=>e.request_id===i);e?N(e.request_id):a.length>0&&N(a[0].request_id)}}catch(e){console.error("Error fetching arrangements:",e),g("Failed to load arrangements")}},U=async()=>{var e;console.log("=== DECLINE BUTTON CLICKED ==="),(null==o?void 0:null===(e=o.reschedule_request)||void 0===e?void 0:e.is_counter_proposal)?(console.log("Counter-proposal detected - using simple decline"),await F()):(console.log("Original reschedule - showing full decline options"),y(!0),await P())},F=async()=>{if(i&&window.confirm("Are you sure you want to decline this counter-proposal? The parent will be notified and their selected arrangement will be canceled.")){m(!0),g("");try{var e;let{data:{user:t}}=await d.O.auth.getUser();if(!t)throw Error("User not authenticated");let a=n;if(!a){let{data:e,error:r}=await d.O.from("care_responses").select("id").eq("request_id",i).eq("responder_id",t.id).eq("status","pending").single();if(r||!e)throw console.error("Could not find care_response:",r),Error("Could not find your response record");a=e.id}console.log("Calling simple decline for counter-proposal");let{data:s,error:l}=await d.O.rpc("handle_improved_reschedule_response",{p_care_response_id:a,p_responder_id:t.id,p_response_status:"declined",p_response_notes:p||null,p_decline_action:null,p_selected_cancellation_request_id:null});if(console.log("RPC result:",{data:s,error:l}),l)throw l;let u=(null==o?void 0:null===(e=o.reschedule_request)||void 0===e?void 0:e.is_counter_proposal)?"reschedule_counter_sent":"reschedule_request";await d.O.from("notifications").update({is_read:!0}).eq("user_id",t.id).eq("type",u).eq("data->>request_id",i),c(),r()}catch(e){console.error("Error declining counter-proposal:",e),g("Failed to submit response. Please try again.")}finally{m(!1)}}},L=async()=>{if(i){m(!0),g("");try{let{data:{user:e}}=await d.O.auth.getUser();if(!e)throw Error("User not authenticated");let t=n;if(!t){console.log("Looking up care_response_id for request_id:",i,"user:",e.id);let{data:r,error:a}=await d.O.from("care_responses").select("id").eq("request_id",i).eq("responder_id",e.id).eq("status","pending").single();if(console.log("care_responses query result:",{responseData:r,responseError:a}),a||!r)throw console.error("Could not find care_response:",a),Error("Could not find your response record");t=r.id}console.log("Calling handle_improved_reschedule_response with:",{p_care_response_id:t,p_responder_id:e.id,p_response_status:"accepted"});let{data:a,error:s}=await d.O.rpc("handle_improved_reschedule_response",{p_care_response_id:t,p_responder_id:e.id,p_response_status:"accepted",p_response_notes:p||null});if(console.log("RPC result:",{data:a,error:s}),s)throw s;c(),r()}catch(e){console.error("Error accepting reschedule request:",e),g("Failed to submit response. Please try again.")}finally{m(!1)}}},B=async()=>{if(!i||!w){g("Please select an arrangement to cancel");return}if(q&&(!C||!O||!R)){g("Please fill in all replacement time fields");return}m(!0),g("");try{let{data:{user:e}}=await d.O.auth.getUser();if(!e)throw Error("User not authenticated");let t=n;if(!t){let{data:r,error:a}=await d.O.from("care_responses").select("id").eq("request_id",i).eq("responder_id",e.id).eq("status","pending").single();if(a||!r)throw console.error("Could not find care_response:",a),Error("Could not find your response record");t=r.id}let a={p_care_response_id:t,p_responder_id:e.id,p_response_status:"declined",p_response_notes:p||null,p_decline_action:q?"counter_propose":"cancel",p_selected_cancellation_request_id:w};q&&(a.p_counter_proposal_date=C,a.p_counter_proposal_start_time=O,a.p_counter_proposal_end_time=R,a.p_counter_proposal_notes=T||null),console.log("Calling handle_improved_reschedule_response with:",a);let{data:s,error:o}=await d.O.rpc("handle_improved_reschedule_response",a);if(console.log("RPC result:",{data:s,error:o}),o)throw o;let{data:{user:l}}=await d.O.auth.getUser();l&&await d.O.from("notifications").update({is_read:!0}).eq("user_id",l.id).eq("type","reschedule_request").eq("data->>request_id",i),c(),r()}catch(e){console.error("Error declining reschedule request:",e),g("Failed to submit response. Please try again.")}finally{m(!1)}},M=e=>e.substring(0,5),G=e=>new Date(e+"T00:00:00").toLocaleDateString();if(!t)return null;if(x)return(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsx)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-full overflow-y-auto",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{children:"Loading reschedule details..."})]})})});if(!o)return(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsx)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-full overflow-y-auto",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-red-600",children:"Failed to load reschedule details"}),(0,a.jsx)("button",{onClick:r,className:"mt-4 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Close"})]})})});let{original_request:W,new_request:z,participating_parents:Y,responses:H}=o,J=H||[];return f?(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-full overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-900",children:"Respond to Reschedule Request"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-red-800 mb-2",children:"Current Schedule"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Date:"})," ",G(W.date)]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Time:"})," ",M(W.start_time)," - ",M(W.end_time)]})]}),(0,a.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-green-800 mb-2",children:"Proposed New Schedule"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Date:"})," ",G(z.date)]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Time:"})," ",M(z.start_time)," - ",M(z.end_time)]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Which arrangement should be canceled?"}),(()=>{let e=new Date;e.setHours(0,0,0,0);let t=v.filter(t=>new Date(t.date+"T00:00:00")>=e);return 0===t.length?(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"No future arrangements found between you and the requesting parent."}):(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("label",{className:"flex items-start p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",children:[(0,a.jsx)("input",{type:"radio",name:"cancellation",value:e.request_id,checked:w===e.request_id,onChange:e=>N(e.target.value),className:"mt-1 mr-3"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-medium",children:[G(e.date)," at ",M(e.start_time)," - ",M(e.end_time),e.request_id===i&&(0,a.jsx)("span",{className:"ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"(Current Request)"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e.requesting_parent_name," requesting care from ",e.receiving_parent_name]}),e.notes&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.notes})]})]},e.request_id))})})()]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{className:"flex items-center mb-3",children:[(0,a.jsx)("input",{type:"checkbox",checked:q,onChange:e=>k(e.target.checked),className:"mr-2"}),(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:"Offer an alternative time (optional)"})]}),q&&(0,a.jsxs)("div",{className:"pl-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,a.jsx)("input",{type:"date",value:C,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Time"}),(0,a.jsx)("input",{type:"time",value:O,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Time"}),(0,a.jsx)("input",{type:"time",value:R,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),h&&(0,a.jsx)("div",{className:"mb-4 text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:h}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:B,disabled:_||!w,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:_?"Processing...":"Submit Decline"})]})]})}):(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-full overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-900",children:"Reschedule Request"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-red-800 mb-2",children:"Current Schedule"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Date:"})," ",G(W.date)]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Time:"})," ",M(W.start_time)," - ",M(W.end_time)]}),W.notes&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Notes:"})," ",W.notes]})]}),(0,a.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-green-800 mb-2",children:"Proposed New Schedule"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Date:"})," ",G(z.date)]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Time:"})," ",M(z.start_time)," - ",M(z.end_time)]}),z.notes&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Notes:"})," ",z.notes]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"All Participating Parents"}),(0,a.jsx)("div",{className:"space-y-2",children:(Y||[]).map(e=>{var t;return(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.parent_name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"provided"===e.care_type?"Providing Care":"Receiving Care"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsx)("strong",{children:"Children:"})," ",(e.children||[]).map(e=>e.child_name).join(", ")]})]}),(0,a.jsx)("div",{className:"text-sm",children:J.find(t=>t.responder_id===e.parent_id)?(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:(null===(t=J.find(t=>t.responder_id===e.parent_id))||void 0===t?void 0:t.status)==="accepted"?"Accepted":"Declined"}):(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:"Pending"})})]})},e.parent_id)})})]}),h&&(0,a.jsx)("div",{className:"mb-4 text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:h}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:U,disabled:_,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Decline"}),(0,a.jsx)("button",{type:"button",onClick:L,disabled:_,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:_?"Processing...":"Accept"})]})]})})}var l=r(7573),p=r(7506);function u(e){if(!e)return"";try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch(t){return e}}function _(e){if(!e)return"";try{let[t,r]=e.split(":"),a=parseInt(t);return"".concat(a%12||12,":").concat(r," ").concat(a>=12?"PM":"AM")}catch(t){return e}}function m(){let{t:e,i18n:t}=(0,p.$G)(),r=(0,i.useRouter)(),m=e=>(0,c.o8)(e,t.language),[h,g]=(0,s.useState)(null),[x,b]=(0,s.useState)([]),[f,y]=(0,s.useState)([]),[v,j]=(0,s.useState)([]),[w,N]=(0,s.useState)([]),[q,k]=(0,s.useState)([]),[C,E]=(0,s.useState)([]),[O,S]=(0,s.useState)([]),[R,D]=(0,s.useState)([]),[T,A]=(0,s.useState)(!0),[I,P]=(0,s.useState)(null),[U,F]=(0,s.useState)([]),[L,B]=(0,s.useState)(!1),[M,G]=(0,s.useState)(null),[W,z]=(0,s.useState)([]),[Y,H]=(0,s.useState)([]),[J,V]=(0,s.useState)([]),[Z,$]=(0,s.useState)(!1),[K,Q]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(null),[et,er]=(0,s.useState)([]),[ea,es]=(0,s.useState)([]),[ei,en]=(0,s.useState)([]),[ed,ec]=(0,s.useState)(new Map),eo=0,[el,ep]=(0,s.useState)(!1),[eu,e_]=(0,s.useState)({care_type:"reciprocal",group_id:"",child_id:"",care_date:"",start_time:"",end_time:"",end_date:"",hosting_child_ids:[],invited_child_ids:[],notes:""}),[em,eh]=(0,s.useState)(!1),[eg,ex]=(0,s.useState)(null),[eb,ef]=(0,s.useState)({reciprocal_date:"",reciprocal_end_date:"",reciprocal_start_time:"",reciprocal_end_time:"",reciprocal_child_id:"",reciprocal_pet_id:"",notes:""}),[ey,ev]=(0,s.useState)("");(0,s.useEffect)(()=>{if(!eg||"pet"!==eg.care_type||!eb.reciprocal_date){ev("");return}let e=new Date(eg.requested_date),t=new Date(eg.requested_end_date||eg.end_date||eg.requested_date),r=new Date(eb.reciprocal_date),a=new Date(eb.reciprocal_end_date||eb.reciprocal_date);r<=t&&a>=e?ev("⚠️ Warning: Reciprocal dates overlap with the original request. You cannot watch their pet while they are watching yours. Please choose different dates."):ev("")},[eb.reciprocal_date,eb.reciprocal_end_date,eg]);let ej=(e,t)=>{if(!e)return t;let r=e.match(/\[Next-day care: Actual end time is ([0-9]{2}:[0-9]{2})\]/);return r?r[1]:t},ew=async()=>{let e=new Map,t=f.filter(e=>!e.notes).map(e=>e.care_request_id);if(0!==t.length)try{let{data:r,error:a}=await d.O.from("care_requests").select("id, notes, end_time").in("id",t);if(a){console.error("Error fetching care request notes:",a);return}null==r||r.forEach(t=>{let r=ej(t.notes||"",t.end_time);e.set(t.id,r)}),ec(e)}catch(e){console.error("Error fetching care request notes:",e)}};(0,s.useEffect)(()=>{(async()=>{let{data:{user:e}}=await d.O.auth.getUser();g(e)})()},[]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{eN(),eG(),eW(),eH(),eJ()},100);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(!h)return;let e=d.O.channel("scheduler_notifications_updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:"user_id=eq.".concat(h.id)},e=>{eN()}).subscribe();return()=>{d.O.removeChannel(e)}},[h]),(0,s.useEffect)(()=>{f.length>0&&ew()},[f]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&em&&(eh(!1),ex(null))};if(em)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[em]),(0,s.useEffect)(()=>{eu.group_id?ek(eu.group_id):k([])},[eu.group_id]);let eN=async()=>{try{A(!0);let{data:{user:e}}=await d.O.auth.getUser();if(!e){P("User not authenticated");return}let{data:t,error:r}=await d.O.from("group_members").select("\n          group_id,\n          groups!inner(id, name)\n        ").eq("profile_id",e.id).eq("status","active");if(r)return;let a=t.map(e=>({id:e.groups.id,name:e.groups.name}));N(a);let{data:s,error:i}=await d.O.rpc("get_reciprocal_care_requests",{parent_id:e.id}),n=[],c=null;try{let{data:t,error:r}=await d.O.rpc("get_reciprocal_pet_care_requests",{p_parent_id:e.id});r?c=r:n=t||[]}catch(e){}let o=[...(Array.isArray(s)?s:[]).map(e=>({...e,care_type:"child"})),...(Array.isArray(n)?n:[]).map(e=>({...e,care_type:"pet"}))].sort((e,t)=>{try{return new Date(t.created_at).getTime()-new Date(e.created_at).getTime()}catch(e){return 0}});i&&console.error("Error fetching child care requests:",i),c&&console.error("Error fetching pet care requests:",c),b(o);let{data:l,error:p}=await d.O.rpc("get_reciprocal_care_responses",{parent_id:e.id}),u=[],_=null;try{let{data:t,error:r}=await d.O.rpc("get_reciprocal_pet_care_responses",{p_parent_id:e.id});r?_=r:u=t||[]}catch(e){}let m=[...(Array.isArray(l)?l:[]).map(e=>({...e,care_type:"child"})),...(Array.isArray(u)?u:[]).map(e=>({...e,care_type:"pet"}))].sort((e,t)=>{try{return new Date(t.created_at).getTime()-new Date(e.created_at).getTime()}catch(e){return 0}});p&&console.error("Error fetching child care responses:",p),_&&console.error("Error fetching pet care responses:",_);let{data:h,error:g}=await d.O.rpc("get_responses_for_requester",{p_requester_id:e.id});g&&console.error("Error fetching responses to my requests:",g);let{data:x,error:f}=await d.O.from("pet_care_responses").select("\n          id,\n          request_id,\n          responder_id,\n          status,\n          response_type,\n          response_notes,\n          reciprocal_date,\n          reciprocal_start_time,\n          reciprocal_end_time,\n          reciprocal_pet_id,\n          created_at,\n          pet_care_requests!inner(\n            id,\n            group_id,\n            requester_id,\n            requested_date,\n            start_time,\n            end_time,\n            notes,\n            pet_id,\n            end_date\n          )\n        ").eq("pet_care_requests.requester_id",e.id);f&&console.error("Error fetching pet responses to my requests:",f);let v=(x||[]).map(e=>e.responder_id).filter(Boolean),w={};if(v.length>0){let{data:e}=await d.O.from("profiles").select("id, full_name").in("id",v);(e||[]).forEach(e=>{w[e.id]=e.full_name})}let q=[...new Set(o.filter(e=>"pet"===e.care_type).map(e=>e.group_id))],k={};if(q.length>0){let{data:e}=await d.O.from("groups").select("id, name").in("id",q);(e||[]).forEach(e=>{k[e.id]=e.name})}let C=(x||[]).map(t=>({care_response_id:t.id,care_request_id:t.request_id,group_id:t.pet_care_requests.group_id,group_name:k[t.pet_care_requests.group_id]||"",requester_id:t.pet_care_requests.requester_id,requester_name:(null==e?void 0:e.email)||"",requested_date:t.pet_care_requests.requested_date,start_time:t.pet_care_requests.start_time,end_time:t.pet_care_requests.end_time,notes:t.pet_care_requests.notes,status:t.status,created_at:t.created_at,reciprocal_date:t.reciprocal_date,reciprocal_start_time:t.reciprocal_start_time,reciprocal_end_time:t.reciprocal_end_time,response_notes:t.response_notes,responder_id:t.responder_id,responder_name:w[t.responder_id]||"",care_type:"pet",pet_name:"",end_date:t.pet_care_requests.end_date})),{data:E,error:O}=await d.O.rpc("get_my_submitted_responses",{parent_id:e.id});O?j([]):j(E||[]);let{data:S,error:R}=await d.O.rpc("get_reschedule_requests",{p_parent_id:e.id});R?(console.error("Error fetching reschedule requests:",R),H([])):H(S||[]);let{data:D,error:T}=await d.O.from("notifications").select("*").eq("user_id",e.id).in("type",["reschedule_accepted","reschedule_declined","reschedule_counter_sent","reschedule_counter_accepted","reschedule_counter_declined","care_declined","hangout_accepted"]).order("created_at",{ascending:!1});T?(console.error("Error fetching reschedule notifications:",T),V([])):V(D||[]);let I=[...Array.isArray(m)?m:[],...Array.isArray(h)?h:[],...Array.isArray(C)?C:[]].filter((e,t,r)=>!!e.care_response_id&&!!e.care_request_id&&!!e.group_name&&!!e.requester_name&&t===r.findIndex(t=>t.care_response_id===e.care_response_id));y(I)}catch(e){P("An unexpected error occurred")}finally{A(!1)}},eq=async(e,t)=>{try{let{data:{user:a}}=await d.O.auth.getUser();if(!a)return;let{data:s}=await d.O.from("scheduled_care").select("id").eq("care_date",e).eq("parent_id",a.id).eq("care_type",t).limit(1);s&&s.length>0?r.push("/calendar?date=".concat(e,"&selectBlock=").concat(s[0].id)):r.push("/calendar?date=".concat(e))}catch(t){console.error("Error finding block:",t),r.push("/calendar?date=".concat(e))}},ek=async e=>{try{let{data:{user:t}}=await d.O.auth.getUser();if(!t)return;let{data:r,error:a}=await d.O.from("child_group_members").select("\n          child_id,\n          children!inner(id, full_name, parent_id)\n        ").eq("group_id",e).eq("active",!0).eq("children.parent_id",t.id);if(a){console.error("Error fetching children for group:",a);return}if(!r||0===r.length){k([]);return}let s=r.map(t=>({id:t.children.id,name:t.children.full_name,group_id:e}));k(s)}catch(e){console.error("Error in fetchChildrenForGroup:",e)}},eC=async e=>{try{let{data:{user:t}}=await d.O.auth.getUser();if(!t)return;let{data:r,error:a}=await d.O.from("pet_group_members").select("\n          pet_id,\n          pets!inner(id, name, species, parent_id)\n        ").eq("group_id",e).eq("active",!0).eq("pets.parent_id",t.id);if(a){console.error("Error fetching pets for group:",a);return}if(!r||0===r.length){S([]);return}let s=r.map(t=>({id:t.pets.id,name:t.pets.name,species:t.pets.species,group_id:e}));S(s)}catch(e){console.error("Error in fetchPetsForGroup:",e)}},eE=async e=>{try{let{data:t,error:r}=await d.O.from("child_group_members").select("\n          child_id,\n          children!inner(id, full_name, parent_id)\n        ").eq("group_id",e).eq("active",!0);if(r){console.error("Error fetching all group children:",r);return}if(!t||0===t.length){E([]);return}let a=t.map(t=>({id:t.children.id,name:t.children.full_name,group_id:e,parent_id:t.children.parent_id}));E(a)}catch(e){console.error("Error in fetchAllGroupChildren:",e)}},eO=async(e,t,r,a)=>{try{if("declined"===t){if(!a){let{data:t,error:r}=await d.O.from("care_responses").select("request_id").eq("id",e).single();if(r||!t){console.error("Could not find care request:",r),eP("Failed to load reschedule details");return}a=t.request_id}let{data:t,error:s}=await d.O.from("care_requests").select("counter_proposal_to").eq("id",a).single();if(s){console.error("Error checking if counter-proposal:",s),eP("Failed to load reschedule details");return}if(null!==t.counter_proposal_to){if(!window.confirm("Are you sure you want to decline this counter-proposal? The parent will be notified and their selected arrangement will be canceled."))return;$(!0);let{data:{user:s}}=await d.O.auth.getUser();if(!s){eP("User not authenticated");return}let{data:i,error:n}=await d.O.from("care_responses").select("selected_cancellation_request_id, decline_action").eq("request_id",t.counter_proposal_to).eq("decline_action","counter_propose").single();n&&console.error("Error finding counter-proposer response:",n);let c=(null==i?void 0:i.selected_cancellation_request_id)||null,{data:o,error:l}=await d.O.rpc("handle_improved_reschedule_response",{p_care_response_id:e,p_responder_id:s.id,p_response_status:"declined",p_response_notes:r||null,p_decline_action:null,p_selected_cancellation_request_id:c});if(l)throw l;a&&await d.O.from("notifications").update({is_read:!0}).eq("user_id",s.id).eq("type","reschedule_counter_sent").eq("data->>counter_request_id",a),eP("You have declined the counter-proposal. The parent has been notified."),await eN(),$(!1);return}ee({requestId:a,responseId:e}),Q(!0);return}$(!0);let{data:{user:s}}=await d.O.auth.getUser();if(!s){eP("User not authenticated");return}let i=a;if(!i){let{data:t,error:r}=await d.O.from("care_responses").select("request_id").eq("id",e).single();t&&(i=t.request_id)}let{data:n,error:c}=await d.O.rpc("handle_improved_reschedule_response",{p_care_response_id:e,p_responder_id:s.id,p_response_status:t,p_response_notes:r||null});if(c){console.error("Error handling reschedule response:",c),eP("Failed to process response. Please try again.");return}n.success?(i&&await d.O.from("notifications").update({is_read:!0}).eq("user_id",s.id).eq("type","reschedule_request").eq("data->>request_id",i),window.dispatchEvent(new Event("schedulerCountUpdated")),eP("Successfully ".concat(t," the reschedule request.")),await eN()):eP("Failed to process response: "+n.error)}catch(e){console.error("Error handling reschedule response:",e),eP("An error occurred. Please try again.")}finally{$(!1)}},eS=async e=>{e.preventDefault();try{var t,r,a,s;let e,i;let{data:{user:n}}=await d.O.auth.getUser();if(!n)return;let c=new Date("".concat(eu.care_date,"T").concat(eu.start_time,":00")),o=new Date;if(c<=o){alert("Cannot schedule care in the past. Please select a future date and time.");return}if(eu.end_date){let e=new Date("".concat(eu.end_date,"T").concat(eu.end_time,":00"));if(e<=o){alert("End date and time cannot be in the past. Please select a future date and time.");return}if(e<=c){alert("End date and time must be after start date and time.");return}}if("reciprocal"===eu.care_type){if(!eu.child_id){P("Please select a child");return}let t=await d.O.rpc("create_reciprocal_care_request",{requester_id:n.id,group_id:eu.group_id,requested_date:eu.care_date,start_time:eu.start_time,end_time:eu.end_time,child_id:eu.child_id,notes:eu.notes||null});e=t.data,i=t.error}else if("hangout"===eu.care_type){if(0===eu.hosting_child_ids.length){P("Please select at least one hosting child");return}if(0===eu.invited_child_ids.length){P("Please select at least one child to invite");return}let a=await d.O.rpc("create_hangout_invitation",{p_requesting_parent_id:n.id,p_group_id:eu.group_id,p_care_date:eu.care_date,p_start_time:eu.start_time,p_end_time:eu.end_time,p_hosting_child_ids:eu.hosting_child_ids,p_invited_child_ids:eu.invited_child_ids,p_notes:eu.notes||null});e=null===(r=a.data)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.request_id,i=a.error}else if("sleepover"===eu.care_type){if(!eu.end_date){P("End date is required for sleepovers");return}if(0===eu.hosting_child_ids.length){P("Please select at least one hosting child");return}if(0===eu.invited_child_ids.length){P("Please select at least one child to invite");return}let t=await d.O.rpc("create_sleepover_invitation",{p_requesting_parent_id:n.id,p_group_id:eu.group_id,p_care_date:eu.care_date,p_start_time:eu.start_time,p_end_date:eu.end_date,p_end_time:eu.end_time,p_hosting_child_ids:eu.hosting_child_ids,p_invited_child_ids:eu.invited_child_ids,p_notes:eu.notes||null});e=null===(s=t.data)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:a.request_id,i=t.error}if(i){P("Failed to create ".concat(eu.care_type)),console.error("Error creating care request:",i);return}e&&await d.O.rpc("send_care_request_notifications",{p_care_request_id:e}),eU(),eN()}catch(e){console.error("Error in handleCreateRequest:",e),P("An unexpected error occurred")}},eR=async e=>{ex(e),eh(!0),"pet"===e.care_type?await eC(e.group_id):await ek(e.group_id)},eD=async e=>{if(e.preventDefault(),eg)try{let e,t;let{data:{user:r}}=await d.O.auth.getUser();if(!r)return;if(ey){P("Please fix the date overlap before submitting. Choose reciprocal dates that do not conflict with the original request.");return}if("pet"===eg.care_type){let a=await d.O.rpc("submit_pet_care_response",{p_care_request_id:eg.care_request_id,p_responding_parent_id:r.id,p_reciprocal_date:eb.reciprocal_date,p_reciprocal_end_date:eb.reciprocal_end_date||null,p_reciprocal_start_time:eb.reciprocal_start_time,p_reciprocal_end_time:eb.reciprocal_end_time,p_reciprocal_pet_id:eb.reciprocal_pet_id,p_notes:eb.notes||null});e=a.data,t=a.error}else{let a=await d.O.rpc("submit_reciprocal_care_response",{p_care_request_id:eg.care_request_id,p_responding_parent_id:r.id,p_reciprocal_date:eb.reciprocal_date,p_reciprocal_start_time:eb.reciprocal_start_time,p_reciprocal_end_time:eb.reciprocal_end_time,p_reciprocal_child_id:eb.reciprocal_child_id,p_notes:eb.notes||null});e=a.data,t=a.error}if(t){t.message&&t.message.includes("overlap")?P("Date overlap detected: Please choose reciprocal dates that do not conflict with the original request dates."):P("Failed to submit response. Please check your inputs and try again."),console.error("Error submitting response:",t);return}if(e&&"pet"!==eg.care_type)try{let e="".concat(eg.requester_name," has received a response for their ").concat(eg.care_type||"care"," request on ").concat(eb.reciprocal_date);await d.O.rpc("send_care_response_notifications",{p_care_request_id:eg.care_request_id,p_responder_id:r.id,p_message_content:e})}catch(e){}ef({reciprocal_date:"",reciprocal_end_date:"",reciprocal_start_time:"",reciprocal_end_time:"",reciprocal_child_id:"",reciprocal_pet_id:"",notes:""}),eh(!1),ex(null),eN(),window.dispatchEvent(new CustomEvent("careRequestResponded"))}catch(e){P("An unexpected error occurred")}},eT=async e=>{try{let t;let r=f.find(t=>t.care_response_id===e);null==r||r.care_request_id;let a=null==r?void 0:r.care_type;if(l.b.logReciprocalAcceptance(e,a||"child",(null==r?void 0:r.requester_id)||"unknown",(null==r?void 0:r.responder_id)||(null==h?void 0:h.id)||"unknown"),t="pet"===a?(await d.O.rpc("accept_pet_care_response",{p_care_response_id:e})).error:(await d.O.rpc("accept_reciprocal_care_response",{p_care_response_id:e})).error){console.error("❌ ERROR accepting response:",t),console.error("Error details:",JSON.stringify(t,null,2)),P("Failed to accept response: "+t.message);return}"pet"!==a&&await eA(e);let s=parseInt(localStorage.getItem("newCalendarBlocksCount")||"0",10);localStorage.setItem("newCalendarBlocksCount",(s+2).toString());let i="pet"===a?"Pet care":"Reciprocal care";eP("".concat(i," response accepted successfully! Calendar blocks have been created.")),eN(),l.b.logEventDispatch("refreshCounters","Scheduler.handleAcceptResponse",{responseId:e,careType:a}),window.dispatchEvent(new CustomEvent("refreshCounters"))}catch(e){P("An unexpected error occurred")}},eA=async e=>{try{let{data:t,error:r}=await d.O.from("care_responses").select("\n          *,\n          care_requests!inner(\n            id,\n            group_id,\n            requester_id,\n            requested_date,\n            start_time,\n            end_time,\n            notes,\n            groups(name)\n          )\n        ").eq("id",e).single();if(r){console.error("Error fetching care response:",r);return}let a=t.care_requests,{data:s,error:i}=await d.O.rpc("send_reciprocal_acceptance_notifications_safe",{p_care_request_id:a.id,p_accepting_parent_id:t.responder_id,p_group_id:a.group_id});if(i){console.error("Error sending notification:",i);return}}catch(e){console.error("Error sending reciprocal acceptance notifications:",e)}},eI=e=>{if(!e)return"";try{return e.substring(0,5)}catch(e){return""}},eP=e=>{let t=Date.now();t-eo>2e3&&(alert(e),eo=t)},eU=()=>{e_({care_type:"reciprocal",group_id:"",child_id:"",care_date:"",start_time:"",end_time:"",end_date:"",hosting_child_ids:[],invited_child_ids:[],notes:""}),k([]),E([]),ep(!1)},eF=async e=>{try{let{data:{user:t}}=await d.O.auth.getUser();if(!t)throw Error("User not authenticated");let{data:r,error:a}=await d.O.from("child_group_members").select("\n          child_id,\n          group_id,\n          children!inner(id, full_name, parent_id)\n        ").eq("parent_id",t.id).eq("group_id",e.group_id).eq("active",!0);if(a)throw a;let s=[];if(r&&r.forEach(e=>{e.children&&e.children.id&&s.push({id:e.children.id,full_name:e.children.full_name})}),s.length>0){let t=s[0];await eL(e,t.id);return}z(s),G(e)}catch(e){eP("Error preparing acceptance. Please try again.")}},eL=async(e,t)=>{let r=e||M;if(r)try{B(!0);let{data:{user:e}}=await d.O.auth.getUser();if(!e)throw Error("User not authenticated");l.b.logOpenBlockAcceptance(r.invitation_id||r.care_response_id,e.id,r.open_block_parent_id||r.requester_id);let a={p_care_response_id:r.care_response_id,p_accepting_parent_id:e.id,p_accepted_child_id:t||(W&&W.length>0?W[0].id:null)},{error:s}=await d.O.rpc("accept_open_block_invitation",a);if(!t&&(!W||0===W.length))throw Error("No child selected and no children available");if(s)throw s;let i=parseInt(localStorage.getItem("newCalendarBlocksCount")||"0",10);localStorage.setItem("newCalendarBlocksCount",(i+2).toString()),window.dispatchEvent(new CustomEvent("invitationAccepted")),l.b.logEventDispatch("calendarCountUpdated","Scheduler.handleAcceptanceSubmit",{invitationId:r.invitation_id,acceptorId:e.id,offererId:r.open_block_parent_id}),window.dispatchEvent(new Event("calendarCountUpdated")),await eG(),G(null),await eM(r,e.id),alert("Open block accepted successfully! Care blocks have been added to your calendar.")}catch(e){console.error("Error accepting open block:",e),eP("Error accepting invitation. Please try again.")}finally{B(!1)}},eB=async e=>{if(confirm("Are you sure you want to decline this invitation?"))try{B(!0);let{data:{user:t}}=await d.O.auth.getUser();if(!t)throw Error("User not authenticated");let{error:r}=await d.O.rpc("decline_open_block_invitation",{p_care_response_id:e.care_response_id,p_declining_parent_id:t.id});if(r)throw r;await eG(),window.dispatchEvent(new CustomEvent("invitationDeclined")),eP("Invitation declined successfully.")}catch(e){eP("Error declining invitation. Please try again.")}finally{B(!1)}},eM=async(e,t)=>{try{let{data:{user:r}}=await d.O.auth.getUser();if(!r)return;let{data:a}=await d.O.from("profiles").select("full_name").eq("id",t).single();null==a||a.full_name,e.open_block_parent_name,"Care block: ".concat(m(e.existing_block_date)," from ").concat(eI(e.existing_block_start_time)," to ").concat(eI(ej(e.notes||"",e.existing_block_end_time))),new Date().toISOString()}catch(e){}},eG=async()=>{try{let{data:{user:e}}=await d.O.auth.getUser();if(!e)return;let{data:t,error:r}=await d.O.rpc("get_open_block_invitations",{p_parent_id:e.id});if(r){console.error("Error fetching pending invitations:",r);return}let{data:a,error:s}=await d.O.from("care_responses").select("id, request_id, responder_id, status, created_at, block_time_id").eq("responder_id",e.id).eq("status","accepted"),i=(await Promise.all((a||[]).map(async e=>{let{data:t}=await d.O.from("care_requests").select("requested_date, start_time, end_time, request_type, requester_id, group_id, reciprocal_date, reciprocal_start_time, reciprocal_end_time").eq("id",e.request_id).single();if(!t||"open_block"!==t.request_type)return null;let{data:r}=await d.O.from("profiles").select("full_name").eq("id",t.requester_id).single(),{data:a}=await d.O.from("groups").select("name").eq("id",t.group_id).single();return{...e,existing_block_date:t.requested_date,existing_block_start_time:t.start_time,existing_block_end_time:t.end_time,open_block_parent_name:null==r?void 0:r.full_name,provider_name:null==r?void 0:r.full_name,group_name:null==a?void 0:a.name,reciprocal_date:t.reciprocal_date,reciprocal_start_time:t.reciprocal_start_time,reciprocal_end_time:t.reciprocal_end_time}}))).filter(e=>null!==e),{data:n,error:c}=await d.O.from("care_responses").select("id, request_id, responder_id, status, created_at, block_time_id").eq("status","accepted"),o=(await Promise.all((n||[]).map(async t=>{let{data:r}=await d.O.from("care_requests").select("requested_date, start_time, end_time, request_type, requester_id, group_id, reciprocal_date, reciprocal_start_time, reciprocal_end_time").eq("id",t.request_id).single();if(!r||r.requester_id!==e.id||"open_block"!==r.request_type)return null;let{data:a}=await d.O.from("groups").select("name").eq("id",r.group_id).single();return{...t,existing_block_date:r.requested_date,existing_block_start_time:r.start_time,existing_block_end_time:r.end_time,group_name:null==a?void 0:a.name,reciprocal_date:r.reciprocal_date,reciprocal_start_time:r.reciprocal_start_time,reciprocal_end_time:r.reciprocal_end_time}}))).filter(e=>null!==e),l=await Promise.all(o.map(async e=>{let{data:t}=await d.O.from("profiles").select("full_name").eq("id",e.responder_id).single();return{...e,acceptor_name:null==t?void 0:t.full_name}})),p=[...t||[],...i.map(e=>({...e,is_acceptor_view:!0})),...l.map(e=>({...e,is_provider_view:!0}))];F(p)}catch(e){console.error("Error fetching invitations:",e)}},eW=async()=>{try{let{data:{user:e}}=await d.O.auth.getUser();if(!e)return;let{data:t,error:r}=await d.O.rpc("get_pending_group_invitations",{p_user_id:e.id});if(r){console.error("Error fetching group invitations:",r);return}er(t||[])}catch(e){console.error("Error fetching group invitations:",e)}},ez=async e=>{try{let{data:{user:t}}=await d.O.auth.getUser();if(!t)return;let{data:r,error:a}=await d.O.rpc("accept_group_invitation",{p_user_id:t.id,p_group_id:e});if(a){console.error("Error accepting group invitation:",a),eP("Failed to accept invitation: "+a.message);return}eP("Group invitation accepted successfully!"),await eW(),await eN(),window.dispatchEvent(new CustomEvent("groupInvitationUpdated",{detail:{action:"accepted",groupId:e}}))}catch(e){console.error("Error accepting group invitation:",e),eP("Failed to accept invitation")}},eY=async e=>{try{let{data:{user:t}}=await d.O.auth.getUser();if(!t)return;let{data:r,error:a}=await d.O.rpc("decline_group_invitation",{p_user_id:t.id,p_group_id:e});if(a){console.error("Error declining group invitation:",a),eP("Failed to decline invitation: "+a.message);return}eP("Group invitation declined"),await eW(),window.dispatchEvent(new CustomEvent("groupInvitationUpdated",{detail:{action:"declined",groupId:e}}))}catch(e){console.error("Error declining group invitation:",e),eP("Failed to decline invitation")}},eH=async()=>{try{let{data:{user:e}}=await d.O.auth.getUser();if(!e)return;let{data:t,error:r}=await d.O.rpc("get_pending_event_invitations",{p_user_id:e.id});if(r){console.error("Error fetching event invitations:",r);return}es(t||[])}catch(e){console.error("Error fetching event invitations:",e)}},eJ=async()=>{try{let{data:{user:e}}=await d.O.auth.getUser();if(!e)return;let{data:t,error:r}=await d.O.rpc("get_hangout_sleepover_invitations",{p_parent_id:e.id});if(r){console.error("Error fetching hangout/sleepover invitations:",r);return}en(t||[])}catch(e){console.error("Error fetching hangout/sleepover invitations:",e)}},eV=async(e,t)=>{try{let{data:{user:r}}=await d.O.auth.getUser();if(!r)return;let{data:a,error:s}=await d.O.rpc("accept_hangout_sleepover_invitation",{p_care_response_id:e.care_response_id,p_accepting_parent_id:r.id,p_invited_child_id:t});if(s){console.error("Error accepting invitation:",s),eP("Failed to accept invitation: "+s.message);return}eP("".concat("hangout"===e.request_type?"Hangout":"Sleepover"," invitation accepted successfully!")),await eJ(),window.dispatchEvent(new CustomEvent("refreshCounters"))}catch(e){console.error("Error accepting invitation:",e),eP("Failed to accept invitation")}},eZ=async(e,t)=>{try{let{data:{user:r}}=await d.O.auth.getUser();if(!r)return;let{data:a,error:s}=await d.O.rpc("decline_hangout_sleepover_invitation",{p_care_response_id:e.care_response_id,p_declining_parent_id:r.id,p_decline_reason:t||null});if(s){console.error("Error declining invitation:",s),eP("Failed to decline invitation: "+s.message);return}eP("Invitation declined"),await eJ()}catch(e){console.error("Error declining invitation:",e),eP("Failed to decline invitation")}},e$=async(e,t)=>{try{let{data:{user:r}}=await d.O.auth.getUser();if(!r)return;let{data:a,error:s}=await d.O.rpc("update_event_response",{p_event_request_id:e,p_responder_id:r.id,p_response_type:t,p_response_notes:null});if(s){console.error("Error updating event response:",s),eP("Failed to submit RSVP: "+s.message);return}eP("RSVP submitted: ".concat(t)),await eH()}catch(e){console.error("Error submitting event RSVP:",e),eP("Failed to submit RSVP")}};return((0,s.useEffect)(()=>{if(!h)return;let e=0,t=localStorage.getItem("readSchedulerMessages"),r=t?new Set(JSON.parse(t)):new Set,a=f.filter(e=>"pending"===e.status&&!r.has("pending-".concat(e.care_response_id)));e+=a.length;let s=x.filter(e=>f.some(t=>t.care_request_id===e.care_request_id&&("submitted"===t.status||"pending"===t.status)&&!r.has("responses-".concat(e.care_request_id))));e+=s.length,U.filter(e=>"pending"===e.status).forEach(t=>{let a="".concat(t.open_block_parent_id||t.open_block_parent_name,"-").concat(t.care_response_id);!r.has("invitation-group-".concat(a))&&e++}),U.filter(e=>"accepted"===e.status).forEach((t,a)=>{let s="open-block-accepted-".concat(t.invitation_id||a);!r.has(s)&&e++}),Y.forEach(t=>{let a=t.reschedule_group_id||t.request_id;!r.has("reschedule-".concat(a))&&e++}),J.filter(e=>"reschedule_counter_sent"===e.type&&!J.some(t=>{var r,a;return("reschedule_counter_accepted"===t.type||"reschedule_counter_declined"===t.type)&&(null===(r=t.data)||void 0===r?void 0:r.counter_request_id)===(null===(a=e.data)||void 0===a?void 0:a.counter_request_id)})).forEach(t=>{!r.has("reschedule-notification-".concat(t.id))&&e++}),J.filter(e=>"reschedule_accepted"===e.type||"reschedule_declined"===e.type||"reschedule_counter_accepted"===e.type||"reschedule_counter_declined"===e.type).forEach(t=>{!r.has("reschedule-notification-".concat(t.id))&&e++}),localStorage.setItem("schedulerMessagesCount",e.toString()),window.dispatchEvent(new Event("schedulerCountUpdated")),console.log("\uD83D\uDCCA Counter Update:",{schedulerCount:e})},[h,T,x,f,U,Y,J]),(0,s.useEffect)(()=>{if(!h||T)return;let e=setTimeout(()=>{let e=localStorage.getItem("readSchedulerMessages"),t=e?new Set(JSON.parse(e)):new Set;f.filter(e=>"pending"===e.status).forEach(e=>{t.add("pending-".concat(e.care_response_id))}),U.filter(e=>"pending"===e.status).forEach(e=>{let r="".concat(e.open_block_parent_id||e.open_block_parent_name,"-").concat(e.care_response_id);t.add("invitation-group-".concat(r))}),U.filter(e=>"accepted"===e.status).forEach((e,r)=>{t.add("open-block-accepted-".concat(e.invitation_id||r))}),Y.forEach(e=>{let r=e.reschedule_group_id||e.request_id;t.add("reschedule-".concat(r))}),J.forEach(e=>{"care_declined"===e.type?t.add("care-declined-".concat(e.id)):t.add("reschedule-notification-".concat(e.id))}),localStorage.setItem("readSchedulerMessages",JSON.stringify(Array.from(t)));let r=J.filter(e=>"hangout_accepted"===e.type&&!e.is_read);if(r.length>0){let e=r.map(e=>e.id);d.O.from("notifications").update({is_read:!0}).in("id",e).then(()=>{window.dispatchEvent(new CustomEvent("refreshCounters"))})}window.dispatchEvent(new Event("schedulerCountUpdated"))},2e3);return()=>clearTimeout(e)},[h,T,x,f,U,Y,J]),T)?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(n.Z,{currentPage:"scheduler"}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 mb-6"}),(0,a.jsx)("div",{className:"space-y-4",children:Array.from({length:3}).map((e,t)=>(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded"},t))})]})})})]}):I?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(n.Z,{currentPage:"scheduler"}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-red-800",children:I}),(0,a.jsx)("button",{onClick:eN,className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Try Again"})]})})})]}):(0,a.jsx)(n.Z,{currentPage:"scheduler",children:(0,a.jsx)("div",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:e("scheduler")})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow mb-8",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:e("messages")}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e("clickMessageToExpand")})]})}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(function(){let[t,r]=(0,s.useState)(new Set),i=e=>{let a=new Set(t);a.has(e)?a.delete(e):a.add(e),r(a)},n=(()=>{let t=[],r=new Map;U.filter(e=>"pending"===e.status).forEach((e,t)=>{let a=e.open_block_parent_id||e.open_block_parent_name;r.has(a)||r.set(a,{parentName:e.open_block_parent_name,parentId:e.open_block_parent_id,invitations:[],hasPending:!1});let s=r.get(a);s.invitations.push(e),"pending"===e.status&&(s.hasPending=!0)});let s=new Map;Y.forEach(e=>{let t=e.reschedule_group_id||e.request_id;s.has(t)||s.set(t,{request:e,responses:[]}),s.get(t).responses.push(e)});let i=new Set(J.filter(e=>{var t;return"reschedule_counter_sent"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.counter_request_id)}).map(e=>e.data.counter_request_id)),n=new Set;J.forEach(e=>{if("reschedule_counter_sent"===e.type){var t,r;let a=null===(t=e.data)||void 0===t?void 0:t.counter_request_id,s=null===(r=e.data)||void 0===r?void 0:r.original_request_id;!J.some(e=>{var t;return("reschedule_counter_accepted"===e.type||"reschedule_counter_declined"===e.type)&&(null===(t=e.data)||void 0===t?void 0:t.counter_request_id)===a})&&s&&n.add(s)}}),s.forEach((r,s)=>{let d=r.request;i.has(s)||i.has(d.request_id)||n.has(s)||n.has(d.request_id)||t.push({id:"reschedule-".concat(s),type:"reschedule_request",title:d.original_date?e("wantsToReschedule",{name:d.requester_name,date:m(d.original_date)}):e("wantsToRescheduleA",{name:d.requester_name}),subtitle:e("fromDateToDate",{fromDate:d.original_date?m(d.original_date):e("unknown"),fromTime:"".concat(d.original_start_time||e("unknown"),"-").concat(d.original_end_time||e("unknown")),toDate:m(d.new_date),toTime:"".concat(d.new_start_time,"-").concat(d.new_end_time)}),timestamp:d.created_at,data:d,actions:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>eO(d.care_response_id,"accepted",void 0,d.request_id),disabled:Z,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 disabled:opacity-50",children:e("accept")}),(0,a.jsx)("button",{onClick:()=>eO(d.care_response_id,"declined",void 0,d.request_id),disabled:Z,className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50",children:e("decline")})]})})}),J.forEach((r,s)=>{var i,n;let d;if("reschedule_counter_sent"===r.type){let e=null===(n=r.data)||void 0===n?void 0:n.counter_request_id;if(J.some(t=>{var r;return("reschedule_counter_accepted"===t.type||"reschedule_counter_declined"===t.type)&&(null===(r=t.data)||void 0===r?void 0:r.counter_request_id)===e}))return}"reschedule_counter_sent"===r.type&&(null===(i=r.data)||void 0===i?void 0:i.original_requester_id)===(null==h?void 0:h.id)&&(d=(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>eO(r.data.care_response_id,"accepted",void 0,r.data.counter_request_id),disabled:Z,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 disabled:opacity-50",children:e("accept")}),(0,a.jsx)("button",{onClick:()=>eO(r.data.care_response_id,"declined",void 0,r.data.counter_request_id),disabled:Z,className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50",children:e("decline")})]})),t.push({id:"care_declined"===r.type?"care-declined-".concat(r.id):"hangout_accepted"===r.type?"hangout-accepted-".concat(r.id):"reschedule-notification-".concat(r.id),type:r.type,title:function(e,t){let r={care_request:"notifications.careRequestTitle",care_response:"notifications.careResponseTitle",care_accepted:"notifications.careAcceptedTitle",care_declined:"notifications.careDeclinedTitle",open_block_invitation:"notifications.openBlockInvitationTitle",open_block_accepted:"notifications.openBlockAcceptedTitle",hangout_accepted:"notifications.hangoutAcceptedTitle",reschedule_request:"notifications.rescheduleRequestTitle",reschedule_accepted:"notifications.rescheduleAcceptedTitle",reschedule_declined:"notifications.rescheduleDeclinedTitle",reschedule_counter_sent:"notifications.rescheduleCounterSentTitle",reschedule_counter_accepted:"notifications.rescheduleCounterAcceptedTitle",reschedule_counter_declined:"notifications.rescheduleCounterDeclinedTitle"}[e.type];return r?t(r):e.title||e.type}(r,e),subtitle:function(e,t){let r=e.data||{},a=r.requester_name||r.responder_name||"",s=u(r.requested_date||r.reciprocal_date),i=_(r.start_time||r.reciprocal_start_time),n=_(r.end_time||r.reciprocal_end_time),d=u(r.new_date||r.reciprocal_date),c=r.care_type||"care",o={care_request:"pet"===r.care_type?"notifications.petCareRequest":"notifications.careRequest",care_response:"pet"===r.care_type?"notifications.petCareResponse":"notifications.careResponse",care_accepted:"pet"===r.care_type?"notifications.petCareAccepted":"notifications.careAccepted",care_declined:"notifications.careDeclined",open_block_invitation:"notifications.openBlockInvitation",open_block_accepted:"notifications.openBlockAccepted",hangout_accepted:"notifications.hangoutAccepted",reschedule_request:"notifications.rescheduleRequest",reschedule_accepted:"notifications.rescheduleAccepted",reschedule_declined:"notifications.rescheduleDeclined",reschedule_counter_sent:"notifications.rescheduleCounterSent",reschedule_counter_accepted:"notifications.rescheduleCounterAccepted",reschedule_counter_declined:"notifications.rescheduleCounterDeclined"}[e.type];if(o){let r=t(o,{name:a,date:s,startTime:i,endTime:n,newDate:d,careType:c});return r===o?e.message||"":r}return e.message||""}(r,e),timestamp:r.created_at,data:r.data,actions:d})}),r.forEach((r,a)=>{let s=r.invitations.length;if(s>0){let i=r.invitations[0],n=i.existing_block_date,d=i.existing_block_start_time,c=i.existing_block_end_time,o=i.group_name,l="";if(n&&d&&c){let t=d.substring(0,5),a=c.substring(0,5);l=e("isOpeningBlock",{name:r.parentName,date:m(n),startTime:t,endTime:a,group:o})}else l=e("isOpeningBlockGeneric",{name:r.parentName,group:o});t.push({id:"invitation-group-".concat(a),type:"open_block_invitation",title:l,subtitle:"",timestamp:r.invitations[0].created_at,data:{group:r,invitations:r.invitations,totalTimeBlocks:s},actions:void 0})}}),U.filter(e=>"accepted"===e.status).forEach((r,a)=>{var s,i;if(r.existing_block_date,null===(s=r.existing_block_start_time)||void 0===s||s.substring(0,5),null===(i=r.existing_block_end_time)||void 0===i||i.substring(0,5),r.group_name,r.is_provider_view){let s=r.acceptor_name,i=r.group_name,n={id:"open-block-provider-".concat(r.invitation_id||r.id||a),type:"open_block_provider_notified",title:e("acceptedYourOpenBlock",{name:s,group:i,date:m(r.existing_block_date)}),subtitle:"",timestamp:r.created_at,data:r};t.push(n)}else{let s=r.open_block_parent_name,i=r.group_name,n={id:"open-block-accepted-".concat(r.invitation_id||a),type:"open_block_accepted",title:e("youAcceptedOpenBlock",{name:s,group:i,date:m(r.existing_block_date)}),subtitle:"",timestamp:r.created_at,data:r};t.push(n)}}),f.filter(e=>"pending"===e.status&&e.responder_id===h.id).forEach((r,s)=>{let i=ed.get(r.care_request_id)||ej(r.notes||"",r.end_time),n=r.end_date||r.requested_end_date,d=n&&n!==r.requested_date,c="pet"===r.care_type?e("petCareRequestFrom",{date:m(r.requested_date),startTime:eI(r.start_time),endTime:eI(i),name:r.requester_name,petName:r.pet_name||""}):e("childCareRequestFrom",{date:m(r.requested_date),startTime:eI(r.start_time),endTime:eI(i),name:r.requester_name});d&&(c+=e("careRequestUntil",{date:m(n)})),t.push({id:"pending-".concat(r.care_response_id||s),type:"care_request",title:c,subtitle:"",timestamp:r.created_at,data:r,actions:(0,a.jsx)("button",{onClick:()=>eR({care_request_id:r.care_request_id,group_id:r.group_id,group_name:r.group_name,requester_id:r.requester_id,requester_name:r.requester_name,requested_date:r.requested_date,start_time:r.start_time,end_time:r.end_time,notes:"",status:"pending",created_at:r.created_at,response_count:0,accepted_response_count:0,care_type:r.care_type,pet_name:r.pet_name,end_date:r.end_date}),className:"px-3 py-1 ".concat("pet"===r.care_type?"bg-purple-600 hover:bg-purple-700":"bg-blue-600 hover:bg-blue-700"," text-white text-sm rounded"),children:e("respondToRequest")})})}),f.filter(e=>"responded"===e.status).forEach((r,a)=>{t.push({id:"responded-".concat(r.care_response_id||a),type:"care_request",title:e("careRequestResponded",{name:r.requester_name}),subtitle:"",timestamp:r.created_at,data:r,actions:void 0})});let d=new Map;return x.forEach(e=>{if(!h||e.requester_id!==h.id)return;let t=f.filter(t=>t.care_request_id===e.care_request_id&&("submitted"===t.status||"accepted"===t.status||"declined"===t.status));t.length>0&&d.set(e.care_request_id,{request:e,responses:t})}),d.forEach(r=>{let{request:a,responses:s}=r,i=s.length,n=s.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())[0],d=s.find(e=>"accepted"===e.status);if(d){let r=d.responder_name||e("unknown"),s=d.group_name||e("group");t.push({id:"request-accepted-".concat(a.care_request_id),type:"care_request",title:e("youAcceptedReciprocal",{name:r,group:s,date:m(a.requested_date)}),subtitle:"",timestamp:d.created_at,data:d,actions:void 0})}else{let r="pet"===a.care_type?e("petCare"):e("childCare");t.push({id:"responses-".concat(a.care_request_id),type:"care_response",title:1===i?e("yourCareRequestReceived",{type:r,date:m(a.requested_date),startTime:eI(a.start_time),endTime:eI(ej(a.notes||"",a.end_time)),count:i}):e("yourCareRequestReceivedPlural",{type:r,date:m(a.requested_date),startTime:eI(a.start_time),endTime:eI(ej(a.notes||"",a.end_time)),count:i}),subtitle:"",timestamp:n.created_at,data:{request:a,responses:s,responseCount:i},actions:void 0})}}),v.forEach((r,a)=>{if("accepted"===r.status){let s=r.requester_name||e("unknown");t.push({id:"status-".concat(r.care_response_id||a),type:"care_accepted",title:e("acceptedYourReciprocal",{name:s,date:m(r.requested_date)}),subtitle:"",timestamp:r.created_at,data:r})}}),et.forEach((r,s)=>{t.push({id:"group-invitation-".concat(r.invitation_id||s),type:"group_invitation",title:e("invitedToJoinGroup",{name:r.inviter_name,group:r.group_name}),subtitle:"",timestamp:r.invited_at,data:r,actions:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>ez(r.group_id),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:e("accept")}),(0,a.jsx)("button",{onClick:()=>eY(r.group_id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:e("decline")})]})})}),ea.forEach((r,a)=>{t.push({id:"event-invitation-".concat(r.event_request_id||a),type:"event_invitation",title:e("invitedToEvent",{name:r.inviter_name,event:r.event_title}),subtitle:"".concat(m(r.care_date)," ").concat(e("from")," ").concat(eI(r.start_time)," ").concat(e("to")," ").concat(eI(ej(r.notes||"",r.end_time))," • ").concat(r.child_name),timestamp:r.created_at,data:r,actions:void 0})}),ei.forEach((r,a)=>{let s="hangout"===r.request_type?e("hangout"):e("sleepover");t.push({id:"hangout-".concat(r.care_response_id),type:r.request_type,title:e("invitedToHangout",{name:r.host_parent_name,child:r.invited_child_name,type:s}),subtitle:"".concat(m(r.requested_date)," ").concat(e("from")," ").concat(eI(r.start_time)," ").concat(e("to")," ").concat(eI(r.end_time)).concat(r.end_date?" "+e("until")+" "+m(r.end_date):""," • ").concat(r.group_name),timestamp:r.created_at,data:r,actions:void 0})}),t.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())})();return 0===n.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-4",children:(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e("noMessages")}),(0,a.jsx)("p",{className:"text-gray-600",children:e("allCaughtUp")})]}):(0,a.jsx)("div",{className:"space-y-3",children:n.map(r=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 bg-gray-50 transition-colors ".concat("care_declined"!==r.type&&"reschedule_request"!==r.type&&"hangout_accepted"!==r.type?"hover:bg-gray-100 cursor-pointer":""),onClick:()=>{"care_declined"!==r.type&&"reschedule_request"!==r.type&&"hangout_accepted"!==r.type&&i(r.id)},children:(0,a.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 pr-2",children:[(0,a.jsxs)("div",{className:"flex items-center flex-wrap gap-2 mb-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:r.title}),"reschedule_request"!==r.type&&"reschedule_counter_sent"!==r.type&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full whitespace-nowrap ".concat("open_block_invitation"===r.type?"bg-yellow-100 text-yellow-800":"open_block_accepted"===r.type?"bg-green-100 text-green-800":"open_block_provider_notified"===r.type?"bg-blue-100 text-blue-800":"care_request"===r.type&&"accepted"===r.data.status?"bg-green-100 text-green-800":"care_request"===r.type?"bg-blue-100 text-blue-800":"care_response"===r.type?"bg-green-100 text-green-800":"care_accepted"===r.type?"bg-green-100 text-green-800":"care_declined"===r.type?"bg-red-100 text-red-800":"reschedule_accepted"===r.type?"bg-green-100 text-green-800":"reschedule_declined"===r.type?"bg-red-100 text-red-800":"reschedule_counter_sent"===r.type?"bg-yellow-100 text-yellow-800":"reschedule_counter_accepted"===r.type?"bg-green-100 text-green-800":"reschedule_counter_declined"===r.type?"bg-red-100 text-red-800":"hangout_accepted"===r.type?"bg-green-100 text-green-800":"group_invitation"===r.type?"bg-purple-100 text-purple-800":"event_invitation"===r.type?"bg-orange-100 text-orange-800":"hangout"===r.type?"bg-pink-100 text-pink-800":"sleepover"===r.type?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-800"),children:"open_block_invitation"===r.type?e("invitation"):"open_block_accepted"===r.type?e("accepted"):"open_block_provider_notified"===r.type?e("blockAccepted"):"care_request"===r.type&&"accepted"===r.data.status?e("accepted"):"care_request"===r.type?e("request"):"care_response"===r.type?e("response"):"care_accepted"===r.type?e("accepted"):"care_declined"===r.type?e("notAccepted"):"reschedule_accepted"===r.type?e("accepted"):"reschedule_declined"===r.type?e("declined"):"reschedule_counter_sent"===r.type?e("counterSent"):"reschedule_counter_accepted"===r.type?e("accepted"):"reschedule_counter_declined"===r.type?e("declined"):"hangout_accepted"===r.type?e("accepted"):"group_invitation"===r.type?e("groupInvite"):"event_invitation"===r.type?e("eventInvite"):"hangout"===r.type?e("hangoutInvite"):"sleepover"===r.type?e("sleeoverInvite"):e("update")})]}),r.subtitle&&"hangout_accepted"!==r.type&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:r.subtitle}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:m(r.timestamp)})]}),"group_invitation"!==r.type&&"care_declined"!==r.type&&"reschedule_request"!==r.type&&"reschedule_counter_sent"!==r.type&&"hangout_accepted"!==r.type&&(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform flex-shrink-0 ".concat(t.has(r.id)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),"group_invitation"===r.type&&"pending"===r.data.status&&(0,a.jsxs)("div",{className:"flex gap-2 pt-2 border-t border-gray-200",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),ez(r.data.group_id)},className:"flex-1 px-3 py-2 bg-green-600 text-white text-sm font-medium rounded hover:bg-green-700",children:e("accept")}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),eY(r.data.group_id)},className:"flex-1 px-3 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700",children:e("decline")})]}),"group_invitation"===r.type&&"accepted"===r.data.status&&(0,a.jsx)("div",{className:"pt-2 border-t border-gray-200",children:(0,a.jsx)("span",{className:"inline-block px-3 py-1 bg-green-100 text-green-800 text-sm rounded",children:e("accepted")})}),"group_invitation"===r.type&&"rejected"===r.data.status&&(0,a.jsx)("div",{className:"pt-2 border-t border-gray-200",children:(0,a.jsx)("span",{className:"inline-block px-3 py-1 bg-red-100 text-red-800 text-sm rounded",children:e("rejected")})}),"reschedule_request"===r.type&&r.actions&&(0,a.jsx)("div",{className:"pt-2 border-t border-gray-200",onClick:e=>e.stopPropagation(),children:r.actions}),"reschedule_counter_sent"===r.type&&r.actions&&(0,a.jsx)("div",{className:"pt-2 border-t border-gray-200",onClick:e=>e.stopPropagation(),children:r.actions})]})}),t.has(r.id)&&(0,a.jsxs)("div",{className:"p-4 bg-white border-t border-gray-200",children:[r.actions&&"group_invitation"!==r.type&&"reschedule_request"!==r.type&&"reschedule_counter_sent"!==r.type&&(0,a.jsx)("div",{className:"mb-3",children:r.actions}),"open_block_invitation"===r.type&&r.data.invitations&&(0,a.jsx)("div",{className:"space-y-3 mb-4",children:r.data.invitations.map((t,r)=>(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 border-l-4 border-yellow-500",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:t.reciprocal_date&&t.reciprocal_start_time&&t.reciprocal_end_time?"".concat(e("reciprocalCare")," ").concat(m(t.reciprocal_date)," ").concat(e("from")," ").concat(eI(t.reciprocal_start_time)," ").concat(e("to")," ").concat(eI(t.reciprocal_end_time)):e("reciprocalCareDetails")}),t.notes&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(0,a.jsxs)("strong",{children:[e("notes"),":"]})," ",t.notes]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(0,a.jsxs)("strong",{children:[e("group"),":"]})," ",t.group_name||"N/A"]})]}),"pending"===t.status&&(0,a.jsxs)("div",{className:"flex gap-2 pt-2 border-t border-gray-200",children:[(0,a.jsx)("button",{onClick:()=>eF(t),disabled:L,className:"flex-1 px-3 py-2 bg-green-600 text-white text-sm font-medium rounded hover:bg-green-700 disabled:bg-gray-400",children:e("accept")}),(0,a.jsx)("button",{onClick:()=>eB(t),disabled:L,className:"flex-1 px-3 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 disabled:bg-gray-400",children:e("decline")})]})]})},t.invitation_id||r))}),"open_block_accepted"===r.type&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillReceiveCare")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.existing_block_date)," ",e("from")," ",eI(r.data.existing_block_start_time)," ",e("to")," ",eI(r.data.existing_block_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.existing_block_date,"needed"),className:"inline-block mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:e("viewInCalendar")})]})}),(0,a.jsx)("div",{className:"bg-green-50 rounded-lg p-3 border-l-4 border-green-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillProvideCare")}),r.data.reciprocal_date&&r.data.reciprocal_start_time&&r.data.reciprocal_end_time?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.reciprocal_date)," ",e("from")," ",eI(r.data.reciprocal_start_time)," ",e("to")," ",eI(r.data.reciprocal_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.reciprocal_date,"provided"),className:"inline-block mt-3 px-4 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors",children:e("viewInCalendar")})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1 italic",children:e("checkCalendarForReciprocal")})]})})]}),"open_block_provider_notified"===r.type&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("div",{className:"bg-green-50 rounded-lg p-3 border-l-4 border-green-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillProvideCare")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.existing_block_date)," ",e("from")," ",eI(r.data.existing_block_start_time)," ",e("to")," ",eI(r.data.existing_block_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.existing_block_date,"provided"),className:"inline-block mt-3 px-4 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors",children:e("viewInCalendar")})]})}),(0,a.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillReceiveCare")}),r.data.reciprocal_date&&r.data.reciprocal_start_time&&r.data.reciprocal_end_time?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.reciprocal_date)," ",e("from")," ",eI(r.data.reciprocal_start_time)," ",e("to")," ",eI(r.data.reciprocal_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.reciprocal_date,"needed"),className:"inline-block mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:e("viewInCalendar")})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1 italic",children:e("checkCalendarForReciprocal")})]})})]}),"care_response"===r.type&&r.data.responses&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm",children:e("allResponses")}),r.data.responses.map((e,t)=>(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 border-l-4 ".concat("pet"===e.care_type?"border-purple-500":"border-blue-500"),children:(0,a.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900 text-sm",children:["Response from: ",e.responder_name||"Unknown User"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Reciprocal care: ",m(e.reciprocal_date)," from"," ",eI(e.reciprocal_start_time)," to ",eI(e.reciprocal_end_time)]}),e.response_notes&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Notes: ",e.response_notes]})]}),"accepted"===e.status?(0,a.jsx)("div",{className:"pt-2 border-t border-gray-200",children:(0,a.jsx)("span",{className:"inline-block px-3 py-1 bg-green-100 text-green-800 text-sm rounded",children:"Accepted"})}):(0,a.jsx)("div",{className:"pt-2 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:()=>eT(e.care_response_id),className:"w-full px-3 py-2 text-white text-sm font-medium rounded ".concat("pet"===e.care_type?"bg-purple-600 hover:bg-purple-700":"bg-green-600 hover:bg-green-700"),children:"Accept Response"})})]})},e.care_response_id||t))]}),"care_request"===r.type&&"accepted"===r.data.status&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillReceiveCare")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.requested_date)," ",e("from")," ",eI(r.data.start_time)," ",e("to")," ",eI(ej(r.data.notes||"",r.data.end_time))]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.requested_date,"needed"),className:"inline-block mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:e("viewInCalendar")})]})}),(0,a.jsx)("div",{className:"bg-green-50 rounded-lg p-3 border-l-4 border-green-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillProvideCare")}),r.data.reciprocal_date&&r.data.reciprocal_start_time&&r.data.reciprocal_end_time?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.reciprocal_date)," ",e("from")," ",eI(r.data.reciprocal_start_time)," ",e("to")," ",eI(r.data.reciprocal_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.reciprocal_date,"provided"),className:"inline-block mt-3 px-4 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors",children:e("viewInCalendar")})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1 italic",children:e("checkCalendarForReciprocal")})]})})]}),"care_accepted"===r.type&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("div",{className:"bg-green-50 rounded-lg p-3 border-l-4 border-green-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillProvideCare")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.requested_date)," ",e("from")," ",eI(r.data.start_time)," ",e("to")," ",eI(ej(r.data.notes||"",r.data.end_time))]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.requested_date,"provided"),className:"inline-block mt-3 px-4 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors",children:e("viewInCalendar")})]})}),(0,a.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("youWillReceiveCare")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.reciprocal_date)," ",e("from")," ",eI(r.data.reciprocal_start_time)," ",e("to")," ",eI(r.data.reciprocal_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.reciprocal_date,"needed"),className:"inline-block mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:e("viewInCalendar")})]})})]}),"reschedule_accepted"===r.type&&(0,a.jsx)("div",{className:"space-y-3 mb-4",children:(0,a.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("newCareBlockReceiving")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.new_date)," ",e("from")," ",eI(r.data.new_start_time)," ",e("to")," ",eI(r.data.new_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.new_date,"needed"),className:"inline-block mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:e("viewInCalendar")})]})})}),"reschedule_declined"===r.type&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm",children:e("cancelledCareBlocksLabel")}),(0,a.jsx)("div",{className:"bg-red-50 rounded-lg p-3 border-l-4 border-red-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("declinedReschedule")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.declined_reschedule_date)," ",e("from")," ",eI(r.data.declined_reschedule_start_time)," ",e("to")," ",eI(r.data.declined_reschedule_end_time)]})]})}),r.data.selected_cancellation_date&&(0,a.jsx)("div",{className:"bg-red-50 rounded-lg p-3 border-l-4 border-red-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("selectedArrangementRemoved")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.selected_cancellation_date)," ",e("from")," ",eI(r.data.selected_cancellation_start_time)," ",e("to")," ",eI(r.data.selected_cancellation_end_time)]})]})})]}),"reschedule_counter_sent"===r.type&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm",children:e("counterProposalDetails")}),(0,a.jsx)("div",{className:"bg-yellow-50 rounded-lg p-3 border-l-4 border-yellow-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("originalRequest")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.original_requested_date)," ",e("from")," ",eI(r.data.original_requested_start_time)," ",e("to")," ",eI(r.data.original_requested_end_time)]})]})}),(0,a.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("counterProposal")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.counter_date)," ",e("from")," ",eI(r.data.counter_start_time)," ",e("to")," ",eI(r.data.counter_end_time)]})]})}),r.data.selected_cancellation_date&&r.data.original_requester_id===(null==h?void 0:h.id)&&(0,a.jsx)("div",{className:"bg-red-50 rounded-lg p-3 border-l-4 border-red-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("blockAtRiskIfDeclined")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.selected_cancellation_date)," ",e("from")," ",eI(r.data.selected_cancellation_start_time)," ",e("to")," ",eI(r.data.selected_cancellation_end_time)]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e("requestingCareFrom",{requester:r.data.selected_cancellation_requesting_parent,receiver:r.data.selected_cancellation_receiving_parent})})]})})]}),"reschedule_counter_accepted"===r.type&&(0,a.jsx)("div",{className:"space-y-3 mb-4",children:(0,a.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("newCareBlockReceiving")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.new_date)," ",e("from")," ",eI(r.data.new_start_time)," ",e("to")," ",eI(r.data.new_end_time)]}),(0,a.jsx)("button",{onClick:()=>eq(r.data.new_date,"needed"),className:"inline-block mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:e("viewInCalendar")})]})})}),"reschedule_counter_declined"===r.type&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm",children:e("cancelledCareBlocksLabel")}),(0,a.jsx)("div",{className:"bg-red-50 rounded-lg p-3 border-l-4 border-red-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("declinedCounterProposal")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.declined_counter_date)," ",e("from")," ",eI(r.data.declined_counter_start_time)," ",e("to")," ",eI(r.data.declined_counter_end_time)]})]})}),r.data.selected_cancellation_date&&(0,a.jsx)("div",{className:"bg-red-50 rounded-lg p-3 border-l-4 border-red-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e("selectedArrangementRemoved")}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[m(r.data.selected_cancellation_date)," ",e("from")," ",eI(r.data.selected_cancellation_start_time)," ",e("to")," ",eI(r.data.selected_cancellation_end_time)]})]})})]}),"event_invitation"===r.type&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm",children:e("eventDetails")}),(0,a.jsx)("div",{className:"bg-orange-50 rounded-lg p-3 border-l-4 border-orange-500",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900 text-sm",children:[e("event")," ",r.data.event_title]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[e("date"),": ",m(r.data.care_date)," ",e("from")," ",eI(r.data.start_time)," ",e("to")," ",eI(r.data.end_time)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e("child")," ",r.data.child_name]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e("group"),": ",r.data.group_name]})]})}),(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm mt-4",children:e("rsvp")}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>e$(r.data.event_request_id,"going"),className:"px-4 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:e("going")}),(0,a.jsx)("button",{onClick:()=>e$(r.data.event_request_id,"maybe"),className:"px-4 py-2 bg-yellow-600 text-white text-sm rounded hover:bg-yellow-700",children:e("maybe")}),(0,a.jsx)("button",{onClick:()=>e$(r.data.event_request_id,"not_going"),className:"px-4 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:e("notGoing")})]})]}),("hangout"===r.type||"sleepover"===r.type)&&(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm",children:"hangout"===r.type?e("hangoutDetails"):e("sleepoverDetails")}),(0,a.jsx)("div",{className:"".concat("hangout"===r.type?"bg-pink-50 border-pink-500":"bg-indigo-50 border-indigo-500"," rounded-lg p-3 border-l-4"),children:(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900 text-sm",children:[e("host")," ",r.data.host_parent_name]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e("yourChild")," ",r.data.invited_child_name]}),r.data.hosting_children_names&&r.data.hosting_children_names.length>0&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e("hostingChildren")," ",r.data.hosting_children_names.join(", ")]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e("date"),": ",m(r.data.requested_date)," ",e("from")," ",eI(r.data.start_time)," ",e("to")," ",eI(r.data.end_time)]}),r.data.end_date&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e("until")," ",m(r.data.end_date)," ",e("at")," ",eI(r.data.end_time)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e("group"),": ",r.data.group_name]}),r.data.notes&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:[(0,a.jsxs)("strong",{children:[e("notes"),":"]})," ",r.data.notes]})]})}),(0,a.jsx)("h5",{className:"font-medium text-gray-900 text-sm mt-4",children:e("respond")}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>eV(r.data,r.data.invited_child_id),className:"px-4 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:e("accept")}),(0,a.jsx)("button",{onClick:()=>eZ(r.data),className:"px-4 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:e("decline")})]})]}),r.data.notes&&"care_request"!==r.type&&(0,a.jsx)("div",{className:"text-sm text-gray-600",children:(0,a.jsxs)("p",{children:[(0,a.jsxs)("strong",{children:[e("notes"),":"]})," ",r.data.notes]})})]})]},r.id))})},{})})]}),el&&(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 overflow-y-auto",style:{top:"80px",bottom:"70px",zIndex:9999},children:(0,a.jsx)("div",{className:"flex items-start justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 sticky top-0 bg-white rounded-t-lg z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:e("createNewCareRequest")}),(0,a.jsx)("button",{type:"button",onClick:eU,className:"text-gray-600 hover:text-gray-900 p-2 -mr-2 rounded-full hover:bg-gray-100",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsxs)("form",{onSubmit:eS,children:[(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e("type")," *"]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>e_(e=>({...e,care_type:"reciprocal",hosting_child_ids:[],invited_child_ids:[],end_date:""})),className:"px-4 py-3 rounded-md border-2 transition-all ".concat("reciprocal"===eu.care_type?"border-blue-500 bg-blue-50 text-blue-700 font-semibold":"border-gray-300 hover:border-gray-400"),children:e("careRequestType")}),(0,a.jsx)("button",{type:"button",onClick:()=>e_(e=>({...e,care_type:"hangout",child_id:"",end_date:""})),className:"px-4 py-3 rounded-md border-2 transition-all ".concat("hangout"===eu.care_type?"border-green-500 bg-green-50 text-green-700 font-semibold":"border-gray-300 hover:border-gray-400"),children:e("hangout")}),(0,a.jsx)("button",{type:"button",onClick:()=>e_(e=>({...e,care_type:"sleepover",child_id:""})),className:"px-4 py-3 rounded-md border-2 transition-all ".concat("sleepover"===eu.care_type?"border-purple-500 bg-purple-50 text-purple-700 font-semibold":"border-gray-300 hover:border-gray-400"),children:e("sleepover")})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"sleepover"===eu.care_type?"".concat(e("startDate")," *"):"".concat(e("date")," *")}),(0,a.jsx)("input",{type:"date",required:!0,value:eu.care_date,onChange:e=>e_(t=>({...t,care_date:e.target.value})),min:new Date().toISOString().split("T")[0],max:"".concat(new Date().getFullYear()+5,"-12-31"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),"sleepover"===eu.care_type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e("endDate")," *"]}),(0,a.jsx)("input",{type:"date",required:!0,value:eu.end_date,onChange:e=>e_(t=>({...t,end_date:e.target.value})),min:eu.care_date||new Date().toISOString().split("T")[0],max:"".concat(new Date().getFullYear()+5,"-12-31"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e("startTime")," *"]}),(0,a.jsx)("input",{type:"time",required:!0,value:eu.start_time,onChange:e=>e_(t=>({...t,start_time:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e("endTime")," *"]}),(0,a.jsx)("input",{type:"time",required:!0,value:eu.end_time,onChange:e=>e_(t=>({...t,end_time:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e("group")," *"]}),(0,a.jsxs)("select",{required:!0,value:eu.group_id,onChange:e=>{let t=e.target.value;e_(e=>({...e,group_id:t,child_id:"",hosting_child_ids:[],invited_child_ids:[]})),t&&(ek(t),"reciprocal"!==eu.care_type&&eE(t))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:e("selectGroup")}),w.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),"reciprocal"===eu.care_type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e("child")," *"]}),(0,a.jsxs)("select",{required:!0,value:eu.child_id,onChange:e=>e_(t=>({...t,child_id:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!eu.group_id||0===q.length,children:[(0,a.jsx)("option",{value:"",children:eu.group_id?0===q.length?e("noActiveChildrenInGroup"):e("selectChild"):e("selectGroupFirst")}),q.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),("hangout"===eu.care_type||"sleepover"===eu.care_type)&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e("hostingChildrenLabel")," * ",e("hostingChildrenDesc")]}),(0,a.jsx)("div",{className:"border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto",children:eu.group_id?0===q.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e("noChildrenAvailable")}):(0,a.jsx)("div",{className:"space-y-2",children:q.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:eu.hosting_child_ids.includes(e.id),onChange:t=>{let r=t.target.checked;e_(t=>({...t,hosting_child_ids:r?[...t.hosting_child_ids,e.id]:t.hosting_child_ids.filter(t=>t!==e.id)}))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]},e.id))}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e("selectGroupFirst")})})]}),("hangout"===eu.care_type||"sleepover"===eu.care_type)&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e("invitedChildrenLabel")," * ",e("invitedChildrenDesc")]}),(0,a.jsx)("div",{className:"border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto",children:eu.group_id?0===C.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e("noChildrenInThisGroup")}):(0,a.jsx)("div",{className:"space-y-2",children:C.filter(e=>!q.some(t=>t.id===e.id)).map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:eu.invited_child_ids.includes(e.id),onChange:t=>{let r=t.target.checked;e_(t=>({...t,invited_child_ids:r?[...t.invited_child_ids,e.id]:t.invited_child_ids.filter(t=>t!==e.id)}))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]},e.id))}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e("selectGroupFirst")})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("notesOptional")}),(0,a.jsx)("textarea",{value:eu.notes,onChange:e=>e_(t=>({...t,notes:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e("anyAdditionalNotes")})]})]}),(0,a.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:eU,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:e("cancel")}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"reciprocal"===eu.care_type?e("createRequestBtn"):"hangout"===eu.care_type?e("createHangoutBtn"):e("createSleepoverBtn")})]})]})]})})}),em&&eg&&(0,a.jsx)("div",{className:"fixed left-0 right-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{top:"145px",bottom:"90px",zIndex:9999},onClick:e=>{e.target===e.currentTarget&&(eh(!1),ex(null))},children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-full overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Submit Reciprocal ","pet"===eg.care_type?"Pet":"Child"," Care Response"]}),(0,a.jsx)("button",{onClick:()=>{eh(!1),ex(null)},className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"})]}),(0,a.jsx)("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Request:"})," ",eg.requester_name," needs ","pet"===eg.care_type?"pet":"child"," care on"," ",m(eg.requested_date)," from"," ",eI(eg.start_time)," to ",eI(ej(eg.notes||"",eg.end_time)),eg.end_date&&" until ".concat(m(eg.end_date)),"pet"===eg.care_type&&eg.pet_name&&" for ".concat(eg.pet_name)]})}),(0,a.jsxs)("form",{onSubmit:eD,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reciprocal Date"}),(0,a.jsx)("input",{type:"date",required:!0,value:eb.reciprocal_date,onChange:e=>ef(t=>({...t,reciprocal_date:e.target.value})),min:new Date().toISOString().split("T")[0],max:"".concat(new Date().getFullYear()+5,"-12-31"),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ".concat(ey?"border-yellow-500 focus:ring-yellow-500 bg-yellow-50":"border-gray-300 focus:ring-blue-500")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reciprocal Start Time"}),(0,a.jsx)("input",{type:"time",required:!0,value:eb.reciprocal_start_time,onChange:e=>ef(t=>({...t,reciprocal_start_time:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reciprocal End Time"}),(0,a.jsx)("input",{type:"time",required:!0,value:eb.reciprocal_end_time,onChange:e=>ef(t=>({...t,reciprocal_end_time:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),"pet"===eg.care_type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Reciprocal End Date",(0,a.jsx)("span",{className:"ml-2 text-xs text-purple-600",children:"(Optional - for multi-day care)"})]}),(0,a.jsx)("input",{type:"date",value:eb.reciprocal_end_date,onChange:e=>ef(t=>({...t,reciprocal_end_date:e.target.value})),min:eb.reciprocal_date||void 0,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ".concat(ey?"border-yellow-500 focus:ring-yellow-500 bg-yellow-50":"border-gray-300 focus:ring-purple-500")}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for same-day reciprocal care"})]}),"pet"===eg.care_type&&ey&&(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)("div",{className:"p-3 bg-yellow-50 border border-yellow-300 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:ey})})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["pet"===eg.care_type?"Pet":"Child"," for Reciprocal Care"]}),"pet"===eg.care_type?(0,a.jsxs)("select",{required:!0,value:eb.reciprocal_pet_id,onChange:e=>ef(t=>({...t,reciprocal_pet_id:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",children:[(0,a.jsx)("option",{value:"",children:"Select a pet"}),O.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.species?"(".concat(e.species,")"):""]},e.id))]}):(0,a.jsxs)("select",{required:!0,value:eb.reciprocal_child_id,onChange:e=>ef(t=>({...t,reciprocal_child_id:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Select a child"}),q.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),(0,a.jsx)("textarea",{value:eb.notes,onChange:e=>ef(t=>({...t,notes:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional details about your reciprocal care offer..."})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{eh(!1),ex(null)},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 ".concat("pet"===eg.care_type?"bg-purple-600 hover:bg-purple-700":"bg-blue-600 hover:bg-blue-700"," text-white rounded-md transition-colors"),children:"Submit Response"})]})]})]})})}),K&&X&&(0,a.jsx)(o,{isOpen:K,onClose:()=>{Q(!1),ee(null)},rescheduleRequestId:X.requestId,careResponseId:X.responseId,onResponseSuccess:async()=>{Q(!1),ee(null),await eN()}})]})})})}}},function(e){e.O(0,[256,506,634,521,971,117,744],function(){return e(e.s=335)}),_N_E=e.O()}]);